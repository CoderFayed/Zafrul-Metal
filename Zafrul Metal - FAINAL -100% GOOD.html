<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zafrul Metal - বগুড়া</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All CSS styles remain the same */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'SolaimanLipi', 'Siyam Rupali', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            background-image: url('https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), #1a252f);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 40px;
            color: var(--warning);
        }
        
        .company-info h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .company-info p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .contact-info {
            text-align: right;
        }
        
        .contact-info p {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        @keyframes slideIn {
            from {transform: translateX(100%); opacity: 0;}
            to {transform: translateX(0); opacity: 1;}
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab:hover {
            background-color: var(--light);
        }
        
        .tab.active {
            color: var(--secondary);
            border-bottom: 3px solid var(--secondary);
            background-color: #f8f9fa;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #f8f9fa;
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #eee;
            color: var(--primary);
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .status-paid {
            background-color: #d5f4e6;
            color: var(--success);
        }
        
        .status-unpaid {
            background-color: #ffefef;
            color: var(--danger);
        }
        
        .data-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .edit-btn {
            background-color: #e3f2fd;
            color: var(--secondary);
        }
        
        .delete-btn {
            background-color: #ffebee;
            color: var(--danger);
        }
        
        .stock-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stock-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-top: 5px solid;
        }
        
        .stock-card:nth-child(1) {
            border-color: var(--secondary);
        }
        
        .stock-card:nth-child(2) {
            border-color: var(--warning);
        }
        
        .stock-card:nth-child(3) {
            border-color: var(--success);
        }
        
        .stock-card:nth-child(4) {
            border-color: var(--primary);
        }
        
        .stock-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stock-value {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
        }
        
        .file-stock-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--warning);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 30px;
            border-top: 1px solid #eee;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            
            .tab-content.active, .tab-content.active * {
                visibility: visible;
            }
            
            .tab-content.active {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                padding: 20px;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block;
            }
            
            #invoiceContent, #invoiceContent * {
                visibility: visible !important;
            }
            
            #invoiceContent {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                padding: 20px;
            }
            
            @page {
                size: A4;
                margin: 15mm;
            }
            
            body {
                font-size: 12pt;
            }
            
            .invoice-table {
                font-size: 11pt;
            }
        }
        
        .date-range {
            display: flex;
            gap: 15px;
            align-items: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .bank-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .bank-card:nth-child(1) {
            border-color: #3498db;
        }
        
        .bank-card:nth-child(2) {
            border-color: #9b59b6;
        }
        
        .bank-card:nth-child(3) {
            border-color: #1abc9c;
        }
        
        .cash-balance {
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            text-align: center;
            margin: 15px 0;
        }
        
        .data-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex-grow: 1;
            max-width: 400px;
        }
        
        .auto-save-indicator {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #000;
        }
        
        .password-protected {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .password-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
            background: rgba(255, 255, 255, 0.95);
        }
        
        .password-box h2 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .password-box input {
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 2px;
        }
        
        .password-error {
            color: var(--danger);
            margin-top: 10px;
            display: none;
        }
        
        @media (max-width: 992px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .contact-info {
                text-align: center;
            }
        }
        
        /* Invoice Styles */
        .invoice-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }
        
        .invoice-header h1 {
            font-size: 32px;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .invoice-header h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .invoice-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .invoice-table th {
            background-color: #f8f9fa;
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
        }
        
        .invoice-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        
        .invoice-total {
            margin-top: 30px;
            text-align: right;
        }
        
        .total-row {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .total-label {
            font-weight: 600;
            width: 150px;
        }
        
        .total-value {
            font-weight: 700;
            width: 150px;
        }
        
        .signature-section {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
        }
        
        .signature {
            text-align: center;
            width: 45%;
        }
        
        .signature-line {
            border-top: 1px solid #333;
            margin: 40px 0 10px;
            width: 100%;
        }
        
        .sale-items {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .sale-item-row {
            display: grid;
            grid-template-columns: 3fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .sale-item-row.header {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .sale-item-row:last-child {
            border-bottom: none;
        }
        
        .item-action {
            cursor: pointer;
            color: #e74c3c;
            background: none;
            border: none;
            font-size: 16px;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .hand-icon {
            cursor: pointer;
            display: inline-block;
            margin-right: 5px;
            transition: transform 0.2s;
        }
        
        .hand-icon:hover {
            transform: scale(1.1);
        }
        
        .final-stock-item {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #b3e0ff;
            transition: all 0.3s;
        }
        
        .final-stock-item:hover {
            background: #d4ebfc;
            border-color: #66c2ff;
        }
        
        .final-stock-item.selected {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        .sale-product-input {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .sale-product-input select {
            width: 100%;
        }
        
        .sale-product-input input {
            width: 100%;
        }
        
        .remove-product-btn {
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .add-product-btn {
            background: var(--success);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            margin-top: 10px;
        }
        
        .stock-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ফাইনাল স্টক আইটেম স্টাইল */
        .final-stock-select-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        
        .final-stock-select-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .final-stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .final-stock-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .final-stock-option:hover {
            background: #e9ecef;
            border-color: #3498db;
        }
        
        .final-stock-option.selected {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .final-stock-option h4 {
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .final-stock-option p {
            margin: 3px 0;
            font-size: 14px;
            color: #555;
        }
        
        .weight-info {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 13px;
        }
        
        /* Bundle weight input styles */
        .bundle-weight-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .bundle-weight-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .bundle-weight-input {
            display: flex;
            flex-direction: column;
        }
        
        .bundle-weight-input label {
            font-size: 12px;
            margin-bottom: 5px;
            color: #666;
        }
        
        .weight-summary {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }
        
        .weight-summary h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .weight-summary-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        /* নতুন স্টাইলস: আপডেটেড পণ্য নির্বাচন স্টাইল */
        .individual-bundle-selection {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .bundle-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bundle-option:hover {
            background: #e9ecef;
            border-color: #3498db;
        }
        
        .bundle-option.selected {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .bundle-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .bundle-details {
            flex: 1;
        }
        
        .bundle-details p {
            margin: 2px 0;
            font-size: 13px;
            color: #555;
        }
        
        .bundle-weight-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .bundle-weight-input-row input {
            width: 120px;
            padding: 5px;
        }
        
        /* নতুন: অগ্রীম বেতন স্টাইল */
        .advance-payment-section {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #f39c12;
        }
        
        .advance-payment-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            align-items: end;
        }
        
        .advance-history {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .advance-history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .advance-history-item:last-child {
            border-bottom: none;
        }
        
        .advance-amount {
            font-weight: bold;
            color: #e74c3c;
        }
        
        .advance-date {
            font-size: 12px;
            color: #666;
        }
        
        /* নতুন: বালা স্টক স্টাইল */
        .bala-stock-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-top: 5px solid #9b59b6;
            margin-bottom: 20px;
        }
        
        .bala-stock-item {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #9b59b6;
        }
        
        /* নতুন: অন্যান্য খরচ স্টাইল */
        .other-expense-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* নতুন: বাকী টাকা জমার স্টাইল */
        .due-payment-section {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }
        
        .customer-due-info {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #ffeaa7;
        }
        
        .due-payment-history {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .due-payment-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .due-payment-item:last-child {
            border-bottom: none;
        }
        
        .due-amount {
            font-weight: bold;
            color: #27ae60;
        }
        
        .due-date {
            font-size: 12px;
            color: #666;
        }
        
        /* নতুন: ক্রেতা বাকী তালিকা স্টাইল */
        .customer-due-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #e74c3c;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .customer-due-card.low {
            border-color: #f39c12;
        }
        
        .customer-due-card.paid {
            border-color: #27ae60;
        }
        
        .customer-due-amount {
            font-size: 24px;
            font-weight: 700;
            color: #e74c3c;
            text-align: center;
            margin: 15px 0;
        }
        
        .customer-due-amount.low {
            color: #f39c12;
        }
        
        .customer-due-amount.paid {
            color: #27ae60;
        }
    </style>
</head>
<body>
    <!-- পাসওয়ার্ড প্রটেকশন -->
    <div id="passwordProtection" class="password-protected">
        <div class="password-box">
            <h2>Zafrul Metal</h2>
            <p>বগুড়া | মোবাইল: 01713706996</p>
            <div style="margin: 20px 0;">
                <i class="fas fa-lock" style="font-size: 48px; color: var(--secondary);"></i>
            </div>
            <h3>সিস্টেমে প্রবেশ করুন</h3>
            <input type="password" id="passwordInput" placeholder="পাসওয়ার্ড দিন" autocomplete="off">
            <button class="btn btn-primary" onclick="checkPassword()" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> প্রবেশ করুন
            </button>
            <div id="passwordError" class="password-error">
                <i class="fas fa-exclamation-circle"></i> ভুল পাসওয়ার্ড! আবার চেষ্টা করুন।
            </div>
        </div>
    </div>

    <!-- মেইন কন্টেন্ট -->
    <div class="container" id="mainContent" style="display: none;">
        <!-- হেডার সেকশন -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-industry"></i>
                </div>
                <div class="company-info">
                    <h1>Zafrul Metal</h1>
                    <p>বগুড়া | মোবাইল: 01713706996</p>
                    <p>এলুমিনিয়াম পণ্য উৎপাদন ও সরবরাহ</p>
                </div>
            </div>
            <div class="contact-info">
                <p><i class="fas fa-phone"></i> 01713706996</p>
                <p><i class="fas fa-map-marker-alt"></i> বগুড়া, বাংলাদেশ</p>
                <p id="currentDateTime"></p>
                <div class="auto-save-indicator" id="autoSaveIndicator" style="margin-top: 10px;">
                    <i class="fas fa-save"></i> অটো সেভ: <span id="lastSaveTime">চালু</span>
                </div>
            </div>
        </div>
        
        <!-- নোটিফিকেশন -->
        <div id="notification" class="notification"></div>
        
        <!-- ট্যাব মেনু -->
        <div class="tabs no-print">
            <div class="tab active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i> ড্যাশবোর্ড
            </div>
            <div class="tab" data-tab="suppliers">
                <i class="fas fa-truck"></i> সাপ্লায়ার ও কাঁচামাল
            </div>
            <div class="tab" data-tab="workers">
                <i class="fas fa-users"></i> শ্রমিক ব্যবস্থাপনা
            </div>
            <div class="tab" data-tab="products">
                <i class="fas fa-boxes"></i> পণ্য ব্যবস্থাপনা
            </div>
            <div class="tab" data-tab="production">
                <i class="fas fa-industry"></i> উৎপাদন এন্ট্রি
            </div>
            <div class="tab" data-tab="stocks">
                <i class="fas fa-warehouse"></i> স্টক ব্যবস্থাপনা
            </div>
            <div class="tab" data-tab="salary">
                <i class="fas fa-money-check-alt"></i> বেতন ব্যবস্থাপনা
            </div>
            <div class="tab" data-tab="customers">
                <i class="fas fa-user-tie"></i> ক্রেতা ও বিক্রয়
            </div>
            <div class="tab" data-tab="duePayments">
                <i class="fas fa-money-bill-wave"></i> বাকী টাকা জমা
            </div>
            <div class="tab" data-tab="finance">
                <i class="fas fa-chart-line"></i> অর্থ ব্যবস্থাপনা
            </div>
            <div class="tab" data-tab="reports">
                <i class="fas fa-file-alt"></i> রিপোর্ট
            </div>
            <div class="tab" data-tab="invoices">
                <i class="fas fa-file-invoice"></i> ইনভয়েস
            </div>
        </div>
        
        <!-- ড্যাশবোর্ড ট্যাব -->
        <div id="dashboard" class="tab-content active">
            <h2 class="section-title">
                <i class="fas fa-tachometer-alt"></i> ড্যাশবোর্ড
            </h2>
            
            <div class="stock-section">
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-box"></i> ১ম স্টক (ঢালাই)</h3>
                    <div class="stock-value" id="firstStockCount">0 পিচ</div>
                    <p>ঢালাই শ্রমিক দ্বারা উৎপাদিত পণ্য</p>
                </div>
                
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-box"></i> ২য় স্টক (ঘষা)</h3>
                    <div class="stock-value" id="secondStockCount">0 পিচ</div>
                    <p>ঘষা মহিলা শ্রমিক দ্বারা পরিষ্কার পণ্য</p>
                </div>
                
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-box"></i> ৩য় স্টক (ছিলা)</h3>
                    <div class="stock-value" id="thirdStockCount">0 পিচ</div>
                    <p>ছিলা শ্রমিক দ্বারা চূড়ান্ত পণ্য</p>
                </div>
                
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-file-archive"></i> ফাইনাল স্টক</h3>
                    <div class="stock-value" id="finalStockCount">0 বান্ডিল</div>
                    <p>বিক্রয়ের জন্য প্রস্তুত পণ্য</p>
                </div>
            </div>
            
            <div class="form-row">
                <div class="card">
                    <h3 class="stock-title"><i class="fas fa-users"></i> শ্রমিক সারাংশ</h3>
                    <p>মোট শ্রমিক: <span id="totalWorkers">0</span></p>
                    <p>ঢালাই শ্রমিক: <span id="dhaliWorkers">0</span></p>
                    <p>ঘষা মহিলা শ্রমিক: <span id="ghosaWorkers">0</span></p>
                    <p>ছিলা শ্রমিক: <span id="chilaWorkers">0</span></p>
                    <p>সাধারণ শ্রমিক: <span id="generalWorkers">0</span></p>
                    <p>বালা কাটা শ্রমিক: <span id="balaWorkers">0</span></p>
                </div>
                
                <div class="card">
                    <h3 class="stock-title"><i class="fas fa-money-bill-wave"></i> অর্থ সারাংশ</h3>
                    <p>নগদ ব্যালেন্স: <span id="cashBalance">0</span> টাকা</p>
                    <p>ব্যাংক ব্যালেন্স: <span id="bankBalance">0</span> টাকা</p>
                    <p>মোট প্রাপ্য বেতন: <span id="totalSalaryDue">0</span> টাকা</p>
                    <p>আজকের বিক্রয়: <span id="todaySales">0</span> টাকা</p>
                </div>
                
                <div class="card">
                    <h3 class="stock-title"><i class="fas fa-cubes"></i> বালা স্টক</h3>
                    <div class="stock-value" id="balaStockCount">0 পিচ</div>
                    <p>বালা কাটা শ্রমিক দ্বারা উৎপাদিত বালা</p>
                </div>
            </div>
            
            <!-- নতুন: ক্রেতাদের মোট বাকী টাকা সারাংশ -->
            <div class="card">
                <h3 class="stock-title"><i class="fas fa-file-invoice-dollar"></i> ক্রেতা বাকী সারাংশ</h3>
                <div class="stock-value" id="totalCustomerDue" style="color: #e74c3c;">0 টাকা</div>
                <p>সকল ক্রেতার মোট বাকী টাকা</p>
                <div class="btn-group" style="margin-top: 15px;">
                    <button class="btn btn-primary" onclick="switchTab('duePayments')">
                        <i class="fas fa-money-bill-wave"></i> বাকী টাকা জমা দিন
                    </button>
                    <button class="btn btn-warning" onclick="switchTab('customers')">
                        <i class="fas fa-user-tie"></i> ক্রেতা ব্যবস্থাপনা
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3 class="stock-title"><i class="fas fa-chart-bar"></i> দ্রুত কর্মসূচি</h3>
                <div class="btn-group">
                    <button class="btn btn-primary" id="quickAddWorker">
                        <i class="fas fa-user-plus"></i> শ্রমিক যোগ করুন
                    </button>
                    <button class="btn btn-success" id="quickAddProduct">
                        <i class="fas fa-box"></i> পণ্য যোগ করুন
                    </button>
                    <button class="btn btn-warning" id="quickAddProduction">
                        <i class="fas fa-industry"></i> উৎপাদন এন্ট্রি করুন
                    </button>
                    <button class="btn btn-primary" id="quickSell">
                        <i class="fas fa-shopping-cart"></i> পণ্য বিক্রয় করুন
                    </button>
                </div>
            </div>
        </div>

        <!-- সাপ্লায়ার ও কাঁচামাল ট্যাব -->
        <div id="suppliers" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-truck"></i> সাপ্লায়ার ও কাঁচামাল ব্যবস্থাপনা
            </h2>
            
            <div class="card">
                <h3>সাপ্লায়ার যোগ করুন</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplierName">সাপ্লায়ারের নাম *</label>
                        <input type="text" id="supplierName" placeholder="সাপ্লায়ারের পূর্ণ নাম">
                    </div>
                    
                    <div class="form-group">
                        <label for="supplierPhone">মোবাইল নম্বর *</label>
                        <input type="text" id="supplierPhone" placeholder="01XXXXXXXXX">
                    </div>
                    
                    <div class="form-group">
                        <label for="supplierType">সাপ্লায়ার ধরণ</label>
                        <select id="supplierType">
                            <option value="regular">নিয়মিত</option>
                            <option value="temporary">অস্থায়ী</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="supplierAddress">ঠিকানা</label>
                        <textarea id="supplierAddress" rows="2" placeholder="বিস্তারিত ঠিকানা"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="supplierEmail">ইমেইল</label>
                        <input type="email" id="supplierEmail" placeholder="ইমেইল ঠিকানা">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addSupplierBtn">
                        <i class="fas fa-plus"></i> সাপ্লায়ার যোগ করুন
                    </button>
                </div>
            </div>
            
            <!-- কাঁচামাল ক্রয় -->
            <div class="card">
                <h3>কাঁচামাল ক্রয় এন্ট্রি</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="rawMaterialDate">তারিখ *</label>
                        <input type="date" id="rawMaterialDate" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="rawMaterialSupplier">সাপ্লায়ার নির্বাচন *</label>
                        <select id="rawMaterialSupplier">
                            <option value="">সাপ্লায়ার নির্বাচন করুন</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="rawMaterialType">কাঁচামাল ধরণ *</label>
                        <select id="rawMaterialType">
                            <option value="aluminum">এলুমিনিয়াম</option>
                            <option value="other">অন্যান্য</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="rawMaterialQuantity">পরিমাণ (কেজি) *</label>
                        <input type="number" id="rawMaterialQuantity" placeholder="কেজিতে" min="0.1" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="rawMaterialUnitPrice">ইউনিট মূল্য (কেজি প্রতি) *</label>
                        <input type="number" id="rawMaterialUnitPrice" placeholder="টাকায়" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="rawMaterialTotalPrice">মোট মূল্য</label>
                        <input type="number" id="rawMaterialTotalPrice" placeholder="স্বয়ংক্রিয়ভাবে হিসাব হবে" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="rawMaterialPaymentMethod">পেমেন্ট পদ্ধতি *</label>
                        <select id="rawMaterialPaymentMethod">
                            <option value="cash">নগদ</option>
                            <option value="due">বাকি</option>
                            <option value="bank">ব্যাংক</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="rawMaterialBankGroup" style="display: none;">
                        <label for="rawMaterialBank">ব্যাংক নির্বাচন</label>
                        <select id="rawMaterialBank">
                            <option value="bank1">ইসলামী ব্যাংক</option>
                            <option value="bank2">সোনালী ব্যাংক</option>
                            <option value="bank3">ডাচ্ বাংলা ব্যাংক</option>
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addRawMaterialBtn">
                        <i class="fas fa-plus"></i> ক্রয় এন্ট্রি যোগ করুন
                    </button>
                </div>
            </div>
            
            <!-- কাঁচামাল স্টক ও হিসাব -->
            <div class="stock-section">
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-weight"></i> বর্তমান কাঁচামাল স্টক</h3>
                    <div class="stock-value" id="rawMaterialStock">0.00 কেজি</div>
                    <p>এলুমিনিয়াম কাঁচামাল মজুদ</p>
                </div>
                
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-money-bill-wave"></i> মোট বাকি টাকা</h3>
                    <div class="stock-value" id="supplierDueAmount">0.00 টাকা</div>
                    <p>সাপ্লায়ারদের মোট বাকি</p>
                </div>
            </div>
            
            <!-- তালিকা -->
            <div class="card">
                <div class="data-controls">
                    <h3>সাপ্লায়ার তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="supplierSearch" placeholder="সাপ্লায়ার খুঁজুন...">
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>ক্রমিক</th>
                            <th>নাম</th>
                            <th>মোবাইল</th>
                            <th>ধরণ</th>
                            <th>ঠিকানা</th>
                            <th>মোট ক্রয়</th>
                            <th>বাকি টাকা</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersTableBody">
                        <!-- সাপ্লায়ার তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <div class="data-controls">
                    <h3>কাঁচামাল ক্রয় তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="rawMaterialSearch" placeholder="ক্রয় খুঁজুন...">
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>তারিখ</th>
                            <th>সাপ্লায়ার</th>
                            <th>ধরণ</th>
                            <th>পরিমাণ</th>
                            <th>ইউনিট মূল্য</th>
                            <th>মোট মূল্য</th>
                            <th>পেমেন্ট</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="rawMaterialsTableBody">
                        <!-- কাঁচামাল ক্রয় তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- শ্রমিক ব্যবস্থাপনা ট্যাব -->
        <div id="workers" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-users"></i> শ্রমিক ব্যবস্থাপনা
            </h2>
            
            <div class="card">
                <h3>নতুন শ্রমিক যোগ করুন</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="workerName">শ্রমিকের নাম *</label>
                        <input type="text" id="workerName" placeholder="পূর্ণ নাম লিখুন">
                    </div>
                    
                    <div class="form-group">
                        <label for="workerPhone">মোবাইল নম্বর</label>
                        <input type="text" id="workerPhone" placeholder="01XXXXXXXXX">
                    </div>
                    
                    <div class="form-group">
                        <label for="workerCategory">শ্রমিক বিভাগ *</label>
                        <select id="workerCategory">
                            <option value="">বিভাগ নির্বাচন করুন</option>
                            <option value="dhali">ঢালাই শ্রমিক</option>
                            <option value="ghosa">ঘষা মহিলা শ্রমিক</option>
                            <option value="chila">ছিলা শ্রমিক</option>
                            <option value="general">সাধারণ শ্রমিক</option>
                            <option value="bala_kata">বালা কাটা</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="workerDesignation">পদবী (শুধুমাত্র সাধারণ শ্রমিকের জন্য)</label>
                        <select id="workerDesignation" disabled>
                            <option value="">পদবী নির্বাচন করুন</option>
                            <option value="managing_director">ম্যনেজিং ডাইরেক্টর</option>
                            <option value="manager">ম্যনেজার</option>
                            <option value="office_assistant">অফিস সহকারী</option>
                            <option value="security_guard">দারোয়ান/গার্ড</option>
                            <option value="night_guard">নাইট গার্ড</option>
                            <option value="driver">ড্রাইভার</option>
                            <option value="computer_operator">কম্পিউটার অপারেটর</option>
                            <option value="repeater">রিপিটার</option>
                            <option value="bandha_mahila">বাঁধা মহিলা</option>
                            <option value="bed_mahila">বেড মহিলা</option>
                            <option value="chula_mistri">চুলা মিস্তিরি</option>
                            <option value="chula_helper">চুলা হেলপার</option>
                            <option value="labor">লেবার</option>
                            <option value="lalikata">ললিকাটা</option>
                            <option value="delivery_man">ডেলিভারি ম্যান</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="workerAddress">ঠিকানা</label>
                        <textarea id="workerAddress" rows="2" placeholder="বিস্তারিত ঠিকানা"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="workerDailyRate">দৈনিক বেতন (সাধারণ শ্রমিকের জন্য)*</label>
                        <input type="number" id="workerDailyRate" placeholder="প্রতিদিনের বেতন" min="0" disabled>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addWorkerBtn">
                        <i class="fas fa-plus"></i> শ্রমিক যোগ করুন
                    </button>
                    <button class="btn btn-primary" id="updateWorkerBtn" style="display: none;">
                        <i class="fas fa-edit"></i> আপডেট করুন
                    </button>
                    <button class="btn btn-danger" id="cancelEditWorkerBtn" style="display: none;">
                        <i class="fas fa-times"></i> বাতিল করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="data-controls">
                    <h3>শ্রমিক তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="workerSearch" placeholder="শ্রমিক খুঁজুন...">
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>ক্রমিক</th>
                            <th>নাম</th>
                            <th>মোবাইল</th>
                            <th>বিভাগ</th>
                            <th>পদবী</th>
                            <th>ঠিকানা</th>
                            <th>দৈনিক বেতন</th>
                            <th>যোগ তারিখ</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="workersTableBody">
                        <!-- শ্রমিক তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- পণ্য ব্যবস্থাপনা ট্যাব -->
        <div id="products" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-boxes"></i> পণ্য ব্যবস্থাপনা
            </h2>
            
            <div class="card">
                <h3>দ্রুত পণ্য যোগ করুন</h3>
                <div class="btn-group">
                    <button class="btn btn-primary" id="addKoraiSeries">
                        <i class="fas fa-plus"></i> কড়াই সিরিজ যোগ করুন
                    </button>
                    <button class="btn btn-primary" id="addTaiSeries">
                        <i class="fas fa-plus"></i> তৈ সিরিজ যোগ করুন
                    </button>
                    <button class="btn btn-primary" id="addTawa">
                        <i class="fas fa-plus"></i> তাওয়া যোগ করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3>নতুন পণ্য যোগ করুন</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName">পণ্যের নাম *</label>
                        <select id="productName">
                            <option value="">পণ্য নির্বাচন করুন</option>
                            <!-- কড়াই সিরিজ -->
                            <option value="কড়াই-০">কড়াই-০</option>
                            <option value="কড়াই-১">কড়াই-১</option>
                            <option value="কড়াই-২">কড়াই-২</option>
                            <option value="কড়াই-৩">কড়াই-৩</option>
                            <option value="কড়াই-৪">কড়াই-৪</option>
                            <option value="কড়াই-৫">কড়াই-৫</option>
                            <option value="কড়াই-৬">কড়াই-৬</option>
                            <option value="কড়াই-৭">কড়াই-৭</option>
                            <option value="কড়াই-৮">কড়াই-৮</option>
                            <option value="কড়াই-৯">কড়াই-৯</option>
                            <option value="কড়াই-১০">কড়াই-১০</option>
                            <option value="কড়াই-১১">কড়াই-১১</option>
                            <option value="কড়াই-১২">কড়াই-১২</option>
                            <option value="কড়াই-১৩">কড়াই-১৩</option>
                            <option value="কড়াই-১৪">কড়াই-১৪</option>
                            <option value="কড়াই-১৫">কড়াই-১৫</option>
                            <option value="কড়াই-১৬">কড়াই-১৬</option>
                            <option value="কড়াই-১৭">কড়াই-১৭</option>
                            <option value="কড়াই-১৮">কড়াই-১৮</option>
                            <option value="কড়াই-১৯">কড়াই-১৯</option>
                            <option value="কড়াই-২০">কড়াই-২০</option>
                            <!-- তৈ সিরিজ -->
                            <option value="তৈ-১">তৈ-১</option>
                            <option value="তৈ-২">তৈ-২</option>
                            <!-- তাওয়া -->
                            <option value="তাওয়া">তাওয়া</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productCode">পণ্য কোড</label>
                        <input type="text" id="productCode" placeholder="স্বতঃ জেনারেট হবে">
                    </div>
                    
                    <div class="form-group">
                        <label for="dhaliSalary">ঢালাই শ্রমিক বেতন (প্রতি পিচ)</label>
                        <input type="number" id="dhaliSalary" placeholder="টাকায়" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="ghosaSalary">ঘষা মহিলা বেতন (প্রতি পিচ)</label>
                        <input type="number" id="ghosaSalary" placeholder="টাকায়" min="0" step="0.01" value="0.80">
                    </div>
                    
                    <div class="form-group">
                        <label for="chilaSalary">ছিলা শ্রমিক বেতন (প্রতি পিচ)</label>
                        <input type="number" id="chilaSalary" placeholder="টাকায়" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="sellingPrice">বিক্রয় মূল্য (প্রতি কেজি)</label>
                        <input type="number" id="sellingPrice" placeholder="টাকায়" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addProductBtn">
                        <i class="fas fa-plus"></i> পণ্য যোগ করুন
                    </button>
                    <button class="btn btn-primary" id="updateProductBtn" style="display: none;">
                        <i class="fas fa-edit"></i> আপডেট করুন
                    </button>
                    <button class="btn btn-danger" id="cancelEditProductBtn" style="display: none;">
                        <i class="fas fa-times"></i> বাতিল করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="data-controls">
                    <h3>পণ্য তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="productSearch" placeholder="পণ্য খুঁজুন...">
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>ক্রমিক</th>
                            <th>পণ্যের নাম</th>
                            <th>পণ্য কোড</th>
                            <th>ঢালাই বেতন</th>
                            <th>ঘষা বেতন</th>
                            <th>ছিলা বেতন</th>
                            <th>বিক্রয় মূল্য</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <!-- পণ্য তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- উৎপাদন এন্ট্রি ট্যাব -->
        <div id="production" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-industry"></i> উৎপাদন এন্ট্রি
            </h2>
            
            <div class="card">
                <h3>নতুন উৎপাদন এন্ট্রি</h3>
                <div id="productionMessage" class="stock-warning" style="display: none;">
                    <i class="fas fa-info-circle"></i>
                    <span id="productionMessageText"></span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productionDate">তারিখ *</label>
                        <input type="date" id="productionDate" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="productionWorkerType">শ্রমিক বিভাগ *</label>
                        <select id="productionWorkerType">
                            <option value="">বিভাগ নির্বাচন করুন</option>
                            <option value="dhali">ঢালাই শ্রমিক</option>
                            <option value="ghosa">ঘষা মহিলা শ্রমিক</option>
                            <option value="chila">ছিলা শ্রমিক</option>
                            <option value="bala_kata">বালা কাটা</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productionWorker">শ্রমিক নির্বাচন *</label>
                        <select id="productionWorker" disabled>
                            <option value="">প্রথমে বিভাগ নির্বাচন করুন</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="productionProductGroup">
                        <label for="productionProduct">পণ্য নির্বাচন *</label>
                        <select id="productionProduct">
                            <option value="">পণ্য নির্বাচন করুন</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="productionBalaProductGroup" style="display: none;">
                        <label for="productionBalaProduct">বালা প্রকার *</label>
                        <select id="productionBalaProduct">
                            <option value="regular">সাধারণ বালা</option>
                            <option value="special">বিশেষ বালা</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productionQuantity">পরিমাণ (পিচ) *</label>
                        <input type="number" id="productionQuantity" placeholder="পিচ সংখ্যা" min="1">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addProductionBtn">
                        <i class="fas fa-plus"></i> উৎপাদন যোগ করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3>সাধারণ শ্রমিক উপস্থিতি</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="attendanceDate">তারিখ *</label>
                        <input type="date" id="attendanceDate" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="generalWorker">সাধারণ শ্রমিক নির্বাচন *</label>
                        <select id="generalWorker">
                            <option value="">শ্রমিক নির্বাচন করুন</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="attendanceStatus">অবস্থা *</label>
                        <select id="attendanceStatus">
                            <option value="present">উপস্থিত</option>
                            <option value="absent">অনুপস্থিত</option>
                            <option value="leave">ছুটি</option>
                            <option value="half_day">আধা দিবস</option>
                            <option value="late">বিলম্বিত</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="attendanceRemarks">মন্তব্য</label>
                        <input type="text" id="attendanceRemarks" placeholder="যেকোনো বিশেষ মন্তব্য">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addAttendanceBtn">
                        <i class="fas fa-plus"></i> উপস্থিতি যোগ করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="data-controls">
                    <h3>উৎপাদন তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="productionSearch" placeholder="উৎপাদন খুঁজুন...">
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>তারিখ</th>
                            <th>শ্রমিক</th>
                            <th>পণ্য</th>
                            <th>পরিমাণ</th>
                            <th>বিভাগ</th>
                            <th>বেতন</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="productionTableBody">
                        <!-- উৎপাদন তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- স্টক ব্যবস্থাপনা ট্যাব -->
        <div id="stocks" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-warehouse"></i> স্টক ব্যবস্থাপনা
            </h2>
            
            <div class="stock-section">
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-box"></i> ১ম স্টক (ঢালাই)</h3>
                    <div class="stock-value" id="firstStockDetail">0 পিচ</div>
                    <div id="firstStockItems">
                        <!-- ১ম স্টকের আইটেমগুলো এখানে দেখাবে -->
                    </div>
                </div>
                
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-box"></i> ২য় স্টক (ঘষা)</h3>
                    <div class="stock-value" id="secondStockDetail">0 পিচ</div>
                    <div id="secondStockItems">
                        <!-- ২য় স্টকের আইটেমগুলো এখানে দেখাবে -->
                    </div>
                </div>
                
                <div class="stock-card">
                    <h3 class="stock-title"><i class="fas fa-box"></i> ৩য় স্টক (ছিলা)</h3>
                    <div class="stock-value" id="thirdStockDetail">0 পিচ</div>
                    <div id="thirdStockItems">
                        <!-- ৩য় স্টকের আইটেমগুলো এখানে দেখাবে -->
                    </div>
                </div>
                
                <div class="bala-stock-card">
                    <h3 class="stock-title"><i class="fas fa-cubes"></i> বালা স্টক</h3>
                    <div class="stock-value" id="balaStockDetail">0 পিচ</div>
                    <div id="balaStockItems">
                        <!-- বালা স্টকের আইটেমগুলো এখানে দেখাবে -->
                    </div>
                </div>
            </div>
            
            <!-- ফাইনাল স্টক তৈরীর নতুন ফর্ম -->
            <div class="card">
                <h3>ফাইনাল স্টক তৈরী করুন (৩য় স্টক থেকে ট্রান্সফার)</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="finalStockProduct">পণ্য নির্বাচন *</label>
                        <select id="finalStockProduct" onchange="updateBundleInputs()">
                            <option value="">পণ্য নির্বাচন করুন</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="totalBundles">মোট বান্ডিল সংখ্যা *</label>
                        <input type="number" id="totalBundles" placeholder="যেমন: 8" min="1" onchange="createBundleWeightInputs()">
                    </div>
                    
                    <div class="form-group">
                        <label for="piecesPerBundle">প্রতি বান্ডিলে পিচ সংখ্যা *</label>
                        <input type="number" id="piecesPerBundle" placeholder="যেমন: 30" min="1">
                    </div>
                </div>
                
                <!-- বান্ডিল ওজন ইনপুট সেকশন -->
                <div id="bundleWeightContainer" class="bundle-weight-container" style="display: none;">
                    <h4>প্রতি বান্ডিলের ওজন ইনপুট করুন (কেজি)</h4>
                    <div id="bundleWeightInputs" class="bundle-weight-inputs">
                        <!-- বান্ডিল ওজন ইনপুট এখানে তৈরি হবে -->
                    </div>
                    
                    <div id="weightSummary" class="weight-summary" style="display: none;">
                        <h4>ওজন সারাংশ</h4>
                        <div class="weight-summary-row">
                            <span>মোট ওজন:</span>
                            <span id="totalWeightDisplay">0.00 কেজি</span>
                        </div>
                        <div class="weight-summary-row">
                            <span>গড় ওজন:</span>
                            <span id="averageWeightDisplay">0.00 কেজি/বান্ডিল</span>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" id="createFinalStockBtn">
                        <i class="fas fa-file-archive"></i> ফাইনাল স্টক তৈরী করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3>ফাইনাল স্টক তালিকা</h3>
                <table>
                    <thead>
                        <tr>
                            <th>পণ্য</th>
                            <th>বান্ডিল সংখ্যা</th>
                            <th>মোট পিচ</th>
                            <th>মোট ওজন</th>
                            <th>গড় ওজন</th>
                            <th>তারিখ</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="finalStockTableBody">
                        <!-- ফাইনাল স্টক তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- বেতন ব্যবস্থাপনা ট্যাব -->
        <div id="salary" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-money-check-alt"></i> বেতন ব্যবস্থাপনা
            </h2>
            
            <div class="date-range">
                <div class="form-group">
                    <label for="salaryStartDate">শুরু তারিখ *</label>
                    <input type="date" id="salaryStartDate">
                </div>
                
                <div class="form-group">
                    <label for="salaryEndDate">শেষ তারিখ *</label>
                    <input type="date" id="salaryEndDate">
                </div>
                
                <div class="form-group">
                    <label for="salaryWorkerType">শ্রমিক প্রকার</label>
                    <select id="salaryWorkerType">
                        <option value="">সকল</option>
                        <option value="dhali">ঢালাই শ্রমিক</option>
                        <option value="ghosa">ঘষা মহিলা শ্রমিক</option>
                        <option value="chila">ছিলা শ্রমিক</option>
                        <option value="general">সাধারণ শ্রমিক</option>
                        <option value="bala_kata">বালা কাটা</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="calculateSalaryBtn">
                    <i class="fas fa-calculator"></i> বেতন হিসাব করুন
                </button>
            </div>
            
            <!-- নতুন: অগ্রীম বেতন সেকশন -->
            <div class="card" id="advancePaymentSection">
                <h3>অগ্রীম বেতন প্রদান</h3>
                <div class="advance-payment-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="advanceWorker">শ্রমিক নির্বাচন *</label>
                            <select id="advanceWorker">
                                <option value="">শ্রমিক নির্বাচন করুন</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="advanceAmount">অগ্রীম পরিমাণ (টাকা) *</label>
                            <input type="number" id="advanceAmount" placeholder="টাকায়" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="advanceDate">তারিখ *</label>
                            <input type="date" id="advanceDate" value="">
                        </div>
                        
                        <div class="form-group">
                            <label for="advanceRemarks">মন্তব্য</label>
                            <input type="text" id="advanceRemarks" placeholder="বিশেষ মন্তব্য (ঐচ্ছিক)">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-warning" id="giveAdvanceBtn">
                            <i class="fas fa-money-bill-wave"></i> অগ্রীম প্রদান করুন
                        </button>
                    </div>
                    
                    <!-- অগ্রীম বেতনের হিসাব দেখান -->
                    <div class="advance-history" id="advanceHistory" style="display: none;">
                        <h4>অগ্রীম বেতনের হিসাব</h4>
                        <div id="advanceHistoryContent">
                            <!-- অগ্রীম হিসাব এখানে দেখাবে -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>বেতন তালিকা</h3>
                <table>
                    <thead>
                        <tr>
                            <th>শ্রমিক</th>
                            <th>বিভাগ</th>
                            <th>পদবী</th>
                            <th>মোট কাজ</th>
                            <th>মোট বেতন</th>
                            <th>অগ্রীম বেতন</th>
                            <th>বকেয়া বেতন</th>
                            <th>অবস্থা</th>
                            <th>পরিশোধ তারিখ</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="salaryTableBody">
                        <!-- বেতন তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ক্রেতা ও বিক্রয় ট্যাব -->
        <div id="customers" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-user-tie"></i> ক্রেতা ও বিক্রয় ব্যবস্থাপনা
            </h2>
            
            <div class="card">
                <h3>নতুন ক্রেতা যোগ করুন</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">ক্রেতার নাম *</label>
                        <input type="text" id="customerName" placeholder="ক্রেতার পূর্ণ নাম">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerPhone">মোবাইল নম্বর</label>
                        <input type="text" id="customerPhone" placeholder="01XXXXXXXXX">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerAddress">ঠিকানা</label>
                        <textarea id="customerAddress" rows="2" placeholder="বিস্তারিত ঠিকানা"></textarea>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="addCustomerBtn">
                        <i class="fas fa-plus"></i> ক্রেতা যোগ করুন
                    </button>
                </div>
            </div>
            
            <!-- নতুন বিক্রয় সিস্টেম -->
            <div class="card">
                <h3>পণ্য বিক্রয় করুন</h3>
                
                <div id="saleStockWarning" class="stock-warning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span id="stockWarningText">ফাইনাল স্টকে পণ্য নেই। বিক্রয় করা যাবে না।</span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="saleCustomer">ক্রেতা নির্বাচন *</label>
                        <select id="saleCustomer" onchange="updateCustomerDueInfo()">
                            <option value="">ক্রেতা নির্বাচন করুন</option>
                        </select>
                    </div>
                </div>
                
                <!-- ক্রেতার বাকী তথ্য দেখান -->
                <div id="customerDueInfo" class="customer-due-info" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="customerDueText"></span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="saleDate">বিক্রয় তারিখ</label>
                        <input type="date" id="saleDate" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="salePaymentMethod">পেমেন্ট পদ্ধতি *</label>
                        <select id="salePaymentMethod">
                            <option value="cash">নগদ</option>
                            <option value="bank">ব্যাংক</option>
                            <option value="due">বাকী</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="saleBankGroup" style="display: none;">
                        <label for="saleBank">ব্যাংক নির্বাচন</label>
                        <select id="saleBank">
                            <option value="bank1">ইসলামী ব্যাংক</option>
                            <option value="bank2">সোনালী ব্যাংক</option>
                            <option value="bank3">ডাচ্ বাংলা ব্যাংক</option>
                        </select>
                    </div>
                </div>
                
                <!-- নতুন পণ্য নির্বাচন সিস্টেম -->
                <div class="card" style="margin-top: 20px;">
                    <h4>বিক্রয়কৃত পণ্যের তালিকা যোগ করুন</h4>
                    <p style="margin-bottom: 15px; color: #666;">"পণ্য নির্বাচন করুন" ক্লিক করে ফাইনাল স্টকের পণ্য তালিকা থেকে প্রতিটি বান্ডিল আলাদাভাবে নির্বাচন করুন</p>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="openFinalStockSelection()">
                            <i class="fas fa-box"></i> পণ্য নির্বাচন করুন
                        </button>
                        <button class="btn btn-warning" onclick="clearSelectedProducts()">
                            <i class="fas fa-trash"></i> নির্বাচিত পণ্য মুছুন
                        </button>
                    </div>
                    
                    <div id="selectedProductsContainer" style="margin-top: 20px;">
                        <!-- নির্বাচিত পণ্য এখানে দেখাবে -->
                    </div>
                    
                    <div class="invoice-total" style="margin-top: 20px;">
                        <div class="total-row">
                            <span class="total-label">মোট মূল্য:</span>
                            <span class="total-value" id="totalSaleAmount">0.00 টাকা</span>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" id="completeSaleBtn">
                        <i class="fas fa-check-circle"></i> বিক্রয় সম্পন্ন করুন ও Invoice তৈরী করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="data-controls">
                    <h3>বিক্রয় তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="salesSearch" placeholder="বিক্রয় খুঁজুন...">
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>তারিখ</th>
                            <th>ক্রেতা</th>
                            <th>পণ্য</th>
                            <th>বান্ডিল</th>
                            <th>ওজন</th>
                            <th>মূল্য</th>
                            <th>পেমেন্ট</th>
                            <th>Invoice</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <!-- বিক্রয় তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- বাকী টাকা জমা ট্যাব -->
        <div id="duePayments" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-money-bill-wave"></i> ক্রেতাদের বাকী টাকা জমা দিন
            </h2>
            
            <div class="card">
                <h3>ক্রেতা নির্বাচন করুন</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="duePaymentCustomer">ক্রেতা নির্বাচন *</label>
                        <select id="duePaymentCustomer" onchange="loadCustomerDueDetails()">
                            <option value="">ক্রেতা নির্বাচন করুন</option>
                        </select>
                    </div>
                </div>
                
                <!-- ক্রেতার বাকী তথ্য -->
                <div id="dueCustomerInfo" class="customer-due-info" style="display: none;">
                    <div id="dueCustomerDetails">
                        <!-- ক্রেতার বাকী তথ্য এখানে দেখাবে -->
                    </div>
                </div>
                
                <!-- বাকী টাকা জমার ফর্ম -->
                <div class="due-payment-section" id="duePaymentForm" style="display: none;">
                    <h3>বাকী টাকা জমা দিন</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="duePaymentAmount">জমার পরিমাণ (টাকা) *</label>
                            <input type="number" id="duePaymentAmount" placeholder="টাকায়" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="duePaymentMethod">পেমেন্ট পদ্ধতি *</label>
                            <select id="duePaymentMethod">
                                <option value="cash">নগদ</option>
                                <option value="bank">ব্যাংক</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="duePaymentBankGroup" style="display: none;">
                            <label for="duePaymentBank">ব্যাংক নির্বাচন</label>
                            <select id="duePaymentBank">
                                <option value="bank1">ইসলামী ব্যাংক</option>
                                <option value="bank2">সোনালী ব্যাংক</option>
                                <option value="bank3">ডাচ্ বাংলা ব্যাংক</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="duePaymentDate">তারিখ *</label>
                            <input type="date" id="duePaymentDate" value="">
                        </div>
                        
                        <div class="form-group">
                            <label for="duePaymentRemarks">মন্তব্য</label>
                            <input type="text" id="duePaymentRemarks" placeholder="বিশেষ মন্তব্য (ঐচ্ছিক)">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-success" id="submitDuePaymentBtn">
                            <i class="fas fa-money-bill-wave"></i> বাকী টাকা জমা দিন
                        </button>
                    </div>
                </div>
                
                <!-- জমার হিসাব -->
                <div class="due-payment-history" id="duePaymentHistory" style="display: none;">
                    <h4>জমার হিসাব</h4>
                    <div id="duePaymentHistoryContent">
                        <!-- জমার হিসাব এখানে দেখাবে -->
                    </div>
                </div>
            </div>
            
            <!-- সকল ক্রেতার বাকী তালিকা -->
            <div class="card">
                <h3>সকল ক্রেতার বাকী তালিকা</h3>
                <div id="allCustomersDueList">
                    <!-- সকল ক্রেতার বাকী তালিকা এখানে দেখাবে -->
                </div>
            </div>
        </div>
        
        <!-- অর্থ ব্যবস্থাপনা ট্যাব -->
        <div id="finance" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i> অর্থ ব্যবস্থাপনা
            </h2>
            
            <div class="card">
                <h3>নগদ ও ব্যাংক ব্যালেন্স</h3>
                <div class="form-row">
                    <div class="bank-card">
                        <h4>নগদ তহবিল</h4>
                        <div class="cash-balance" id="cashAmount">0 টাকা</div>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" id="addCashBtn">
                                <i class="fas fa-plus"></i> নগদ যোগ করুন
                            </button>
                            <button class="btn btn-warning btn-sm" id="withdrawCashBtn">
                                <i class="fas fa-minus"></i> নগদ উত্তোলন
                            </button>
                        </div>
                    </div>
                    
                    <div class="bank-card">
                        <h4 id="bank1Name">ইসলামী ব্যাংক</h4>
                        <div class="cash-balance" id="bank1Amount">0 টাকা</div>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" id="editBank1Btn">
                                <i class="fas fa-edit"></i> নাম পরিবর্তন
                            </button>
                            <button class="btn btn-success btn-sm" id="depositBank1Btn">
                                <i class="fas fa-plus"></i> জমা করুন
                            </button>
                        </div>
                    </div>
                    
                    <div class="bank-card">
                        <h4 id="bank2Name">সোনালী ব্যাংক</h4>
                        <div class="cash-balance" id="bank2Amount">0 টাকা</div>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" id="editBank2Btn">
                                <i class="fas fa-edit"></i> নাম পরিবর্তন
                            </button>
                            <button class="btn btn-success btn-sm" id="depositBank2Btn">
                                <i class="fas fa-plus"></i> জমা করুন
                            </button>
                        </div>
                    </div>
                    
                    <div class="bank-card">
                        <h4 id="bank3Name">ডাচ্ বাংলা ব্যাংক</h4>
                        <div class="cash-balance" id="bank3Amount">0 টাকা</div>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" id="editBank3Btn">
                                <i class="fas fa-edit"></i> নাম পরিবর্তন
                            </button>
                            <button class="btn btn-success btn-sm" id="depositBank3Btn">
                                <i class="fas fa-plus"></i> জমা করুন
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- নতুন: অন্যান্য খরচ অপশন -->
            <div class="card">
                <h3>অন্যান্য খরচ যোগ করুন</h3>
                <div class="other-expense-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expenseType">খরচের ধরন *</label>
                            <select id="expenseType">
                                <option value="">খরচ নির্বাচন করুন</option>
                                <option value="transport">ট্রান্সপোর্ট</option>
                                <option value="electricity">বিদ্যুৎ বিল</option>
                                <option value="gas">গ্যাস বিল</option>
                                <option value="repair">মেরামত</option>
                                <option value="raw_material">কাঁচামাল</option>
                                <option value="office">অফিস খরচ</option>
                                <option value="other">অন্যান্য</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="expenseAmount">পরিমাণ (টাকা) *</label>
                            <input type="number" id="expenseAmount" placeholder="টাকায়" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="expenseDate">তারিখ *</label>
                            <input type="date" id="expenseDate" value="">
                        </div>
                        
                        <div class="form-group">
                            <label for="expenseDescription">বর্ণনা</label>
                            <input type="text" id="expenseDescription" placeholder="খরচের বিস্তারিত">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-danger" id="addExpenseBtn">
                            <i class="fas fa-plus"></i> খরচ যোগ করুন
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>লেনদেন তালিকা</h3>
                <div class="date-range">
                    <div class="form-group">
                        <label for="transactionStartDate">শুরু তারিখ</label>
                        <input type="date" id="transactionStartDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="transactionEndDate">শেষ তারিখ</label>
                        <input type="date" id="transactionEndDate">
                    </div>
                    
                    <button class="btn btn-primary" id="filterTransactionsBtn">
                        <i class="fas fa-filter"></i> ফিল্টার করুন
                    </button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>তারিখ</th>
                            <th>বর্ণনা</th>
                            <th>ধরণ</th>
                            <th>পরিমাণ</th>
                            <th>ব্যালেন্স</th>
                            <th>পদ্ধতি</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTableBody">
                        <!-- লেনদেন তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- রিপোর্ট ট্যাব -->
        <div id="reports" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-file-alt"></i> রিপোর্ট ও প্রিন্ট
            </h2>
            
            <div class="card">
                <h3>রিপোর্ট জেনারেট করুন</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="reportType">রিপোর্ট প্রকার</label>
                        <select id="reportType">
                            <option value="production">উৎপাদন রিপোর্ট</option>
                            <option value="salary">বেতন রিপোর্ট</option>
                            <option value="sales">বিক্রয় রিপোর্ট</option>
                            <option value="stock">স্টক রিপোর্ট</option>
                            <option value="finance">আর্থিক রিপোর্ট</option>
                            <option value="customerDue">ক্রেতা বাকী রিপোর্ট</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportStartDate">শুরু তারিখ</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="reportEndDate">শেষ তারিখ</label>
                        <input type="date" id="reportEndDate">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="generateReportBtn">
                        <i class="fas fa-file-alt"></i> রিপোর্ট তৈরী করুন
                    </button>
                    <button class="btn btn-success" id="printReportBtn" style="display: none;">
                        <i class="fas fa-print"></i> প্রিন্ট করুন
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3>ডেটা ব্যবস্থাপনা</h3>
                <div class="btn-group">
                    <button class="btn btn-primary" id="saveDataBtn">
                        <i class="fas fa-save"></i> ডেটা সেভ করুন
                    </button>
                    <button class="btn btn-success" id="loadDataBtn">
                        <i class="fas fa-upload"></i> ডেটা আপলোড করুন
                    </button>
                    <button class="btn btn-warning" id="backupDataBtn">
                        <i class="fas fa-database"></i> ব্যাকআপ তৈরী করুন
                    </button>
                    <button class="btn btn-danger" id="resetDataBtn">
                        <i class="fas fa-trash-alt"></i> ডেটা রিসেট করুন
                    </button>
                </div>
                
                <input type="file" id="dataUploadInput" accept=".json" style="display: none;">
            </div>
            
            <div class="card">
                <h3>রিপোর্ট প্রিভিউ</h3>
                <div id="reportPreview">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        রিপোর্ট জেনারেট করতে উপরের ফর্ম পূরণ করুন
                    </p>
                </div>
            </div>
        </div>
        
        <!-- ইনভয়েস ট্যাব -->
        <div id="invoices" class="tab-content">
            <h2 class="section-title">
                <i class="fas fa-file-invoice"></i> ইনভয়েস ব্যবস্থাপনা
            </h2>
            
            <div class="card">
                <div class="data-controls">
                    <h3>সংরক্ষিত ইনভয়েস তালিকা</h3>
                    <div class="search-box">
                        <input type="text" id="invoiceSearch" placeholder="ইনভয়েস খুঁজুন...">
                        <button class="btn btn-primary" onclick="searchInvoices()" style="margin-left: 10px;">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Invoice No</th>
                            <th>তারিখ</th>
                            <th>ক্রেতা</th>
                            <th>মোট পণ্য</th>
                            <th>মোট ওজন</th>
                            <th>মোট মূল্য</th>
                            <th>পেমেন্ট</th>
                            <th>কর্ম</th>
                        </tr>
                    </thead>
                    <tbody id="invoicesTableBody">
                        <!-- ইনভয়েস তালিকা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h3>Invoice প্রিন্ট</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="invoiceNumberSearch">Invoice নম্বর</label>
                        <input type="text" id="invoiceNumberSearch" placeholder="Invoice নম্বর দিন">
                    </div>
                    <div class="form-group">
                        <label style="visibility: hidden;">খালি</label>
                        <button class="btn btn-primary" onclick="searchInvoiceByNumber()">
                            <i class="fas fa-search"></i> খুঁজুন
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ফুটার -->
        <div class="footer no-print">
            <p>Zafrul Metal - বগুড়া | মোবাইল: 01713706996</p>
            <p>© 2025 সকল স্বত্ব সংরক্ষিত | সফটওয়্যার ভার্সন 2.7 (বাকী বিক্রয় ও বাকী টাকা জমা ব্যবস্থা যোগ করা হয়েছে)</p>
        </div>
    </div>

    <!-- ফাইনাল স্টক নির্বাচন মডাল -->
    <div id="finalStockSelectionModal" class="final-stock-select-modal">
        <div class="final-stock-select-content">
            <span class="close-modal" onclick="closeFinalStockSelection()">&times;</span>
            <h3>ফাইনাল স্টক থেকে পণ্য নির্বাচন করুন</h3>
            <p style="margin-bottom: 15px;">নিচের তালিকা থেকে পণ্য নির্বাচন করুন। প্রতিটি বান্ডিল আলাদাভাবে নির্বাচন করতে পারবেন।</p>
            
            <!-- পণ্য তালিকা এখানে লোড হবে -->
            <div id="finalStockListContainer">
                <!-- ফাইনাল স্টক আইটেমগুলি এখানে লোড হবে -->
            </div>
            
            <div class="btn-group" style="margin-top: 20px; justify-content: center;">
                <button class="btn btn-success" onclick="confirmFinalStockSelection()">
                    <i class="fas fa-check"></i> নির্বাচন সম্পন্ন করুন
                </button>
                <button class="btn btn-danger" onclick="closeFinalStockSelection()">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeInvoiceModal()">&times;</span>
            <div id="invoiceContent">
                <!-- Invoice content will be generated here -->
            </div>
            <div class="btn-group" style="margin-top: 20px; justify-content: center;">
                <button class="btn btn-success" onclick="printInvoice()">
                    <i class="fas fa-print"></i> প্রিন্ট করুন
                </button>
                <button class="btn btn-primary" onclick="saveInvoice()">
                    <i class="fas fa-save"></i> সংরক্ষণ করুন
                </button>
                <button class="btn btn-danger" onclick="closeInvoiceModal()">
                    <i class="fas fa-times"></i> বন্ধ করুন
                </button>
            </div>
        </div>
    </div>

    <!-- Cash/Bank Modal -->
    <div id="cashModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">নগদ যোগ করুন</h3>
            <div class="form-group">
                <label id="modalAmountLabel">পরিমাণ (টাকা)</label>
                <input type="number" id="modalAmount" placeholder="টাকায়" min="1">
            </div>
            <div class="form-group" id="modalBankNameGroup" style="display: none;">
                <label>ব্যাংকের নাম</label>
                <input type="text" id="modalBankName" placeholder="ব্যাংকের নাম">
            </div>
            <div class="form-group">
                <label>বর্ণনা</label>
                <textarea id="modalDescription" rows="3" placeholder="লেনদেনের বিস্তারিত"></textarea>
            </div>
            <div class="form-group">
                <label>তারিখ</label>
                <input type="date" id="modalDate" value="">
            </div>
            <div class="btn-group">
                <button class="btn btn-success" id="modalConfirmBtn">
                    <i class="fas fa-check"></i> নিশ্চিত করুন
                </button>
                <button class="btn btn-danger" onclick="closeModal()">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
            </div>
        </div>
    </div>

    <!-- Advance Payment Modal -->
    <div id="advanceModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdvanceModal()">&times;</span>
            <h3>অগ্রীম বেতন প্রদান</h3>
            <div class="form-group">
                <label>পরিমাণ (টাকা)</label>
                <input type="number" id="advanceModalAmount" placeholder="টাকায়" min="1">
            </div>
            <div class="form-group">
                <label>তারিখ</label>
                <input type="date" id="advanceModalDate" value="">
            </div>
            <div class="form-group">
                <label>মন্তব্য</label>
                <textarea id="advanceModalRemarks" rows="3" placeholder="বিশেষ মন্তব্য"></textarea>
            </div>
            <div class="btn-group">
                <button class="btn btn-success" onclick="confirmAdvancePayment()">
                    <i class="fas fa-check"></i> নিশ্চিত করুন
                </button>
                <button class="btn btn-danger" onclick="closeAdvanceModal()">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
            </div>
        </div>
    </div>

    <!-- Due Payment Modal -->
    <div id="duePaymentModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDuePaymentModal()">&times;</span>
            <h3 id="duePaymentModalTitle">বাকী টাকা জমা দিন</h3>
            <div class="form-group">
                <label>ক্রেতার নাম</label>
                <input type="text" id="duePaymentModalCustomer" readonly>
            </div>
            <div class="form-group">
                <label>মোট বাকী</label>
                <input type="text" id="duePaymentModalTotalDue" readonly>
            </div>
            <div class="form-group">
                <label>জমার পরিমাণ (টাকা) *</label>
                <input type="number" id="duePaymentModalAmount" placeholder="টাকায়" min="1">
            </div>
            <div class="form-group">
                <label>পেমেন্ট পদ্ধতি *</label>
                <select id="duePaymentModalMethod">
                    <option value="cash">নগদ</option>
                    <option value="bank">ব্যাংক</option>
                </select>
            </div>
            <div class="form-group" id="duePaymentModalBankGroup" style="display: none;">
                <label>ব্যাংক নির্বাচন</label>
                <select id="duePaymentModalBank">
                    <option value="bank1">ইসলামী ব্যাংক</option>
                    <option value="bank2">সোনালী ব্যাংক</option>
                    <option value="bank3">ডাচ্ বাংলা ব্যাংক</option>
                </select>
            </div>
            <div class="form-group">
                <label>তারিখ *</label>
                <input type="date" id="duePaymentModalDate" value="">
            </div>
            <div class="form-group">
                <label>মন্তব্য</label>
                <textarea id="duePaymentModalRemarks" rows="3" placeholder="বিশেষ মন্তব্য"></textarea>
            </div>
            <div class="btn-group">
                <button class="btn btn-success" onclick="confirmDuePayment()">
                    <i class="fas fa-check"></i> জমা দিন
                </button>
                <button class="btn btn-danger" onclick="closeDuePaymentModal()">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
            </div>
        </div>
    </div>

    <script>
        // পাসওয়ার্ড সিস্টেম
        const PASSWORD = "645883";
        let autoSaveInterval;
        
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (input === PASSWORD) {
                document.getElementById('passwordProtection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initializeApp();
                startAutoSave();
            } else {
                errorDiv.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // Enter কী চাপলে পাসওয়ার্ড চেক করুন
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
        
        // প্রধান ডেটা স্ট্রাকচার
        let data = {
            workers: [],
            products: [],
            productions: [],
            attendances: [],
            stocks: {
                first: [],  // ঢালাই শ্রমিকের স্টক
                second: [], // ঘষা মহিলা শ্রমিকের স্টক
                third: [],  // ছিলা শ্রমিকের স্টক
                final: [],   // ফাইনাল স্টক (বিক্রয়ের জন্য প্রস্তুত)
                bala: []    // বালা স্টক
            },
            salaries: [],
            payments: [],
            advancePayments: [], // নতুন: অগ্রীম বেতন
            otherExpenses: [], // নতুন: অন্যান্য খরচ
            customers: [],
            sales: [],
            invoices: [],
            savedInvoices: [],
            duePayments: [], // নতুন: বাকী টাকা জমা
            finances: {
                cash: 0,
                banks: {
                    bank1: { name: "ইসলামী ব্যাংক", balance: 0 },
                    bank2: { name: "সোনালী ব্যাংক", balance: 0 },
                    bank3: { name: "ডাচ্ বাংলা ব্যাংক", balance: 0 }
                },
                transactions: []
            },
            settings: {
                lastInvoiceNo: 1000,
                lastSave: null
            },
            suppliers: [],
            rawMaterials: [],
            rawMaterialStock: 0,
            supplierDuePayments: []
        };

        // বিক্রয় সেশন ডেটা
        let saleSession = {
            customerId: null,
            selectedItems: [],
            selectedFinalStockItems: [], // ফাইনাল স্টক আইটেম স্টোর করে
            paymentMethod: 'cash',
            bank: null,
            saleDate: new Date().toISOString().split('T')[0],
            totalAmount: 0,
            tempSelectedStocks: [] // অস্থায়ীভাবে নির্বাচিত স্টক আইটেম স্টোর করে
        };

        // কারেন্ট এডিটিং আইটেম
        let currentEditId = null;
        let currentEditType = null;

        // Bundle weight input data
        let bundleWeights = [];

        // অগ্রীম বেতন কারেন্ট শ্রমিক
        let currentAdvanceWorkerId = null;

        // বাকী জমার কারেন্ট ক্রেতা
        let currentDueCustomerId = null;

        // ডকুমেন্ট রেডি ফাংশন
        document.addEventListener('DOMContentLoaded', function() {
            // শুধু পাসওয়ার্ড সিস্টেম ইনিশিয়ালাইজ করুন
            document.getElementById('passwordInput').focus();
            
            // লোকাল স্টোরেজ থেকে ডেটা লোড করুন
            loadFromLocalStorage();
        });

        // অ্যাপ ইনিশিয়ালাইজেশন
        function initializeApp() {
            // তারিখ ফিল্ডে আজকের তারিখ সেট করুন
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            document.getElementById('attendanceDate').value = today;
            document.getElementById('saleDate').value = today;
            document.getElementById('modalDate').value = today;
            document.getElementById('salaryStartDate').value = today;
            document.getElementById('salaryEndDate').value = today;
            document.getElementById('reportStartDate').value = today;
            document.getElementById('reportEndDate').value = today;
            document.getElementById('transactionStartDate').value = today;
            document.getElementById('transactionEndDate').value = today;
            document.getElementById('advanceDate').value = today;
            document.getElementById('expenseDate').value = today;
            document.getElementById('duePaymentDate').value = today;
            
            // ডিফল্ট পণ্য যোগ করুন
            addDefaultProducts();
            
            // বিক্রয় সেশনের তারিখ সেট করুন
            saleSession.saleDate = today;
            
            // Event listeners সেটআপ করুন
            setupEventListeners();
            
            // ডেটা লোড করুন
            loadFromLocalStorage();
            
            // ড্যাশবোর্ড আপডেট করুন
            updateDashboard();
            
            // তারিখ ও সময় আপডেট করুন
            updateDateTime();
            
            // বিক্রয়ের জন্য পণ্য লোড করুন
            loadProductsForSale();
            
            // বিক্রয় বাটন স্ট্যাটাস আপডেট করুন
            updateSaleButtonStatus();
            
            // অগ্রীম বেতনের জন্য শ্রমিক লোড করুন
            loadWorkersForAdvance();
            
            // বাকী টাকা জমার জন্য ক্রেতা লোড করুন
            loadCustomersForDuePayments();
            
            // শ্রমিক বিভাগ পরিবর্তন ইভেন্ট লিসেনার
            document.getElementById('workerCategory').addEventListener('change', function() {
                const category = this.value;
                const designationField = document.getElementById('workerDesignation');
                const salaryField = document.getElementById('workerDailyRate');
                
                if (category === 'general') {
                    designationField.disabled = false;
                    salaryField.disabled = false;
                } else {
                    designationField.disabled = true;
                    designationField.value = '';
                    salaryField.disabled = true;
                    salaryField.value = '';
                }
            });
            
            // উৎপাদন শ্রমিক বিভাগ পরিবর্তন ইভেন্ট লিসেনার
            document.getElementById('productionWorkerType').addEventListener('change', function() {
                const workerType = this.value;
                loadWorkersForProduction(workerType);
                
                // বালা কাটা শ্রমিকের জন্য পণ্য নির্বাচন পরিবর্তন
                if (workerType === 'bala_kata') {
                    document.getElementById('productionProductGroup').style.display = 'none';
                    document.getElementById('productionBalaProductGroup').style.display = 'block';
                } else {
                    document.getElementById('productionProductGroup').style.display = 'block';
                    document.getElementById('productionBalaProductGroup').style.display = 'none';
                }
            });
            
            // বিক্রয় পেমেন্ট পদ্ধতি পরিবর্তন ইভেন্ট লিসেনার
            document.getElementById('salePaymentMethod').addEventListener('change', function() {
                const method = this.value;
                if (method === 'bank') {
                    document.getElementById('saleBankGroup').style.display = 'block';
                } else {
                    document.getElementById('saleBankGroup').style.display = 'none';
                }
            });
            
            // বাকী জমার পেমেন্ট পদ্ধতি পরিবর্তন ইভেন্ট লিসেনার
            document.getElementById('duePaymentMethod').addEventListener('change', function() {
                const method = this.value;
                if (method === 'bank') {
                    document.getElementById('duePaymentBankGroup').style.display = 'block';
                } else {
                    document.getElementById('duePaymentBankGroup').style.display = 'none';
                }
            });
        }

        // অটো সেভ শুরু করুন
        function startAutoSave() {
            // প্রতি 30 সেকেন্ডে অটো সেভ
            autoSaveInterval = setInterval(function() {
                if (saveToLocalStorage()) {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('bn-BD', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    document.getElementById('lastSaveTime').textContent = timeStr;
                    data.settings.lastSave = now.toISOString();
                }
            }, 30000); // 30 seconds
            
            // প্রতি 5 মিনিটে নোটিফিকেশন দেখান
            setInterval(function() {
                showNotification('ডেটা অটো সেভ করা হয়েছে', 'success');
            }, 300000); // 5 minutes
        }

        // ডিফল্ট পণ্য যোগ করুন (কড়াই-০ থেকে কড়াই-২০ পর্যন্ত)
        function addDefaultProducts() {
            if (data.products.length === 0) {
                // কড়াই সিরিজ (0-20)
                for (let i = 0; i <= 20; i++) {
                    data.products.push({
                        id: generateId(),
                        name: `কড়াই-${i}`,
                        code: `KR${i.toString().padStart(2, '0')}`,
                        dhaliSalary: 6.50 + (i * 0.25),
                        ghosaSalary: 0.80,
                        chilaSalary: 5.00 + (i * 0.20),
                        sellingPrice: 200 + (i * 10),
                        createdAt: new Date().toISOString()
                    });
                }
                
                // তৈ সিরিজ (1-2)
                for (let i = 1; i <= 2; i++) {
                    data.products.push({
                        id: generateId(),
                        name: `তৈ-${i}`,
                        code: `TA${i.toString().padStart(2, '0')}`,
                        dhaliSalary: 7.00 + (i * 0.30),
                        ghosaSalary: 0.80,
                        chilaSalary: 6.00 + (i * 0.25),
                        sellingPrice: 180 + (i * 8),
                        createdAt: new Date().toISOString()
                    });
                }
                
                // তাওয়া
                data.products.push({
                    id: generateId(),
                    name: 'তাওয়া',
                    code: 'TW01',
                    dhaliSalary: 8.50,
                    ghosaSalary: 0.80,
                    chilaSalary: 7.00,
                    sellingPrice: 250,
                    createdAt: new Date().toISOString()
                });
                
                saveToLocalStorage();
                loadProducts();
            }
        }

        // ইভেন্ট লিসেনার সেটআপ
        function setupEventListeners() {
            // ট্যাব ক্লিক ইভেন্ট
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // দ্রুত কর্মসূচি বাটন
            document.getElementById('quickAddWorker').addEventListener('click', function() {
                switchTab('workers');
            });
            
            document.getElementById('quickAddProduct').addEventListener('click', function() {
                switchTab('products');
            });
            
            document.getElementById('quickAddProduction').addEventListener('click', function() {
                switchTab('production');
            });
            
            document.getElementById('quickSell').addEventListener('click', function() {
                switchTab('customers');
            });
            
            // শ্রমিক ব্যবস্থাপনা
            document.getElementById('addWorkerBtn').addEventListener('click', addWorker);
            document.getElementById('updateWorkerBtn').addEventListener('click', updateWorker);
            document.getElementById('cancelEditWorkerBtn').addEventListener('click', cancelEditWorker);
            document.getElementById('workerSearch').addEventListener('input', searchWorkers);
            
            // পণ্য ব্যবস্থাপনা
            document.getElementById('addProductBtn').addEventListener('click', addProduct);
            document.getElementById('updateProductBtn').addEventListener('click', updateProduct);
            document.getElementById('cancelEditProductBtn').addEventListener('click', cancelEditProduct);
            document.getElementById('productSearch').addEventListener('input', searchProducts);
            
            // দ্রুত পণ্য যোগ বাটন
            document.getElementById('addKoraiSeries').addEventListener('click', function() {
                for (let i = 0; i <= 20; i++) {
                    const productName = `কড়াই-${i}`;
                    if (!data.products.some(p => p.name === productName)) {
                        data.products.push({
                            id: generateId(),
                            name: productName,
                            code: `KR${i.toString().padStart(2, '0')}`,
                            dhaliSalary: 6.50 + (i * 0.25),
                            ghosaSalary: 0.80,
                            chilaSalary: 5.00 + (i * 0.20),
                            sellingPrice: 200 + (i * 10),
                            createdAt: new Date().toISOString()
                        });
                    }
                }
                saveToLocalStorage();
                loadProducts();
                showNotification('কড়াই সিরিজ যোগ করা হয়েছে!', 'success');
            });
            
            document.getElementById('addTaiSeries').addEventListener('click', function() {
                for (let i = 1; i <= 2; i++) {
                    const productName = `তৈ-${i}`;
                    if (!data.products.some(p => p.name === productName)) {
                        data.products.push({
                            id: generateId(),
                            name: productName,
                            code: `TA${i.toString().padStart(2, '0')}`,
                            dhaliSalary: 7.00 + (i * 0.30),
                            ghosaSalary: 0.80,
                            chilaSalary: 6.00 + (i * 0.25),
                            sellingPrice: 180 + (i * 8),
                            createdAt: new Date().toISOString()
                        });
                    }
                }
                saveToLocalStorage();
                loadProducts();
                showNotification('তৈ সিরিজ যোগ করা হয়েছে!', 'success');
            });
            
            document.getElementById('addTawa').addEventListener('click', function() {
                const productName = 'তাওয়া';
                if (!data.products.some(p => p.name === productName)) {
                    data.products.push({
                        id: generateId(),
                        name: productName,
                        code: 'TW01',
                        dhaliSalary: 8.50,
                        ghosaSalary: 0.80,
                        chilaSalary: 7.00,
                        sellingPrice: 250,
                        createdAt: new Date().toISOString()
                    });
                    saveToLocalStorage();
                    loadProducts();
                    showNotification('তাওয়া যোগ করা হয়েছে!', 'success');
                } else {
                    showNotification('তাওয়া ইতিমধ্যে আছে!', 'warning');
                }
            });
            
            // উৎপাদন এন্ট্রি
            document.getElementById('addProductionBtn').addEventListener('click', addProduction);
            document.getElementById('productionSearch').addEventListener('input', searchProductions);
            
            // উপস্থিতি
            document.getElementById('addAttendanceBtn').addEventListener('click', addAttendance);
            
            // ফাইনাল স্টক
            document.getElementById('createFinalStockBtn').addEventListener('click', createFinalStock);
            
            // বেতন ব্যবস্থাপনা
            document.getElementById('calculateSalaryBtn').addEventListener('click', calculateSalaries);
            
            // অগ্রীম বেতন
            document.getElementById('giveAdvanceBtn').addEventListener('click', giveAdvancePayment);
            document.getElementById('advanceWorker').addEventListener('change', function() {
                const workerId = this.value;
                if (workerId) {
                    currentAdvanceWorkerId = workerId;
                    showAdvanceHistory(workerId);
                }
            });
            
            // ক্রেতা ও বিক্রয়
            document.getElementById('addCustomerBtn').addEventListener('click', addCustomer);
            document.getElementById('saleCustomer').addEventListener('change', function() {
                const customerId = this.value;
                if (customerId) {
                    saleSession.customerId = customerId;
                    updateSaleButtonStatus();
                    updateCustomerDueInfo();
                } else {
                    saleSession.customerId = null;
                    updateSaleButtonStatus();
                    document.getElementById('customerDueInfo').style.display = 'none';
                }
            });
            
            document.getElementById('saleDate').addEventListener('change', function() {
                saleSession.saleDate = this.value;
            });
            
            document.getElementById('completeSaleBtn').addEventListener('click', completeSale);
            
            // বাকী টাকা জমা
            document.getElementById('submitDuePaymentBtn').addEventListener('click', submitDuePayment);
            document.getElementById('duePaymentCustomer').addEventListener('change', function() {
                const customerId = this.value;
                if (customerId) {
                    currentDueCustomerId = customerId;
                    loadCustomerDueDetails();
                }
            });
            
            // অর্থ ব্যবস্থাপনা
            document.getElementById('addCashBtn').addEventListener('click', function() {
                openCashModal('add', 'cash');
            });
            
            document.getElementById('withdrawCashBtn').addEventListener('click', function() {
                openCashModal('withdraw', 'cash');
            });
            
            document.getElementById('editBank1Btn').addEventListener('click', function() {
                openCashModal('edit', 'bank1');
            });
            
            document.getElementById('depositBank1Btn').addEventListener('click', function() {
                openCashModal('deposit', 'bank1');
            });
            
            document.getElementById('editBank2Btn').addEventListener('click', function() {
                openCashModal('edit', 'bank2');
            });
            
            document.getElementById('depositBank2Btn').addEventListener('click', function() {
                openCashModal('deposit', 'bank2');
            });
            
            document.getElementById('editBank3Btn').addEventListener('click', function() {
                openCashModal('edit', 'bank3');
            });
            
            document.getElementById('depositBank3Btn').addEventListener('click', function() {
                openCashModal('deposit', 'bank3');
            });
            
            document.getElementById('filterTransactionsBtn').addEventListener('click', filterTransactions);
            
            // অন্যান্য খরচ
            document.getElementById('addExpenseBtn').addEventListener('click', addOtherExpense);
            
            // মডাল বাটন
            document.getElementById('modalConfirmBtn').addEventListener('click', confirmModal);
            
            // রিপোর্ট
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            
            // ডেটা ব্যবস্থাপনা
            document.getElementById('saveDataBtn').addEventListener('click', manualSaveData);
            document.getElementById('loadDataBtn').addEventListener('click', function() {
                document.getElementById('dataUploadInput').click();
            });
            
            document.getElementById('dataUploadInput').addEventListener('change', loadDataFromFile);
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            
            // সাপ্লায়ার ব্যবস্থাপনা ইভেন্ট লিসেনার যোগ করুন
            document.getElementById('addSupplierBtn').addEventListener('click', addSupplier);
            document.getElementById('addRawMaterialBtn').addEventListener('click', addRawMaterial);
            document.getElementById('rawMaterialPaymentMethod').addEventListener('change', function() {
                const method = this.value;
                if (method === 'bank') {
                    document.getElementById('rawMaterialBankGroup').style.display = 'block';
                } else {
                    document.getElementById('rawMaterialBankGroup').style.display = 'none';
                }
            });
            
            // কাঁচামাল মোট মূল্য স্বয়ংক্রিয়ভাবে ক্যালকুলেট
            document.getElementById('rawMaterialQuantity').addEventListener('input', calculateRawMaterialTotal);
            document.getElementById('rawMaterialUnitPrice').addEventListener('input', calculateRawMaterialTotal);
        }

        // ট্যাব পরিবর্তন ফাংশন
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            switch(tabId) {
                case 'workers':
                    loadWorkers();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'production':
                    loadProductions();
                    loadWorkersForProduction('');
                    loadGeneralWorkers();
                    break;
                case 'stocks':
                    loadStocks();
                    loadFinalStockProducts();
                    break;
                case 'salary':
                    loadSalaries();
                    loadWorkersForAdvance();
                    break;
                case 'customers':
                    loadCustomers();
                    loadSales();
                    resetSaleSession();
                    updateSaleStockWarning();
                    break;
                case 'duePayments':
                    loadCustomersForDuePayments();
                    loadAllCustomersDueList();
                    break;
                case 'finance':
                    loadTransactions();
                    updateFinanceDisplay();
                    break;
                case 'invoices':
                    loadInvoices();
                    break;
                case 'suppliers':
                    loadSuppliers();
                    loadRawMaterials();
                    updateSupplierDashboard();
                    // তারিখ সেট করুন
                    document.getElementById('rawMaterialDate').value = new Date().toISOString().split('T')[0];
                    break;
            }
        }

        // বান্ডিল ওজন ইনপুট তৈরি করুন
        function createBundleWeightInputs() {
            const totalBundles = parseInt(document.getElementById('totalBundles').value) || 0;
            const container = document.getElementById('bundleWeightInputs');
            container.innerHTML = '';
            
            bundleWeights = [];
            
            if (totalBundles > 0) {
                for (let i = 1; i <= totalBundles; i++) {
                    const inputDiv = document.createElement('div');
                    inputDiv.className = 'bundle-weight-input';
                    inputDiv.innerHTML = `
                        <label for="bundleWeight${i}">বান্ডিল ${i} (কেজি)</label>
                        <input type="number" id="bundleWeight${i}" 
                               class="bundle-weight-input-field" 
                               min="0.1" step="0.01" 
                               placeholder="ওজন" 
                               oninput="calculateTotalWeight()">
                    `;
                    container.appendChild(inputDiv);
                    bundleWeights.push(0);
                }
                
                document.getElementById('bundleWeightContainer').style.display = 'block';
            } else {
                document.getElementById('bundleWeightContainer').style.display = 'none';
                document.getElementById('weightSummary').style.display = 'none';
            }
        }

        // মোট ওজন হিসাব করুন
        function calculateTotalWeight() {
            const totalBundles = parseInt(document.getElementById('totalBundles').value) || 0;
            let totalWeight = 0;
            let validCount = 0;
            
            for (let i = 1; i <= totalBundles; i++) {
                const weightInput = document.getElementById(`bundleWeight${i}`);
                if (weightInput) {
                    const weight = parseFloat(weightInput.value) || 0;
                    bundleWeights[i-1] = weight;
                    if (weight > 0) {
                        totalWeight += weight;
                        validCount++;
                    }
                }
            }
            
            if (validCount > 0) {
                const averageWeight = totalWeight / validCount;
                document.getElementById('totalWeightDisplay').textContent = totalWeight.toFixed(2) + ' কেজি';
                document.getElementById('averageWeightDisplay').textContent = averageWeight.toFixed(2) + ' কেজি/বান্ডিল';
                document.getElementById('weightSummary').style.display = 'block';
            } else {
                document.getElementById('weightSummary').style.display = 'none';
            }
            
            return totalWeight;
        }

        // ফাইনাল স্টক তৈরি করুন (নতুন সিস্টেম)
        function createFinalStock() {
            const productId = document.getElementById('finalStockProduct').value;
            const totalBundles = parseInt(document.getElementById('totalBundles').value);
            const piecesPerBundle = parseInt(document.getElementById('piecesPerBundle').value);
            
            if (!productId || !totalBundles || !piecesPerBundle) {
                showNotification('সকল ফিল্ড সঠিকভাবে পূরণ করুন!', 'error');
                return;
            }
            
            // বান্ডিল ওজন চেক করুন
            let totalWeight = 0;
            for (let i = 0; i < totalBundles; i++) {
                if (!bundleWeights[i] || bundleWeights[i] <= 0) {
                    showNotification(`বান্ডিল ${i+1} এর ওজন দিন!`, 'error');
                    return;
                }
                totalWeight += bundleWeights[i];
            }
            
            const product = data.products.find(p => p.id === productId);
            if (!product) {
                showNotification('পণ্য পাওয়া যায়নি!', 'error');
                return;
            }
            
            const stockItem = data.stocks.third.find(item => item.productId === productId);
            if (!stockItem || stockItem.quantity < (piecesPerBundle * totalBundles)) {
                showNotification('৩য় স্টকে পর্যাপ্ত পণ্য নেই!', 'error');
                return;
            }
            
            const totalPieces = piecesPerBundle * totalBundles;
            const averageWeight = totalWeight / totalBundles;
            
            // ৩য় স্টক থেকে কমানো
            stockItem.quantity -= totalPieces;
            if (stockItem.quantity === 0) {
                const index = data.stocks.third.findIndex(item => item.productId === productId);
                data.stocks.third.splice(index, 1);
            }
            
            // বালা স্টক থেকে বালা কমানো (প্রতি ২টি বালা ১ পিচ পণ্যের জন্য)
            const balaNeeded = totalPieces * 2;
            if (data.stocks.bala.length > 0) {
                let remainingBala = balaNeeded;
                for (let i = data.stocks.bala.length - 1; i >= 0; i--) {
                    const balaItem = data.stocks.bala[i];
                    if (balaItem.quantity >= remainingBala) {
                        balaItem.quantity -= remainingBala;
                        if (balaItem.quantity === 0) {
                            data.stocks.bala.splice(i, 1);
                        }
                        remainingBala = 0;
                        break;
                    } else {
                        remainingBala -= balaItem.quantity;
                        data.stocks.bala.splice(i, 1);
                    }
                }
                
                if (remainingBala > 0) {
                    showNotification('বালা স্টকে পর্যাপ্ত বালা নেই!', 'error');
                    return;
                }
            } else {
                showNotification('বালা স্টকে পর্যাপ্ত বালা নেই!', 'error');
                return;
            }
            
            // ফাইনাল স্টক তৈরি
            const finalStock = {
                id: generateId(),
                productId: productId,
                productName: product.name,
                totalBundles: totalBundles,
                piecesPerBundle: piecesPerBundle,
                totalPieces: totalPieces,
                totalWeight: totalWeight,
                averageWeight: averageWeight,
                bundleWeights: [...bundleWeights],
                createdAt: new Date().toISOString()
            };
            
            data.stocks.final.push(finalStock);
            saveToLocalStorage();
            
            // ফর্ম রিসেট
            document.getElementById('finalStockProduct').value = '';
            document.getElementById('totalBundles').value = '';
            document.getElementById('piecesPerBundle').value = '';
            document.getElementById('bundleWeightContainer').style.display = 'none';
            document.getElementById('weightSummary').style.display = 'none';
            bundleWeights = [];
            
            showNotification('ফাইনাল স্টক সফলভাবে তৈরী করা হয়েছে!', 'success');
            loadStocks();
            updateDashboard();
            updateSaleStockWarning();
        }

        // ফাইনাল স্টক নির্বাচন মডাল খুলুন
        function openFinalStockSelection() {
            // স্টক ওয়ার্নিং চেক করুন
            if (data.stocks.final.length === 0) {
                showNotification('ফাইনাল স্টকে কোন পণ্য নেই!', 'error');
                return;
            }
            
            // মডাল খুলুন
            document.getElementById('finalStockSelectionModal').style.display = 'block';
            
            // ফাইনাল স্টক লোড করুন (নতুন সিস্টেম - আলাদা বান্ডিল নির্বাচন)
            loadIndividualBundleSelection();
        }

        // আলাদা বান্ডিল নির্বাচন সিস্টেম লোড করুন
        function loadIndividualBundleSelection() {
            const container = document.getElementById('finalStockListContainer');
            container.innerHTML = '';
            
            if (data.stocks.final.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">ফাইনাল স্টকে কোন পণ্য নেই</p>';
                return;
            }
            
            // সেশন ডেটা রিসেট
            saleSession.tempSelectedStocks = [];
            
            // প্রতিটি ফাইনাল স্টক আইটেম দেখান
            data.stocks.final.forEach((stockItem, index) => {
                const product = data.products.find(p => p.id === stockItem.productId);
                if (!product) return;
                
                const stockDiv = document.createElement('div');
                stockDiv.className = 'final-stock-option';
                stockDiv.style.marginBottom = '15px';
                
                // হেডার
                stockDiv.innerHTML = `
                    <h4 class="product-group-title">${stockItem.productName} - আইটেম ${index + 1}</h4>
                    <p><strong>মোট বান্ডিল:</strong> ${stockItem.totalBundles} টি</p>
                    <p><strong>মোট পিচ:</strong> ${stockItem.totalPieces} পিচ</p>
                    <p><strong>মোট ওজন:</strong> ${stockItem.totalWeight.toFixed(2)} কেজি</p>
                    <p><strong>গড় ওজন:</strong> ${stockItem.averageWeight.toFixed(2)} কেজি/বান্ডিল</p>
                    <p><strong>প্রতি কেজি দাম:</strong> ${product.sellingPrice.toFixed(2)} টাকা</p>
                `;
                
                // বান্ডিল নির্বাচন সেকশন
                const bundleSelectionDiv = document.createElement('div');
                bundleSelectionDiv.className = 'individual-bundle-selection';
                bundleSelectionDiv.innerHTML = `<p><strong>বান্ডিল নির্বাচন করুন:</strong></p>`;
                
                // প্রতিটি বান্ডিলের জন্য চেকবক্স তৈরি করুন
                for (let i = 0; i < stockItem.totalBundles; i++) {
                    const bundleWeight = stockItem.bundleWeights[i] || stockItem.averageWeight;
                    const bundlePrice = bundleWeight * product.sellingPrice;
                    
                    // চেক করুন এই বান্ডিলটি ইতিমধ্যে নির্বাচন করা হয়েছে কিনা
                    const alreadySelected = saleSession.selectedFinalStockItems.some(item => 
                        item.finalStockId === stockItem.id && item.bundleNumbers.includes(i)
                    );
                    
                    const bundleDiv = document.createElement('div');
                    bundleDiv.className = `bundle-option ${alreadySelected ? 'selected' : ''}`;
                    bundleDiv.innerHTML = `
                        <input type="checkbox" class="bundle-checkbox" 
                               data-stock-id="${stockItem.id}" 
                               data-bundle-index="${i}"
                               data-bundle-weight="${bundleWeight}"
                               data-price-per-kg="${product.sellingPrice}"
                               ${alreadySelected ? 'disabled' : ''}>
                        <div class="bundle-details">
                            <p><strong>বান্ডিল ${i+1}:</strong> ${bundleWeight.toFixed(2)} কেজি</p>
                            <p>দাম: ${bundlePrice.toFixed(2)} টাকা</p>
                        </div>
                    `;
                    
                    if (!alreadySelected) {
                        bundleDiv.onclick = function(e) {
                            if (e.target.type === 'checkbox') return;
                            const checkbox = this.querySelector('.bundle-checkbox');
                            checkbox.checked = !checkbox.checked;
                            handleBundleSelection(checkbox);
                        };
                    }
                    
                    const checkbox = bundleDiv.querySelector('.bundle-checkbox');
                    checkbox.addEventListener('change', function() {
                        handleBundleSelection(this);
                    });
                    
                    bundleSelectionDiv.appendChild(bundleDiv);
                }
                
                stockDiv.appendChild(bundleSelectionDiv);
                container.appendChild(stockDiv);
            });
        }

        // বান্ডিল নির্বাচন হ্যান্ডেল করুন
        function handleBundleSelection(checkbox) {
            const stockId = checkbox.dataset.stockId;
            const bundleIndex = parseInt(checkbox.dataset.bundleIndex);
            const bundleWeight = parseFloat(checkbox.dataset.bundleWeight);
            const pricePerKg = parseFloat(checkbox.dataset.pricePerKg);
            
            const bundleDiv = checkbox.closest('.bundle-option');
            
            if (checkbox.checked) {
                bundleDiv.classList.add('selected');
                
                // টেম্পোরারি স্টোরেজে যোগ করুন
                const existingItem = saleSession.tempSelectedStocks.find(item => item.finalStockId === stockId);
                
                if (existingItem) {
                    existingItem.bundleNumbers.push(bundleIndex);
                    existingItem.totalBundles++;
                    existingItem.totalWeight += bundleWeight;
                    existingItem.totalPrice += (bundleWeight * pricePerKg);
                } else {
                    const stockItem = data.stocks.final.find(item => item.id === stockId);
                    const product = data.products.find(p => p.id === stockItem.productId);
                    
                    saleSession.tempSelectedStocks.push({
                        finalStockId: stockId,
                        productId: stockItem.productId,
                        productName: stockItem.productName,
                        bundleNumbers: [bundleIndex],
                        totalBundles: 1,
                        piecesPerBundle: stockItem.piecesPerBundle,
                        totalPieces: stockItem.piecesPerBundle,
                        totalWeight: bundleWeight,
                        sellingPrice: pricePerKg,
                        totalPrice: bundleWeight * pricePerKg,
                        bundleWeights: [bundleWeight]
                    });
                }
            } else {
                bundleDiv.classList.remove('selected');
                
                // টেম্পোরারি স্টোরেজ থেকে সরান
                const existingItemIndex = saleSession.tempSelectedStocks.findIndex(item => item.finalStockId === stockId);
                if (existingItemIndex !== -1) {
                    const existingItem = saleSession.tempSelectedStocks[existingItemIndex];
                    const bundleNumIndex = existingItem.bundleNumbers.indexOf(bundleIndex);
                    
                    if (bundleNumIndex !== -1) {
                        existingItem.bundleNumbers.splice(bundleNumIndex, 1);
                        existingItem.totalBundles--;
                        existingItem.totalWeight -= bundleWeight;
                        existingItem.totalPrice -= (bundleWeight * pricePerKg);
                        
                        // ওজন আপডেট
                        const weightIndex = existingItem.bundleNumbers.indexOf(bundleIndex);
                        if (weightIndex !== -1) {
                            existingItem.bundleWeights.splice(weightIndex, 1);
                        }
                        
                        // যদি সব বান্ডিল অপসারণ করা হয়
                        if (existingItem.bundleNumbers.length === 0) {
                            saleSession.tempSelectedStocks.splice(existingItemIndex, 1);
                        }
                    }
                }
            }
        }

        // ফাইনাল স্টক নির্বাচন মডাল বন্ধ করুন
        function closeFinalStockSelection() {
            document.getElementById('finalStockSelectionModal').style.display = 'none';
            saleSession.tempSelectedStocks = [];
        }

        // ফাইনাল স্টক নির্বাচন নিশ্চিত করুন
        function confirmFinalStockSelection() {
            if (saleSession.tempSelectedStocks.length === 0) {
                showNotification('কোন বান্ডিল নির্বাচন করা হয়নি!', 'error');
                return;
            }
            
            // নির্বাচিত আইটেমগুলি saleSession-এ যোগ করুন
            saleSession.tempSelectedStocks.forEach(tempItem => {
                // চেক করুন আইটেমটি ইতিমধ্যে আছে কিনা
                const existingIndex = saleSession.selectedFinalStockItems.findIndex(item => 
                    item.finalStockId === tempItem.finalStockId
                );
                
                if (existingIndex !== -1) {
                    // একই ফাইনাল স্টক আইটেমে নতুন বান্ডিল যোগ করুন
                    const existingItem = saleSession.selectedFinalStockItems[existingIndex];
                    
                    // নতুন বান্ডিল নম্বর যোগ করুন (ডুপ্লিকেট এড়ানোর জন্য)
                    tempItem.bundleNumbers.forEach(bundleNum => {
                        if (!existingItem.bundleNumbers.includes(bundleNum)) {
                            existingItem.bundleNumbers.push(bundleNum);
                        }
                    });
                    
                    // তথ্য আপডেট করুন
                    const stockItem = data.stocks.final.find(item => item.id === tempItem.finalStockId);
                    existingItem.totalBundles = existingItem.bundleNumbers.length;
                    existingItem.totalPieces = existingItem.totalBundles * existingItem.piecesPerBundle;
                    existingItem.totalWeight = existingItem.bundleNumbers.reduce((sum, num) => {
                        return sum + (stockItem.bundleWeights[num] || stockItem.averageWeight);
                    }, 0);
                    existingItem.totalPrice = existingItem.totalWeight * existingItem.sellingPrice;
                    
                } else {
                    // নতুন আইটেম যোগ করুন
                    saleSession.selectedFinalStockItems.push({...tempItem});
                }
            });
            
            // নির্বাচিত পণ্য দেখান
            displaySelectedProducts();
            
            // মডাল বন্ধ করুন
            closeFinalStockSelection();
            
            showNotification('বান্ডিল নির্বাচন সম্পন্ন হয়েছে!', 'success');
        }

        // নির্বাচিত পণ্য দেখান
        function displaySelectedProducts() {
            const container = document.getElementById('selectedProductsContainer');
            container.innerHTML = '';
            
            if (saleSession.selectedFinalStockItems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">কোন পণ্য নির্বাচন করা হয়নি</p>';
                updateSaleTotal();
                return;
            }
            
            // টেবিল তৈরি করুন
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.innerHTML = `
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="padding: 10px; border: 1px solid #ddd;">পণ্যের নাম</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">বান্ডিল সংখ্যা</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">মোট ওজন (কেজি)</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">প্রতি কেজি দাম</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">মোট দাম</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">কর্ম</th>
                    </tr>
                </thead>
                <tbody id="selectedProductsTableBody">
                </tbody>
            `;
            container.appendChild(table);
            
            const tbody = document.getElementById('selectedProductsTableBody');
            
            saleSession.selectedFinalStockItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.productName}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <input type="number" value="${item.totalBundles}" min="1" 
                               style="width: 80px; padding: 5px;" 
                               onchange="updateSelectedProductBundles(${index}, this.value)">
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <input type="number" value="${item.totalWeight.toFixed(2)}" min="0.1" step="0.01"
                               style="width: 100px; padding: 5px;"
                               onchange="updateSelectedProductWeight(${index}, this.value)">
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <input type="number" value="${item.sellingPrice.toFixed(2)}" min="0" step="0.01"
                               style="width: 100px; padding: 5px;"
                               onchange="updateSelectedProductPrice(${index}, this.value)">
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${item.totalPrice.toFixed(2)} টাকা</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <button class="btn btn-danger btn-sm" onclick="removeSelectedProduct(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updateSaleTotal();
        }

        // নির্বাচিত পণ্যের বান্ডিল আপডেট করুন
        function updateSelectedProductBundles(index, newBundles) {
            const item = saleSession.selectedFinalStockItems[index];
            const newBundlesNum = parseInt(newBundles);
            
            if (newBundlesNum < 1) {
                showNotification('বান্ডিল সংখ্যা 1 এর কম হতে পারবে না!', 'error');
                return;
            }
            
            // সর্বোচ্চ বান্ডিল সংখ্যা চেক করুন
            const stockItem = data.stocks.final.find(s => s.id === item.finalStockId);
            if (!stockItem) return;
            
            const maxBundles = stockItem.totalBundles;
            if (newBundlesNum > maxBundles) {
                showNotification(`সর্বোচ্চ ${maxBundles} বান্ডিল নির্বাচন করা যাবে!`, 'error');
                return;
            }
            
            // নতুন ওজন ক্যালকুলেট করুন (গড় ওজন ব্যবহার করে)
            const newWeight = (item.totalWeight / item.totalBundles) * newBundlesNum;
            
            // আইটেম আপডেট করুন
            item.totalBundles = newBundlesNum;
            item.totalWeight = newWeight;
            item.totalPieces = item.piecesPerBundle * newBundlesNum;
            item.totalPrice = item.totalWeight * item.sellingPrice;
            
            // ডিসপ্লে আপডেট করুন
            displaySelectedProducts();
        }

        // নির্বাচিত পণ্যের ওজন আপডেট করুন
        function updateSelectedProductWeight(index, newWeight) {
            const item = saleSession.selectedFinalStockItems[index];
            const newWeightNum = parseFloat(newWeight);
            
            if (newWeightNum < 0.1) {
                showNotification('ওজন 0.1 কেজির কম হতে পারবে না!', 'error');
                return;
            }
            
            // নতুন বান্ডিল সংখ্যা ক্যালকুলেট করুন
            const avgWeightPerBundle = item.totalWeight / item.totalBundles;
            const newBundles = Math.round(newWeightNum / avgWeightPerBundle);
            
            if (newBundles < 1) {
                showNotification('বান্ডিল সংখ্যা 1 এর কম হতে পারবে না!', 'error');
                return;
            }
            
            // সর্বোচ্চ বান্ডিল সংখ্যা চেক করুন
            const stockItem = data.stocks.final.find(s => s.id === item.finalStockId);
            if (!stockItem) return;
            
            const maxBundles = stockItem.totalBundles;
            if (newBundles > maxBundles) {
                showNotification(`সর্বোচ্চ ${maxBundles} বান্ডিলের ওজন নির্বাচন করা যাবে!`, 'error');
                return;
            }
            
            // আইটেম আপডেট করুন
            item.totalBundles = newBundles;
            item.totalWeight = newWeightNum;
            item.totalPieces = item.piecesPerBundle * newBundles;
            item.totalPrice = item.totalWeight * item.sellingPrice;
            
            // ডিসপ্লে আপডেট করুন
            displaySelectedProducts();
        }

        // নির্বাচিত পণ্যের দাম আপডেট করুন
        function updateSelectedProductPrice(index, newPrice) {
            const item = saleSession.selectedFinalStockItems[index];
            const newPriceNum = parseFloat(newPrice);
            
            if (newPriceNum < 0) {
                showNotification('দাম 0 এর কম হতে পারবে না!', 'error');
                return;
            }
            
            // আইটেম আপডেট করুন
            item.sellingPrice = newPriceNum;
            item.totalPrice = item.totalWeight * newPriceNum;
            
            // ডিসপ্লে আপডেট করুন
            displaySelectedProducts();
        }

        // নির্বাচিত পণ্য মুছুন
        function removeSelectedProduct(index) {
            saleSession.selectedFinalStockItems.splice(index, 1);
            displaySelectedProducts();
            showNotification('পণ্য তালিকা থেকে মুছে ফেলা হয়েছে!', 'success');
        }

        // নির্বাচিত সব পণ্য মুছুন
        function clearSelectedProducts() {
            if (saleSession.selectedFinalStockItems.length === 0) {
                showNotification('কোন পণ্য নির্বাচন করা হয়নি!', 'warning');
                return;
            }
            
            if (confirm('আপনি কি নিশ্চিত সব নির্বাচিত পণ্য মুছতে চান?')) {
                saleSession.selectedFinalStockItems = [];
                document.getElementById('selectedProductsContainer').innerHTML = 
                    '<p style="text-align: center; color: #666; padding: 20px;">কোন পণ্য নির্বাচন করা হয়নি</p>';
                updateSaleTotal();
                showNotification('সব নির্বাচিত পণ্য মুছে ফেলা হয়েছে!', 'success');
            }
        }

        // মোট বিক্রয় আপডেট করুন
        function updateSaleTotal() {
            let totalAmount = 0;
            
            saleSession.selectedFinalStockItems.forEach(item => {
                totalAmount += item.totalPrice;
            });
            
            saleSession.selectedItems = saleSession.selectedFinalStockItems.map(item => ({
                id: generateId(),
                productId: item.productId,
                productName: item.productName,
                bundles: item.totalBundles,
                weight: item.totalWeight,
                pricePerKg: item.sellingPrice,
                totalPrice: item.totalPrice,
                finalStockId: item.finalStockId,
                bundleNumbers: item.bundleNumbers || []
            }));
            
            document.getElementById('totalSaleAmount').textContent = `${totalAmount.toFixed(2)} টাকা`;
            saleSession.totalAmount = totalAmount;
            
            updateSaleButtonStatus();
        }

        // ক্রেতার বাকী তথ্য আপডেট করুন
        function updateCustomerDueInfo() {
            const customerId = saleSession.customerId;
            const dueInfoDiv = document.getElementById('customerDueInfo');
            const dueText = document.getElementById('customerDueText');
            
            if (!customerId) {
                dueInfoDiv.style.display = 'none';
                return;
            }
            
            const customer = data.customers.find(c => c.id === customerId);
            if (!customer) {
                dueInfoDiv.style.display = 'none';
                return;
            }
            
            if (customer.outstandingBalance > 0) {
                dueInfoDiv.style.display = 'block';
                dueText.textContent = `${customer.name} - মোট বাকী: ${customer.outstandingBalance.toFixed(2)} টাকা`;
            } else {
                dueInfoDiv.style.display = 'none';
            }
        }

        // বিক্রয় স্টক ওয়ার্নিং আপডেট করুন
        function updateSaleStockWarning() {
            const warningDiv = document.getElementById('saleStockWarning');
            
            if (data.stocks.final.length === 0) {
                warningDiv.style.display = 'flex';
                document.getElementById('stockWarningText').textContent = 
                    'ফাইনাল স্টকে কোন পণ্য নেই। বিক্রয় করা যাবে না।';
            } else {
                warningDiv.style.display = 'none';
            }
        }

        // বিক্রয় বাটন স্ট্যাটাস আপডেট করুন
        function updateSaleButtonStatus() {
            const completeBtn = document.getElementById('completeSaleBtn');
            
            if (saleSession.customerId && saleSession.selectedFinalStockItems.length > 0 && saleSession.totalAmount > 0) {
                completeBtn.disabled = false;
            } else {
                completeBtn.disabled = true;
            }
        }

        // বিক্রয় সেশন রিসেট করুন
        function resetSaleSession() {
            saleSession = {
                customerId: null,
                selectedItems: [],
                selectedFinalStockItems: [],
                paymentMethod: 'cash',
                bank: null,
                saleDate: new Date().toISOString().split('T')[0],
                totalAmount: 0,
                tempSelectedStocks: []
            };
            
            document.getElementById('saleCustomer').value = '';
            document.getElementById('saleDate').value = saleSession.saleDate;
            document.getElementById('salePaymentMethod').value = 'cash';
            document.getElementById('saleBankGroup').style.display = 'none';
            document.getElementById('customerDueInfo').style.display = 'none';
            
            // নির্বাচিত পণ্য কন্টেইনার রিসেট করুন
            document.getElementById('selectedProductsContainer').innerHTML = 
                '<p style="text-align: center; color: #666; padding: 20px;">কোন পণ্য নির্বাচন করা হয়নি</p>';
            
            updateSaleTotal();
            updateSaleButtonStatus();
            updateSaleStockWarning();
        }

        // সাপ্লায়ার যোগ করুন
        function addSupplier() {
            const name = document.getElementById('supplierName').value.trim();
            const phone = document.getElementById('supplierPhone').value.trim();
            const type = document.getElementById('supplierType').value;
            const address = document.getElementById('supplierAddress').value.trim();
            const email = document.getElementById('supplierEmail').value.trim();
            
            if (!name || !phone) {
                showNotification('সাপ্লায়ারের নাম ও মোবাইল নম্বর দিন!', 'error');
                return;
            }
            
            const supplier = {
                id: generateId(),
                name: name,
                phone: phone,
                type: type,
                address: address,
                email: email,
                totalPurchases: 0,
                totalAmount: 0,
                outstandingBalance: 0,
                createdAt: new Date().toISOString()
            };
            
            data.suppliers.push(supplier);
            saveToLocalStorage();
            loadSuppliers();
            clearSupplierForm();
            showNotification('সাপ্লায়ার যোগ করা হয়েছে!', 'success');
        }

        // কাঁচামাল ক্রয় এন্ট্রি যোগ করুন
        function addRawMaterial() {
            const date = document.getElementById('rawMaterialDate').value;
            const supplierId = document.getElementById('rawMaterialSupplier').value;
            const type = document.getElementById('rawMaterialType').value;
            const quantity = parseFloat(document.getElementById('rawMaterialQuantity').value);
            const unitPrice = parseFloat(document.getElementById('rawMaterialUnitPrice').value);
            const paymentMethod = document.getElementById('rawMaterialPaymentMethod').value;
            const bank = paymentMethod === 'bank' ? document.getElementById('rawMaterialBank').value : null;
            
            if (!date || !supplierId || !quantity || !unitPrice || !paymentMethod) {
                showNotification('সকল ফিল্ড পূরণ করুন!', 'error');
                return;
            }
            
            const totalPrice = quantity * unitPrice;
            const supplier = data.suppliers.find(s => s.id === supplierId);
            if (!supplier) {
                showNotification('সাপ্লায়ার পাওয়া যায়নি!', 'error');
                return;
            }
            
            // কাঁচামাল ক্রয় রেকর্ড করুন
            const rawMaterial = {
                id: generateId(),
                date: date,
                supplierId: supplierId,
                supplierName: supplier.name,
                type: type,
                quantity: quantity,
                unitPrice: unitPrice,
                totalPrice: totalPrice,
                paymentMethod: paymentMethod,
                bank: bank,
                createdAt: new Date().toISOString()
            };
            
            data.rawMaterials.push(rawMaterial);
            
            // সাপ্লায়ার তথ্য আপডেট করুন
            supplier.totalPurchases += 1;
            supplier.totalAmount += totalPrice;
            
            // কাঁচামাল স্টক আপডেট করুন
            data.rawMaterialStock += quantity;
            
            // পেমেন্ট অনুযায়ী আর্থিক ব্যবস্থাপনা আপডেট
            if (paymentMethod === 'cash') {
                // নগদ পেমেন্ট
                if (data.finances.cash < totalPrice) {
                    showNotification('নগদ তহবিলে পর্যাপ্ত টাকা নেই!', 'error');
                    // রোলব্যাক
                    data.rawMaterials.pop();
                    supplier.totalPurchases -= 1;
                    supplier.totalAmount -= totalPrice;
                    data.rawMaterialStock -= quantity;
                    return;
                }
                data.finances.cash -= totalPrice;
                
                // লেনদেন রেকর্ড
                const transaction = {
                    id: generateId(),
                    date: date,
                    description: `কাঁচামাল ক্রয়: ${supplier.name} - ${type === 'aluminum' ? 'এলুমিনিয়াম' : 'অন্যান্য'}`,
                    type: 'expense',
                    amount: totalPrice,
                    balance: data.finances.cash,
                    method: 'cash',
                    bank: null,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(transaction);
                
            } else if (paymentMethod === 'due') {
                // বাকি পেমেন্ট
                supplier.outstandingBalance += totalPrice;
                
            } else if (paymentMethod === 'bank' && bank) {
                // ব্যাংক পেমেন্ট
                if (data.finances.banks[bank].balance < totalPrice) {
                    showNotification(`${data.finances.banks[bank].name} ব্যাংকে পর্যাপ্ত টাকা নেই!`, 'error');
                    // রোলব্যাক
                    data.rawMaterials.pop();
                    supplier.totalPurchases -= 1;
                    supplier.totalAmount -= totalPrice;
                    data.rawMaterialStock -= quantity;
                    return;
                }
                data.finances.banks[bank].balance -= totalPrice;
                
                // লেনদেন রেকর্ড
                const transaction = {
                    id: generateId(),
                    date: date,
                    description: `কাঁচামাল ক্রয়: ${supplier.name} - ${type === 'aluminum' ? 'এলুমিনিয়াম' : 'অন্যান্য'}`,
                    type: 'expense',
                    amount: totalPrice,
                    balance: data.finances.banks[bank].balance,
                    method: 'bank',
                    bank: bank,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(transaction);
            }
            
            saveToLocalStorage();
            clearRawMaterialForm();
            showNotification('কাঁচামাল ক্রয় এন্ট্রি যোগ করা হয়েছে!', 'success');
            loadSuppliers();
            loadRawMaterials();
            updateSupplierDashboard();
        }

        // মোট মূল্য ক্যালকুলেট করুন
        function calculateRawMaterialTotal() {
            const quantity = parseFloat(document.getElementById('rawMaterialQuantity').value) || 0;
            const unitPrice = parseFloat(document.getElementById('rawMaterialUnitPrice').value) || 0;
            const totalPrice = quantity * unitPrice;
            
            document.getElementById('rawMaterialTotalPrice').value = totalPrice.toFixed(2);
        }

        // সাপ্লায়ার ফর্ম ক্লিয়ার করুন
        function clearSupplierForm() {
            document.getElementById('supplierName').value = '';
            document.getElementById('supplierPhone').value = '';
            document.getElementById('supplierType').value = 'regular';
            document.getElementById('supplierAddress').value = '';
            document.getElementById('supplierEmail').value = '';
        }

        // কাঁচামাল ফর্ম ক্লিয়ার করুন
        function clearRawMaterialForm() {
            document.getElementById('rawMaterialDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('rawMaterialSupplier').value = '';
            document.getElementById('rawMaterialType').value = 'aluminum';
            document.getElementById('rawMaterialQuantity').value = '';
            document.getElementById('rawMaterialUnitPrice').value = '';
            document.getElementById('rawMaterialTotalPrice').value = '';
            document.getElementById('rawMaterialPaymentMethod').value = 'cash';
            document.getElementById('rawMaterialBankGroup').style.display = 'none';
            document.getElementById('rawMaterialBank').value = 'bank1';
        }

        // সাপ্লায়ার লোড করুন
        function loadSuppliers() {
            const select = document.getElementById('rawMaterialSupplier');
            select.innerHTML = '<option value="">সাপ্লায়ার নির্বাচন করুন</option>';
            
            const tbody = document.getElementById('suppliersTableBody');
            tbody.innerHTML = '';
            
            if (data.suppliers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">কোন সাপ্লায়ার যোগ করা হয়নি</td></tr>';
                return;
            }
            
            data.suppliers.forEach((supplier, index) => {
                // ড্রপডাউনে যোগ
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = `${supplier.name} (${supplier.phone})`;
                select.appendChild(option);
                
                // টেবিলে যোগ
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${supplier.name}</td>
                    <td>${supplier.phone}</td>
                    <td>${supplier.type === 'regular' ? 'নিয়মিত' : 'অস্থায়ী'}</td>
                    <td>${supplier.address || 'নাই'}</td>
                    <td>${supplier.totalPurchases} বার</td>
                    <td>${supplier.outstandingBalance > 0 ? `<span style="color: #e74c3c; font-weight: bold;">${supplier.outstandingBalance.toFixed(2)} টাকা</span>` : '0.00 টাকা'}</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="editSupplier('${supplier.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteSupplier('${supplier.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // কাঁচামাল ক্রয় লোড করুন
        function loadRawMaterials() {
            const tbody = document.getElementById('rawMaterialsTableBody');
            tbody.innerHTML = '';
            
            if (data.rawMaterials.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">কোন কাঁচামাল ক্রয় রেকর্ড নেই</td></tr>';
                return;
            }
            
            data.rawMaterials.forEach((material, index) => {
                const paymentText = material.paymentMethod === 'cash' ? 'নগদ' : 
                                   material.paymentMethod === 'due' ? 'বাকি' : 
                                   'ব্যাংক';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(material.date)}</td>
                    <td>${material.supplierName}</td>
                    <td>${material.type === 'aluminum' ? 'এলুমিনিয়াম' : 'অন্যান্য'}</td>
                    <td>${material.quantity.toFixed(2)} কেজি</td>
                    <td>${material.unitPrice.toFixed(2)} টাকা</td>
                    <td>${material.totalPrice.toFixed(2)} টাকা</td>
                    <td>${paymentText}</td>
                    <td class="data-actions">
                        <button class="action-btn delete-btn" onclick="deleteRawMaterial('${material.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // সাপ্লায়ার ড্যাশবোর্ড আপডেট করুন
        function updateSupplierDashboard() {
            document.getElementById('rawMaterialStock').textContent = `${data.rawMaterialStock.toFixed(2)} কেজি`;
            
            const totalDue = data.suppliers.reduce((sum, supplier) => sum + supplier.outstandingBalance, 0);
            document.getElementById('supplierDueAmount').textContent = `${totalDue.toFixed(2)} টাকা`;
        }

        // সাপ্লায়ার ডিলিট করুন
        function deleteSupplier(id) {
            if (confirm('আপনি কি নিশ্চিত এই সাপ্লায়ার ডিলিট করতে চান?')) {
                const index = data.suppliers.findIndex(s => s.id === id);
                if (index !== -1) {
                    const supplier = data.suppliers[index];
                    
                    // যদি বাকি টাকা থাকে
                    if (supplier.outstandingBalance > 0) {
                        if (!confirm(`এই সাপ্লায়ারের ${supplier.outstandingBalance.toFixed(2)} টাকা বাকি আছে। তবুও ডিলিট করতে চান?`)) {
                            return;
                        }
                    }
                    
                    data.suppliers.splice(index, 1);
                    saveToLocalStorage();
                    loadSuppliers();
                    updateSupplierDashboard();
                    showNotification('সাপ্লায়ার ডিলিট করা হয়েছে!', 'success');
                }
            }
        }

        // কাঁচামাল ক্রয় ডিলিট করুন
        function deleteRawMaterial(id) {
            if (confirm('আপনি কি নিশ্চিত এই কাঁচামাল ক্রয় রেকর্ড ডিলিট করতে চান?')) {
                const index = data.rawMaterials.findIndex(rm => rm.id === id);
                if (index !== -1) {
                    const material = data.rawMaterials[index];
                    
                    // সাপ্লায়ার তথ্য আপডেট
                    const supplier = data.suppliers.find(s => s.id === material.supplierId);
                    if (supplier) {
                        supplier.totalPurchases -= 1;
                        supplier.totalAmount -= material.totalPrice;
                        
                        // যদি বাকি পেমেন্ট হয়, তাহলে বাকি টাকা কমানো
                        if (material.paymentMethod === 'due') {
                            supplier.outstandingBalance -= material.totalPrice;
                            if (supplier.outstandingBalance < 0) {
                                supplier.outstandingBalance = 0;
                            }
                        }
                    }
                    
                    // কাঁচামাল স্টক আপডেট
                    data.rawMaterialStock -= material.quantity;
                    if (data.rawMaterialStock < 0) {
                        data.rawMaterialStock = 0;
                    }
                    
                    // পেমেন্ট রিভার্স (যদি নগদ বা ব্যাংক হয়)
                    if (material.paymentMethod === 'cash') {
                        data.finances.cash += material.totalPrice;
                        
                        // লেনদেন রিভার্স
                        const transactionIndex = data.finances.transactions.findIndex(t => 
                            t.description.includes(material.supplierName) && 
                            t.amount === material.totalPrice &&
                            Math.abs(t.date - material.date) < 86400000
                        );
                        
                        if (transactionIndex !== -1) {
                            data.finances.transactions.splice(transactionIndex, 1);
                        }
                        
                    } else if (material.paymentMethod === 'bank' && material.bank) {
                        data.finances.banks[material.bank].balance += material.totalPrice;
                        
                        // লেনদেন রিভার্স
                        const transactionIndex = data.finances.transactions.findIndex(t => 
                            t.description.includes(material.supplierName) && 
                            t.amount === material.totalPrice &&
                            t.method === 'bank' &&
                            t.bank === material.bank
                        );
                        
                        if (transactionIndex !== -1) {
                            data.finances.transactions.splice(transactionIndex, 1);
                        }
                    }
                    
                    data.rawMaterials.splice(index, 1);
                    saveToLocalStorage();
                    loadRawMaterials();
                    loadSuppliers();
                    updateSupplierDashboard();
                    showNotification('কাঁচামাল ক্রয় রেকর্ড ডিলিট করা হয়েছে!', 'success');
                }
            }
        }

        // ফাইনাল স্টক তৈরিতে কাঁচামাল ব্যয় স্বয়ংক্রিয়ভাবে গণনা
        function updateRawMaterialStockOnFinalStock(finalStock) {
            // ফাইনাল স্টকের মোট ওজন
            const totalWeight = finalStock.totalWeight;
            
            // কাঁচামাল স্টক থেকে বিয়োগ
            data.rawMaterialStock -= totalWeight;
            
            // যদি কাঁচামাল স্টক ঋণাত্মক হয়, শূন্যতে সেট করুন
            if (data.rawMaterialStock < 0) {
                data.rawMaterialStock = 0;
            }
            
            saveToLocalStorage();
            updateSupplierDashboard();
        }

        // শ্রমিক যোগ করুন
        function addWorker() {
            const name = document.getElementById('workerName').value.trim();
            const phone = document.getElementById('workerPhone').value.trim();
            const category = document.getElementById('workerCategory').value;
            const designation = document.getElementById('workerDesignation').value;
            const address = document.getElementById('workerAddress').value.trim();
            const dailyRate = parseFloat(document.getElementById('workerDailyRate').value) || 0;
            
            if (!name || !category) {
                showNotification('শ্রমিকের নাম ও বিভাগ পূরণ করুন!', 'error');
                return;
            }
            
            if (category === 'general' && !designation) {
                showNotification('সাধারণ শ্রমিকের জন্য পদবী নির্বাচন করুন!', 'error');
                return;
            }
            
            if (category === 'general' && dailyRate <= 0) {
                showNotification('সাধারণ শ্রমিকের জন্য দৈনিক বেতন দিন!', 'error');
                return;
            }
            
            if (phone && !/^01[3-9]\d{8}$/.test(phone)) {
                showNotification('সঠিক মোবাইল নম্বর দিন!', 'error');
                return;
            }
            
            const worker = {
                id: generateId(),
                name: name,
                phone: phone,
                category: category,
                designation: category === 'general' ? designation : '',
                address: address,
                dailyRate: category === 'general' ? dailyRate : 0,
                createdAt: new Date().toISOString(),
                active: true
            };
            
            data.workers.push(worker);
            saveToLocalStorage();
            loadWorkers();
            clearWorkerForm();
            showNotification('শ্রমিক সফলভাবে যোগ করা হয়েছে!', 'success');
            updateDashboard();
        }

        // শ্রমিক আপডেট করুন
        function updateWorker() {
            if (!currentEditId) return;
            
            const name = document.getElementById('workerName').value.trim();
            const phone = document.getElementById('workerPhone').value.trim();
            const category = document.getElementById('workerCategory').value;
            const designation = document.getElementById('workerDesignation').value;
            const address = document.getElementById('workerAddress').value.trim();
            const dailyRate = parseFloat(document.getElementById('workerDailyRate').value) || 0;
            
            if (!name || !category) {
                showNotification('শ্রমিকের নাম ও বিভাগ পূরণ করুন!', 'error');
                return;
            }
            
            if (category === 'general' && !designation) {
                showNotification('সাধারণ শ্রমিকের জন্য পদবী নির্বাচন করুন!', 'error');
                return;
            }
            
            if (category === 'general' && dailyRate <= 0) {
                showNotification('সাধারণ শ্রমিকের জন্য দৈনিক বেতন দিন!', 'error');
                return;
            }
            
            const index = data.workers.findIndex(w => w.id === currentEditId);
            if (index !== -1) {
                data.workers[index].name = name;
                data.workers[index].phone = phone;
                data.workers[index].category = category;
                data.workers[index].designation = category === 'general' ? designation : '';
                data.workers[index].address = address;
                data.workers[index].dailyRate = category === 'general' ? dailyRate : 0;
                
                saveToLocalStorage();
                loadWorkers();
                clearWorkerForm();
                showNotification('শ্রমিক সফলভাবে আপডেট করা হয়েছে!', 'success');
                updateDashboard();
            }
        }

        // শ্রমিক এডিট বাতিল করুন
        function cancelEditWorker() {
            clearWorkerForm();
        }

        // শ্রমিক ফর্ম ক্লিয়ার করুন
        function clearWorkerForm() {
            document.getElementById('workerName').value = '';
            document.getElementById('workerPhone').value = '';
            document.getElementById('workerCategory').value = '';
            document.getElementById('workerDesignation').value = '';
            document.getElementById('workerDesignation').disabled = true;
            document.getElementById('workerAddress').value = '';
            document.getElementById('workerDailyRate').value = '';
            document.getElementById('workerDailyRate').disabled = true;
            
            document.getElementById('addWorkerBtn').style.display = 'inline-flex';
            document.getElementById('updateWorkerBtn').style.display = 'none';
            document.getElementById('cancelEditWorkerBtn').style.display = 'none';
            
            currentEditId = null;
        }

        // শ্রমিক লোড করুন
        function loadWorkers() {
            const tbody = document.getElementById('workersTableBody');
            tbody.innerHTML = '';
            
            if (data.workers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">কোন শ্রমিক যোগ করা হয়নি</td></tr>';
                return;
            }
            
            data.workers.forEach((worker, index) => {
                const categoryNames = {
                    'dhali': 'ঢালাই শ্রমিক',
                    'ghosa': 'ঘষা মহিলা শ্রমিক',
                    'chila': 'ছিলা শ্রমিক',
                    'general': 'সাধারণ শ্রমিক',
                    'bala_kata': 'বালা কাটা'
                };
                
                const designationNames = {
                    'managing_director': 'ম্যনেজিং ডাইরেক্টর',
                    'manager': 'ম্যনেজার',
                    'office_assistant': 'অফিস সহকারী',
                    'security_guard': 'দারোয়ান/গার্ড',
                    'night_guard': 'নাইট গার্ড',
                    'driver': 'ড্রাইভার',
                    'computer_operator': 'কম্পিউটার অপারেটর',
                    'repeater': 'রিপিটার',
                    'bandha_mahila': 'বাঁধা মহিলা',
                    'bed_mahila': 'বেড মহিলা',
                    'chula_mistri': 'চুলা মিস্তিরি',
                    'chula_helper': 'চুলা হেলপার',
                    'labor': 'লেবার',
                    'lalikata': 'ললিকাটা',
                    'delivery_man': 'ডেলিভারি ম্যান'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${worker.name}</td>
                    <td>${worker.phone || 'নাই'}</td>
                    <td>${categoryNames[worker.category] || worker.category}</td>
                    <td>${designationNames[worker.designation] || worker.designation || 'নাই'}</td>
                    <td>${worker.address || 'নাই'}</td>
                    <td>${worker.dailyRate > 0 ? worker.dailyRate.toFixed(2) + ' টাকা/দিন' : 'নাই'}</td>
                    <td>${formatDate(worker.createdAt)}</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="editWorker('${worker.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteWorker('${worker.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // শ্রমিক খুঁজুন
        function searchWorkers() {
            const query = document.getElementById('workerSearch').value.toLowerCase();
            const tbody = document.getElementById('workersTableBody');
            tbody.innerHTML = '';
            
            let filteredWorkers = data.workers.filter(worker => 
                worker.name.toLowerCase().includes(query) ||
                (worker.phone && worker.phone.includes(query)) ||
                worker.category.toLowerCase().includes(query)
            );
            
            if (filteredWorkers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">কোন শ্রমিক পাওয়া যায়নি</td></tr>';
                return;
            }
            
            filteredWorkers.forEach((worker, index) => {
                const categoryNames = {
                    'dhali': 'ঢালাই শ্রমিক',
                    'ghosa': 'ঘষা মহিলা শ্রমিক',
                    'chila': 'ছিলা শ্রমিক',
                    'general': 'সাধারণ শ্রমিক',
                    'bala_kata': 'বালা কাটা'
                };
                
                const designationNames = {
                    'managing_director': 'ম্যনেজিং ডাইরেক্টর',
                    'manager': 'ম্যনেজার',
                    'office_assistant': 'অফিস সহকারী',
                    'security_guard': 'দারোয়ান/গার্ড',
                    'night_guard': 'নাইট গার্ড',
                    'driver': 'ড্রাইভার',
                    'computer_operator': 'কম্পিউটার অপারেটর',
                    'repeater': 'রিপিটার',
                    'bandha_mahila': 'বাঁধা মহিলা',
                    'bed_mahila': 'বেড মহিলা',
                    'chula_mistri': 'চুলা মিস্তিরি',
                    'chula_helper': 'চুলা হেলপার',
                    'labor': 'লেবার',
                    'lalikata': 'ললিকাটা',
                    'delivery_man': 'ডেলিভারি ম্যান'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${worker.name}</td>
                    <td>${worker.phone || 'নাই'}</td>
                    <td>${categoryNames[worker.category] || worker.category}</td>
                    <td>${designationNames[worker.designation] || worker.designation || 'নাই'}</td>
                    <td>${worker.address || 'নাই'}</td>
                    <td>${worker.dailyRate > 0 ? worker.dailyRate.toFixed(2) + ' টাকা/দিন' : 'নাই'}</td>
                    <td>${formatDate(worker.createdAt)}</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="editWorker('${worker.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteWorker('${worker.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // শ্রমিক এডিট করুন
        function editWorker(id) {
            const worker = data.workers.find(w => w.id === id);
            if (!worker) return;
            
            document.getElementById('workerName').value = worker.name;
            document.getElementById('workerPhone').value = worker.phone || '';
            document.getElementById('workerCategory').value = worker.category;
            document.getElementById('workerDesignation').value = worker.designation || '';
            document.getElementById('workerAddress').value = worker.address || '';
            document.getElementById('workerDailyRate').value = worker.dailyRate || '';
            
            const designationField = document.getElementById('workerDesignation');
            const salaryField = document.getElementById('workerDailyRate');
            
            if (worker.category === 'general') {
                designationField.disabled = false;
                salaryField.disabled = false;
            } else {
                designationField.disabled = true;
                salaryField.disabled = true;
            }
            
            document.getElementById('addWorkerBtn').style.display = 'none';
            document.getElementById('updateWorkerBtn').style.display = 'inline-flex';
            document.getElementById('cancelEditWorkerBtn').style.display = 'inline-flex';
            
            currentEditId = id;
        }

        // শ্রমিক ডিলিট করুন
        function deleteWorker(id) {
            if (confirm('আপনি কি নিশ্চিত এই শ্রমিক ডিলিট করতে চান?')) {
                const index = data.workers.findIndex(w => w.id === id);
                if (index !== -1) {
                    data.workers.splice(index, 1);
                    saveToLocalStorage();
                    loadWorkers();
                    showNotification('শ্রমিক ডিলিট করা হয়েছে!', 'success');
                    updateDashboard();
                }
            }
        }

        // পণ্য যোগ করুন
        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const code = document.getElementById('productCode').value.trim();
            const dhaliSalary = parseFloat(document.getElementById('dhaliSalary').value) || 0;
            const ghosaSalary = parseFloat(document.getElementById('ghosaSalary').value) || 0;
            const chilaSalary = parseFloat(document.getElementById('chilaSalary').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
            
            if (!name) {
                showNotification('পণ্যের নাম পূরণ করুন!', 'error');
                return;
            }
            
            let productCode = code;
            if (!productCode) {
                productCode = generateProductCode(name);
            }
            
            if (data.products.some(p => p.name === name)) {
                showNotification('এই নামের পণ্য ইতিমধ্যে আছে!', 'error');
                return;
            }
            
            const product = {
                id: generateId(),
                name: name,
                code: productCode,
                dhaliSalary: dhaliSalary,
                ghosaSalary: ghosaSalary,
                chilaSalary: chilaSalary,
                sellingPrice: sellingPrice,
                createdAt: new Date().toISOString()
            };
            
            data.products.push(product);
            saveToLocalStorage();
            loadProducts();
            clearProductForm();
            showNotification('পণ্য সফলভাবে যোগ করা হয়েছে!', 'success');
        }

        // পণ্য আপডেট করুন
        function updateProduct() {
            if (!currentEditId) return;
            
            const name = document.getElementById('productName').value.trim();
            const code = document.getElementById('productCode').value.trim();
            const dhaliSalary = parseFloat(document.getElementById('dhaliSalary').value) || 0;
            const ghosaSalary = parseFloat(document.getElementById('ghosaSalary').value) || 0;
            const chilaSalary = parseFloat(document.getElementById('chilaSalary').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
            
            if (!name) {
                showNotification('পণ্যের নাম পূরণ করুন!', 'error');
                return;
            }
            
            const index = data.products.findIndex(p => p.id === currentEditId);
            if (index !== -1) {
                data.products[index].name = name;
                data.products[index].code = code;
                data.products[index].dhaliSalary = dhaliSalary;
                data.products[index].ghosaSalary = ghosaSalary;
                data.products[index].chilaSalary = chilaSalary;
                data.products[index].sellingPrice = sellingPrice;
                
                saveToLocalStorage();
                loadProducts();
                clearProductForm();
                showNotification('পণ্য সফলভাবে আপডেট করা হয়েছে!', 'success');
            }
        }

        // পণ্য এডিট বাতিল করুন
        function cancelEditProduct() {
            clearProductForm();
        }

        // পণ্য ফর্ম ক্লিয়ার করুন
        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productCode').value = '';
            document.getElementById('dhaliSalary').value = '';
            document.getElementById('ghosaSalary').value = '0.80';
            document.getElementById('chilaSalary').value = '';
            document.getElementById('sellingPrice').value = '';
            
            document.getElementById('addProductBtn').style.display = 'inline-flex';
            document.getElementById('updateProductBtn').style.display = 'none';
            document.getElementById('cancelEditProductBtn').style.display = 'none';
            
            currentEditId = null;
        }

        // পণ্য লোড করুন
        function loadProducts() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';
            
            if (data.products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">কোন পণ্য যোগ করা হয়নি</td></tr>';
                return;
            }
            
            data.products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${product.name}</td>
                    <td>${product.code}</td>
                    <td>${product.dhaliSalary.toFixed(2)} টাকা</td>
                    <td>${product.ghosaSalary.toFixed(2)} টাকা</td>
                    <td>${product.chilaSalary.toFixed(2)} টাকা</td>
                    <td>${product.sellingPrice.toFixed(2)} টাকা/কেজি</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteProduct('${product.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            loadProductsForProduction();
            loadFinalStockProducts();
        }

        // পণ্য খুঁজুন
        function searchProducts() {
            const query = document.getElementById('productSearch').value.toLowerCase();
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';
            
            let filteredProducts = data.products.filter(product => 
                product.name.toLowerCase().includes(query) ||
                product.code.toLowerCase().includes(query)
            );
            
            if (filteredProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">কোন পণ্য পাওয়া যায়নি</td></tr>';
                return;
            }
            
            filteredProducts.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${product.name}</td>
                    <td>${product.code}</td>
                    <td>${product.dhaliSalary.toFixed(2)} টাকা</td>
                    <td>${product.ghosaSalary.toFixed(2)} টাকা</td>
                    <td>${product.chilaSalary.toFixed(2)} টাকা</td>
                    <td>${product.sellingPrice.toFixed(2)} টাকা/কেজি</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteProduct('${product.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // পণ্য এডিট করুন
        function editProduct(id) {
            const product = data.products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('productName').value = product.name;
            document.getElementById('productCode').value = product.code;
            document.getElementById('dhaliSalary').value = product.dhaliSalary;
            document.getElementById('ghosaSalary').value = product.ghosaSalary;
            document.getElementById('chilaSalary').value = product.chilaSalary;
            document.getElementById('sellingPrice').value = product.sellingPrice;
            
            document.getElementById('addProductBtn').style.display = 'none';
            document.getElementById('updateProductBtn').style.display = 'inline-flex';
            document.getElementById('cancelEditProductBtn').style.display = 'inline-flex';
            
            currentEditId = id;
        }

        // পণ্য ডিলিট করুন
        function deleteProduct(id) {
            if (confirm('আপনি কি নিশ্চিত এই পণ্য ডিলিট করতে চান?')) {
                const index = data.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    data.products.splice(index, 1);
                    saveToLocalStorage();
                    loadProducts();
                    showNotification('পণ্য ডিলিট করা হয়েছে!', 'success');
                }
            }
        }

        // উৎপাদনের জন্য শ্রমিক লোড করুন
        function loadWorkersForProduction(type) {
            const select = document.getElementById('productionWorker');
            select.innerHTML = '<option value="">প্রথমে বিভাগ নির্বাচন করুন</option>';
            
            if (!type) {
                select.disabled = true;
                return;
            }
            
            const workers = data.workers.filter(w => w.category === type && w.active);
            
            if (workers.length === 0) {
                select.innerHTML = '<option value="">কোন শ্রমিক পাওয়া যায়নি</option>';
                select.disabled = true;
            } else {
                select.disabled = false;
                workers.forEach(worker => {
                    const option = document.createElement('option');
                    option.value = worker.id;
                    option.textContent = worker.name;
                    select.appendChild(option);
                });
            }
        }

        // সাধারণ শ্রমিক লোড করুন
        function loadGeneralWorkers() {
            const select = document.getElementById('generalWorker');
            select.innerHTML = '<option value="">শ্রমিক নির্বাচন করুন</option>';
            
            const workers = data.workers.filter(w => w.category === 'general' && w.active);
            
            workers.forEach(worker => {
                const option = document.createElement('option');
                option.value = worker.id;
                option.textContent = worker.name;
                select.appendChild(option);
            });
        }

        // অগ্রীম বেতনের জন্য শ্রমিক লোড করুন
        function loadWorkersForAdvance() {
            const select = document.getElementById('advanceWorker');
            select.innerHTML = '<option value="">শ্রমিক নির্বাচন করুন</option>';
            
            const workers = data.workers.filter(w => w.active);
            
            workers.forEach(worker => {
                const option = document.createElement('option');
                option.value = worker.id;
                option.textContent = `${worker.name} (${getCategoryName(worker.category)}${worker.designation ? ' - ' + worker.designation : ''})`;
                select.appendChild(option);
            });
        }

        function getCategoryName(category) {
            const categories = {
                'dhali': 'ঢালাই',
                'ghosa': 'ঘষা',
                'chila': 'ছিলা',
                'general': 'সাধারণ',
                'bala_kata': 'বালা কাটা'
            };
            return categories[category] || category;
        }

        // উৎপাদনের জন্য পণ্য লোড করুন
        function loadProductsForProduction() {
            const select = document.getElementById('productionProduct');
            select.innerHTML = '<option value="">পণ্য নির্বাচন করুন</option>';
            
            data.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (${product.code})`;
                select.appendChild(option);
            });
        }

        // উৎপাদন যোগ করুন - নতুন ফিচার: একই তারিখে পুনরায় হাজিরা এন্ট্রি চেক
        function addProduction() {
            const date = document.getElementById('productionDate').value;
            const workerType = document.getElementById('productionWorkerType').value;
            const workerId = document.getElementById('productionWorker').value;
            const quantity = parseInt(document.getElementById('productionQuantity').value);
            
            if (!date || !workerType || !workerId || !quantity || quantity < 1) {
                showProductionMessage('সকল ফিল্ড পূরণ করুন!', 'error');
                return;
            }
            
            const worker = data.workers.find(w => w.id === workerId);
            if (!worker) {
                showProductionMessage('শ্রমিক পাওয়া যায়নি!', 'error');
                return;
            }
            
            if (workerType === 'general') {
                showProductionMessage('সাধারণ শ্রমিকের জন্য উপস্থিতি ব্যবস্থাপনা ব্যবহার করুন!', 'error');
                return;
            }
            
            // বালা কাটা শ্রমিকের জন্য বিশেষ প্রক্রিয়া
            if (workerType === 'bala_kata') {
                const balaType = document.getElementById('productionBalaProduct').value;
                
                // চেক করুন যদি এই শ্রমিক ইতিমধ্যে এই তারিখে এন্ট্রি দিয়েছে
                const existingEntry = data.productions.find(p => 
                    p.workerId === workerId && 
                    p.date === date &&
                    p.workerType === workerType
                );
                
                if (existingEntry) {
                    showProductionMessage(`${worker.name} ইতিমধ্যে ${formatDate(date)} তারিখে হাজিরা এন্ট্রি দিয়েছেন! পুনরায় এন্ট্রি দেওয়া যাবে না।`, 'error');
                    return;
                }
                
                const production = {
                    id: generateId(),
                    date: date,
                    workerId: workerId,
                    workerName: worker.name,
                    workerType: workerType,
                    productName: 'বালা',
                    productType: balaType,
                    quantity: quantity,
                    salary: quantity * 0.80, // প্রতি পিচ 0.80 টাকা
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                data.productions.push(production);
                
                // বালা স্টকে যোগ করুন
                addToBalaStock(quantity, balaType);
                
                saveToLocalStorage();
                loadProductions();
                clearProductionForm();
                showProductionMessage('বালা উৎপাদন এন্ট্রি সফলভাবে যোগ করা হয়েছে!', 'success');
                updateDashboard();
                loadStocks();
                return;
            }
            
            // অন্যান্য শ্রমিকের জন্য
            const productId = document.getElementById('productionProduct').value;
            if (!productId) {
                showProductionMessage('পণ্য নির্বাচন করুন!', 'error');
                return;
            }
            
            const product = data.products.find(p => p.id === productId);
            if (!product) {
                showProductionMessage('পণ্য পাওয়া যায়নি!', 'error');
                return;
            }
            
            // চেক করুন যদি এই শ্রমিক ইতিমধ্যে এই তারিখে এন্ট্রি দিয়েছে
            const existingEntry = data.productions.find(p => 
                p.workerId === workerId && 
                p.date === date &&
                p.workerType === workerType &&
                p.productId === productId
            );
            
            if (existingEntry) {
                showProductionMessage(`${worker.name} ইতিমধ্যে ${formatDate(date)} তারিখে ${product.name} এর জন্য এন্ট্রি দিয়েছেন! পুনরায় এন্ট্রি দেওয়া যাবে না।`, 'error');
                return;
            }
            
            const production = {
                id: generateId(),
                date: date,
                workerId: workerId,
                workerName: worker.name,
                workerType: workerType,
                productId: productId,
                productName: product.name,
                quantity: quantity,
                salary: calculateProductionSalary(workerType, product, quantity),
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            data.productions.push(production);
            const stockUpdated = updateStock(production);
            
            if (!stockUpdated) {
                return;
            }
            
            saveToLocalStorage();
            loadProductions();
            clearProductionForm();
            showProductionMessage('উৎপাদন এন্ট্রি সফলভাবে যোগ করা হয়েছে!', 'success');
            updateDashboard();
            loadStocks();
        }

        // বালা স্টকে যোগ করুন
        function addToBalaStock(quantity, balaType) {
            const existingItem = data.stocks.bala.find(item => item.type === balaType);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                data.stocks.bala.push({
                    type: balaType,
                    quantity: quantity,
                    createdAt: new Date().toISOString()
                });
            }
        }

        // উপস্থিতি যোগ করুন - নতুন ফিচার: একই তারিখে পুনরায় হাজিরা এন্ট্রি চেক
        function addAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const workerId = document.getElementById('generalWorker').value;
            const status = document.getElementById('attendanceStatus').value;
            const remarks = document.getElementById('attendanceRemarks').value.trim();
            
            if (!date || !workerId || !status) {
                showNotification('তারিখ, শ্রমিক এবং অবস্থা পূরণ করুন!', 'error');
                return;
            }
            
            const worker = data.workers.find(w => w.id === workerId);
            if (!worker) {
                showNotification('শ্রমিক পাওয়া যায়নি!', 'error');
                return;
            }
            
            // চেক করুন যদি এই সাধারণ শ্রমিক ইতিমধ্যে এই তারিখে এন্ট্রি দিয়েছে
            const existingAttendance = data.attendances.find(a => 
                a.workerId === workerId && 
                a.date === date
            );
            
            if (existingAttendance) {
                showNotification(`${worker.name} ইতিমধ্যে ${formatDate(date)} তারিখে হাজিরা এন্ট্রি দিয়েছেন! পুনরায় এন্ট্রি দেওয়া যাবে না।`, 'error');
                return;
            }
            
            const attendance = {
                id: generateId(),
                date: date,
                workerId: workerId,
                workerName: worker.name,
                workerDesignation: worker.designation || '',
                status: status,
                remarks: remarks,
                createdAt: new Date().toISOString()
            };
            
            data.attendances.push(attendance);
            saveToLocalStorage();
            showNotification('উপস্থিতি যোগ করা হয়েছে!', 'success');
            
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('generalWorker').value = '';
            document.getElementById('attendanceStatus').value = 'present';
            document.getElementById('attendanceRemarks').value = '';
        }

        // উৎপাদন মেসেজ দেখান
        function showProductionMessage(message, type) {
            const messageDiv = document.getElementById('productionMessage');
            const messageText = document.getElementById('productionMessageText');
            
            messageText.textContent = message;
            messageDiv.style.backgroundColor = type === 'success' ? '#d4edda' : 
                                             type === 'error' ? '#f8d7da' : '#fff3cd';
            messageDiv.style.color = type === 'success' ? '#155724' : 
                                    type === 'error' ? '#721c24' : '#856404';
            messageDiv.style.display = 'flex';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // উৎপাদন বেতন ক্যালকুলেট করুন
        function calculateProductionSalary(workerType, product, quantity) {
            switch(workerType) {
                case 'dhali':
                    return product.dhaliSalary * quantity;
                case 'ghosa':
                    return product.ghosaSalary * quantity;
                case 'chila':
                    return product.chilaSalary * quantity;
                default:
                    return 0;
            }
        }

        // স্টক আপডেট করুন
        function updateStock(production) {
            const { workerType, productId, productName, quantity } = production;
            
            switch(workerType) {
                case 'dhali':
                    addToStock('first', productId, productName, quantity);
                    return true;
                    
                case 'ghosa':
                    const firstStockItem = data.stocks.first.find(item => item.productId === productId);
                    if (firstStockItem && firstStockItem.quantity >= quantity) {
                        firstStockItem.quantity -= quantity;
                        if (firstStockItem.quantity === 0) {
                            const index = data.stocks.first.findIndex(item => item.productId === productId);
                            data.stocks.first.splice(index, 1);
                        }
                        addToStock('second', productId, productName, quantity);
                        return true;
                    } else {
                        showProductionMessage('১ম স্টকে পর্যাপ্ত পণ্য নেই!', 'error');
                        const index = data.productions.findIndex(p => p.id === production.id);
                        if (index !== -1) {
                            data.productions.splice(index, 1);
                        }
                        return false;
                    }
                    
                case 'chila':
                    const secondStockItem = data.stocks.second.find(item => item.productId === productId);
                    if (secondStockItem && secondStockItem.quantity >= quantity) {
                        secondStockItem.quantity -= quantity;
                        if (secondStockItem.quantity === 0) {
                            const index = data.stocks.second.findIndex(item => item.productId === productId);
                            data.stocks.second.splice(index, 1);
                        }
                        addToStock('third', productId, productName, quantity);
                        return true;
                    } else {
                        showProductionMessage('২য় স্টকে পর্যাপ্ত পণ্য নেই!', 'error');
                        const index = data.productions.findIndex(p => p.id === production.id);
                        if (index !== -1) {
                            data.productions.splice(index, 1);
                        }
                        return false;
                    }
            }
            
            return false;
        }

        // স্টকে পণ্য যোগ করুন
        function addToStock(stockType, productId, productName, quantity) {
            const stock = data.stocks[stockType];
            const existingItem = stock.find(item => item.productId === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                stock.push({
                    productId: productId,
                    productName: productName,
                    quantity: quantity
                });
            }
        }

        // উৎপাদন ফর্ম ক্লিয়ার করুন
        function clearProductionForm() {
            document.getElementById('productionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('productionWorkerType').value = '';
            document.getElementById('productionWorker').innerHTML = '<option value="">প্রথমে বিভাগ নির্বাচন করুন</option>';
            document.getElementById('productionWorker').disabled = true;
            document.getElementById('productionProduct').value = '';
            document.getElementById('productionBalaProduct').value = 'regular';
            document.getElementById('productionQuantity').value = '';
            document.getElementById('productionProductGroup').style.display = 'block';
            document.getElementById('productionBalaProductGroup').style.display = 'none';
        }

        // উৎপাদন লোড করুন
        function loadProductions() {
            const tbody = document.getElementById('productionTableBody');
            tbody.innerHTML = '';
            
            if (data.productions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">কোন উৎপাদন এন্ট্রি নেই</td></tr>';
                return;
            }
            
            data.productions.forEach((production, index) => {
                const workerTypeNames = {
                    'dhali': 'ঢালাই',
                    'ghosa': 'ঘষা',
                    'chila': 'ছিলা',
                    'bala_kata': 'বালা কাটা'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(production.date)}</td>
                    <td>${production.workerName}</td>
                    <td>${production.productName}${production.productType ? ' (' + production.productType + ')' : ''}</td>
                    <td>${production.quantity} পিচ</td>
                    <td>${workerTypeNames[production.workerType] || production.workerType}</td>
                    <td>${production.salary.toFixed(2)} টাকা</td>
                    <td class="data-actions">
                        <button class="action-btn delete-btn" onclick="deleteProduction('${production.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // উৎপাদন খুঁজুন
        function searchProductions() {
            const query = document.getElementById('productionSearch').value.toLowerCase();
            const tbody = document.getElementById('productionTableBody');
            tbody.innerHTML = '';
            
            let filteredProductions = data.productions.filter(production => 
                production.workerName.toLowerCase().includes(query) ||
                production.productName.toLowerCase().includes(query)
            );
            
            if (filteredProductions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">কোন উৎপাদন পাওয়া যায়নি</td></tr>';
                return;
            }
            
            filteredProductions.forEach((production, index) => {
                const workerTypeNames = {
                    'dhali': 'ঢালাই',
                    'ghosa': 'ঘষা',
                    'chila': 'ছিলা',
                    'bala_kata': 'বালা কাটা'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(production.date)}</td>
                    <td>${production.workerName}</td>
                    <td>${production.productName}${production.productType ? ' (' + production.productType + ')' : ''}</td>
                    <td>${production.quantity} পিচ</td>
                    <td>${workerTypeNames[production.workerType] || production.workerType}</td>
                    <td>${production.salary.toFixed(2)} টাকা</td>
                    <td class="data-actions">
                        <button class="action-btn delete-btn" onclick="deleteProduction('${production.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // উৎপাদন ডিলিট করুন
        function deleteProduction(id) {
            if (confirm('আপনি কি নিশ্চিত এই উৎপাদন এন্ট্রি ডিলিট করতে চান?')) {
                const index = data.productions.findIndex(p => p.id === id);
                if (index !== -1) {
                    const production = data.productions[index];
                    
                    if (production.workerType === 'bala_kata') {
                        // বালা স্টক থেকে বালা কমানো
                        removeFromBalaStock(production.quantity, production.productType);
                    } else {
                        reverseStock(production);
                    }
                    
                    data.productions.splice(index, 1);
                    saveToLocalStorage();
                    loadProductions();
                    loadStocks();
                    showNotification('উৎপাদন এন্ট্রি ডিলিট করা হয়েছে!', 'success');
                    updateDashboard();
                }
            }
        }

        // বালা স্টক থেকে বালা কমানো
        function removeFromBalaStock(quantity, balaType) {
            const existingItem = data.stocks.bala.find(item => item.type === balaType);
            
            if (existingItem) {
                existingItem.quantity -= quantity;
                if (existingItem.quantity <= 0) {
                    const index = data.stocks.bala.findIndex(item => item.type === balaType);
                    data.stocks.bala.splice(index, 1);
                }
            }
        }

        // স্টক রিভার্স করুন
        function reverseStock(production) {
            const { workerType, productId, productName, quantity } = production;
            
            switch(workerType) {
                case 'dhali':
                    removeFromStock('first', productId, quantity);
                    break;
                    
                case 'ghosa':
                    removeFromStock('second', productId, quantity);
                    addToStock('first', productId, productName, quantity);
                    break;
                    
                case 'chila':
                    removeFromStock('third', productId, quantity);
                    addToStock('second', productId, productName, quantity);
                    break;
            }
        }

        // স্টক থেকে পণ্য বিয়োগ করুন
        function removeFromStock(stockType, productId, quantity) {
            const stock = data.stocks[stockType];
            const existingItem = stock.find(item => item.productId === productId);
            
            if (existingItem) {
                existingItem.quantity -= quantity;
                if (existingItem.quantity <= 0) {
                    const index = stock.findIndex(item => item.productId === productId);
                    stock.splice(index, 1);
                }
            }
        }

        // স্টক লোড করুন
        function loadStocks() {
            const firstStockTotal = data.stocks.first.reduce((sum, item) => sum + item.quantity, 0);
            const secondStockTotal = data.stocks.second.reduce((sum, item) => sum + item.quantity, 0);
            const thirdStockTotal = data.stocks.third.reduce((sum, item) => sum + item.quantity, 0);
            const finalStockTotal = data.stocks.final.reduce((sum, item) => sum + item.totalBundles, 0);
            const balaStockTotal = data.stocks.bala.reduce((sum, item) => sum + item.quantity, 0);
            
            document.getElementById('firstStockCount').textContent = `${firstStockTotal} পিচ`;
            document.getElementById('secondStockCount').textContent = `${secondStockTotal} পিচ`;
            document.getElementById('thirdStockCount').textContent = `${thirdStockTotal} পিচ`;
            document.getElementById('finalStockCount').textContent = `${finalStockTotal} বান্ডিল`;
            document.getElementById('balaStockCount').textContent = `${balaStockTotal} পিচ`;
            
            document.getElementById('firstStockDetail').textContent = `${firstStockTotal} পিচ`;
            document.getElementById('secondStockDetail').textContent = `${secondStockTotal} পিচ`;
            document.getElementById('thirdStockDetail').textContent = `${thirdStockTotal} পিচ`;
            document.getElementById('balaStockDetail').textContent = `${balaStockTotal} পিচ`;
            
            displayStockItems('firstStockItems', data.stocks.first);
            displayStockItems('secondStockItems', data.stocks.second);
            displayStockItems('thirdStockItems', data.stocks.third);
            displayBalaStockItems('balaStockItems', data.stocks.bala);
            
            loadFinalStockTable();
            updateSaleStockWarning();
        }

        // স্টক আইটেম দেখান
        function displayStockItems(containerId, stockItems) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (stockItems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 10px;">কোন পণ্য নেই</p>';
                return;
            }
            
            stockItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'file-stock-item';
                div.innerHTML = `
                    <strong>${item.productName}</strong>
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>পরিমাণ: ${item.quantity} পিচ</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // বালা স্টক আইটেম দেখান
        function displayBalaStockItems(containerId, balaItems) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (balaItems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 10px;">কোন বালা নেই</p>';
                return;
            }
            
            balaItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'bala-stock-item';
                div.innerHTML = `
                    <strong>${item.type === 'regular' ? 'সাধারণ বালা' : 'বিশেষ বালা'}</strong>
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>পরিমাণ: ${item.quantity} পিচ</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // ফাইনাল স্টকের জন্য পণ্য লোড করুন
        function loadFinalStockProducts() {
            const select = document.getElementById('finalStockProduct');
            select.innerHTML = '<option value="">পণ্য নির্বাচন করুন</option>';
            
            data.stocks.third.forEach(item => {
                const product = data.products.find(p => p.id === item.productId);
                if (product) {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (স্টক: ${item.quantity} পিচ)`;
                    option.dataset.quantity = item.quantity;
                    select.appendChild(option);
                }
            });
        }

        // বান্ডিল ইনপুট আপডেট করুন
        function updateBundleInputs() {
            const productId = document.getElementById('finalStockProduct').value;
            const totalBundlesInput = document.getElementById('totalBundles');
            
            if (!productId) {
                totalBundlesInput.value = '';
                return;
            }
            
            const stockItem = data.stocks.third.find(item => item.productId === productId);
            if (stockItem) {
                const maxBundles = Math.floor(stockItem.quantity / 30);
                totalBundlesInput.value = maxBundles;
                totalBundlesInput.max = maxBundles;
                
                if (maxBundles > 0) {
                    createBundleWeightInputs();
                }
            }
        }

        // ফাইনাল স্টক টেবিল লোড করুন
        function loadFinalStockTable() {
            const tbody = document.getElementById('finalStockTableBody');
            tbody.innerHTML = '';
            
            if (data.stocks.final.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">কোন ফাইনাল স্টক নেই</td></tr>';
                return;
            }
            
            data.stocks.final.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.productName || 'নাম নেই'}</td>
                    <td>${item.totalBundles || 0} বান্ড</td>
                                            <td>${item.totalPieces || 0} পিচ</td>
                    <td>${(item.totalWeight || 0).toFixed(2)} কেজি</td>
                    <td>${(item.averageWeight || 0).toFixed(2)} কেজি/বান্ডিল</td>
                    <td>${formatDate(item.createdAt)}</td>
                    <td class="data-actions">
                        <button class="action-btn delete-btn" onclick="deleteFinalStock('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ফাইনাল স্টক ডিলিট করুন
        function deleteFinalStock(id) {
            if (confirm('আপনি কি নিশ্চিত এই ফাইনাল স্টক ডিলিট করতে চান?')) {
                const index = data.stocks.final.findIndex(item => item.id === id);
                if (index !== -1) {
                    const stockItem = data.stocks.final[index];
                    
                    // ৩য় স্টক এ যোগ করুন
                    addToStock('third', stockItem.productId, stockItem.productName, stockItem.totalPieces);
                    
                    // বালা স্টক এ বালা ফেরত যোগ করুন (প্রতি ২টি বালা ১ পিচ পণ্যের জন্য)
                    const balaNeeded = stockItem.totalPieces * 2;
                    addToBalaStock(balaNeeded, 'regular');
                    
                    data.stocks.final.splice(index, 1);
                    saveToLocalStorage();
                    loadStocks();
                    showNotification('ফাইনাল স্টক ডিলিট করা হয়েছে!', 'success');
                    updateDashboard();
                }
            }
        }

// বেতন হিসাব করুন
function calculateSalaries() {
    const startDate = document.getElementById('salaryStartDate').value;
    const endDate = document.getElementById('salaryEndDate').value;
    const workerType = document.getElementById('salaryWorkerType').value;
    
    if (!startDate || !endDate) {
        showNotification('শুরু ও শেষ তারিখ পূরণ করুন!', 'error');
        return;
    }
    
    if (new Date(startDate) > new Date(endDate)) {
        showNotification('শেষ তারিখ শুরু তারিখের পরে হতে হবে!', 'error');
        return;
    }
    
    const tbody = document.getElementById('salaryTableBody');
    tbody.innerHTML = '';
    
    let filteredWorkers = data.workers.filter(worker => 
        worker.active && (!workerType || worker.category === workerType)
    );
    
    if (filteredWorkers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 30px;">কোন শ্রমিক পাওয়া যায়নি</td></tr>';
        return;
    }
    
    filteredWorkers.forEach(worker => {
        let totalWork = 0;
        let totalSalary = 0;
        
        if (worker.category === 'general') {
            // সাধারণ শ্রমিকের জন্য উপস্থিতি অনুযায়ী বেতন
            const attendances = data.attendances.filter(a => 
                a.workerId === worker.id && 
                a.date >= startDate && 
                a.date <= endDate
            );
            
            attendances.forEach(attendance => {
                let attendanceRate = 0;
                switch(attendance.status) {
                    case 'present':
                        attendanceRate = 1;
                        break;
                    case 'half_day':
                        attendanceRate = 0.5;
                        break;
                    case 'late':
                        attendanceRate = 0.75;
                        break;
                    default:
                        attendanceRate = 0;
                }
                
                totalWork += attendanceRate;
                totalSalary += worker.dailyRate * attendanceRate;
            });
            
            totalWork = totalWork.toFixed(1) + ' দিন';
        } else {
            // উৎপাদন শ্রমিকের জন্য উৎপাদন অনুযায়ী বেতন
            const productions = data.productions.filter(p => 
                p.workerId === worker.id && 
                p.date >= startDate && 
                p.date <= endDate
            );
            
            productions.forEach(production => {
                totalWork += production.quantity;
                totalSalary += production.salary;
            });
            
            totalWork = totalWork.toFixed(0) + ' পিচ';
        }
        
        // অগ্রীম বেতন যোগ করুন
        const advancePayments = data.advancePayments.filter(ap => 
            ap.workerId === worker.id
        );
        const totalAdvance = advancePayments.reduce((sum, ap) => sum + ap.amount, 0);
        
        // বাকী বেতন
        const dueSalary = totalSalary - totalAdvance;
        
        // ==== নতুন কোড শুরু: পরিশোধিত বেতন চেক করুন ====
        // এই তারিখের মধ্যে পরিশোধিত বেতন চেক করুন
        const salaryPaid = data.payments && data.payments.find(p => 
            p.workerId === worker.id && 
            p.date >= startDate && 
            p.date <= endDate &&
            p.type === 'salary_payment'
        );
        
        const isPaid = salaryPaid || dueSalary <= 0;
        // ==== নতুন কোড শেষ ====
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${worker.name}</td>
            <td>${getCategoryName(worker.category)}</td>
            <td>${worker.designation || 'নাই'}</td>
            <td>${totalWork}</td>
            <td>${totalSalary.toFixed(2)} টাকা</td>
            <td>${totalAdvance.toFixed(2)} টাকা</td>
            <td>${dueSalary.toFixed(2)} টাকা</td>
            <td>
                <span class="status-badge ${isPaid ? 'status-paid' : 'status-unpaid'}">
                    ${isPaid ? 'পরিশোধিত' : 'বকেয়া'}
                </span>
            </td>
            <td>${isPaid ? formatDate(salaryPaid ? salaryPaid.date : endDate) : 'নাই'}</td>
            <td class="data-actions">
                <button class="action-btn edit-btn" onclick="paySalary('${worker.id}', ${dueSalary})" ${isPaid ? 'disabled' : ''} style="${isPaid ? 'background-color: #95a5a6; cursor: not-allowed;' : ''}">
                    <i class="fas fa-money-bill-wave"></i> ${isPaid ? 'পরিশোধিত' : 'পরিশোধ'}
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

        // বেতন লোড করুন
        function loadSalaries() {
            const tbody = document.getElementById('salaryTableBody');
            tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 30px;">বেতন হিসাব করতে "বেতন হিসাব করুন" বাটন ক্লিক করুন</td></tr>';
        }
// বেতন পরিশোধ করুন
function paySalary(workerId, amount) {
    if (amount <= 0) {
        showNotification('পরিশোধের জন্য কোন বাকী নেই!', 'error');
        return;
    }
    
    if (confirm(`বেতন পরিশোধ করুন: ${amount.toFixed(2)} টাকা?`)) {
        const worker = data.workers.find(w => w.id === workerId);
        if (!worker) return;
        
        // নগদ তহবিল চেক
        if (data.finances.cash < amount) {
            showNotification('নগদ তহবিলে পর্যাপ্ত টাকা নেই!', 'error');
            return;
        }
        
        // নগদ থেকে বেতন পরিশোধ
        data.finances.cash -= amount;
        
        // লেনদেন রেকর্ড
        const transaction = {
            id: generateId(),
            date: new Date().toISOString().split('T')[0],
            description: `বেতন পরিশোধ: ${worker.name}`,
            type: 'expense',
            amount: amount,
            balance: data.finances.cash,
            method: 'cash',
            bank: null,
            createdAt: new Date().toISOString()
        };
        data.finances.transactions.push(transaction);
        
        // অগ্রীম বেতন শূন্য করুন
        const advanceIndex = data.advancePayments.findIndex(ap => ap.workerId === workerId);
        if (advanceIndex !== -1) {
            data.advancePayments.splice(advanceIndex, 1);
        }
        
        // ==== নতুন কোড শুরু: বেতন পরিশোধ রেকর্ড সংরক্ষণ ====
        // শ্রমিকের বেতন পরিশোধ রেকর্ড সংরক্ষণ
        const paymentRecord = {
            id: generateId(),
            workerId: workerId,
            workerName: worker.name,
            amount: amount,
            date: new Date().toISOString().split('T')[0],
            type: 'salary_payment',
            createdAt: new Date().toISOString()
        };
        
        // যদি আগে থেকে payments ডেটা না থাকে তাহলে তৈরি করুন
        if (!data.payments) {
            data.payments = [];
        }
        data.payments.push(paymentRecord);
        // ==== নতুন কোড শেষ ====
        
        saveToLocalStorage();
        calculateSalaries();
        updateDashboard();
        showNotification('বেতন সফলভাবে পরিশোধ করা হয়েছে!', 'success');
        
        // ==== নতুন কোড শুরু: বেতন পরিশোধ বাটন নিষ্ক্রিয় করুন ====
        // বেতন পরিশোধ বাটন খুঁজে নিষ্ক্রিয় করুন
        setTimeout(() => {
            const salaryTableBody = document.getElementById('salaryTableBody');
            const rows = salaryTableBody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const workerNameCell = row.cells[0]; // শ্রমিক নামের কলাম
                if (workerNameCell && workerNameCell.textContent.includes(worker.name)) {
                    const actionCell = row.cells[9]; // কর্ম কলাম
                    if (actionCell) {
                        const payButton = actionCell.querySelector('button');
                        if (payButton) {
                            payButton.disabled = true;
                            payButton.innerHTML = '<i class="fas fa-check-circle"></i> পরিশোধিত';
                            payButton.style.backgroundColor = '#95a5a6';
                            payButton.style.cursor = 'not-allowed';
                        }
                    }
                    break;
                }
            }
        }, 100);
        // ==== নতুন কোড শেষ ====
    }
}

        // অগ্রীম বেতন প্রদান করুন
        function giveAdvancePayment() {
            const workerId = document.getElementById('advanceWorker').value;
            const amount = parseFloat(document.getElementById('advanceAmount').value);
            const date = document.getElementById('advanceDate').value;
            const remarks = document.getElementById('advanceRemarks').value.trim();
            
            if (!workerId || !amount || amount <= 0 || !date) {
                showNotification('সকল ফিল্ড পূরণ করুন!', 'error');
                return;
            }
            
            const worker = data.workers.find(w => w.id === workerId);
            if (!worker) {
                showNotification('শ্রমিক পাওয়া যায়নি!', 'error');
                return;
            }
            
            // নগদ তহবিল চেক
            if (data.finances.cash < amount) {
                showNotification('নগদ তহবিলে পর্যাপ্ত টাকা নেই!', 'error');
                return;
            }
            
            // নগদ থেকে অগ্রীম প্রদান
            data.finances.cash -= amount;
            
            // লেনদেন রেকর্ড
            const transaction = {
                id: generateId(),
                date: date,
                description: `অগ্রীম বেতন: ${worker.name}${remarks ? ' - ' + remarks : ''}`,
                type: 'expense',
                amount: amount,
                balance: data.finances.cash,
                method: 'cash',
                bank: null,
                createdAt: new Date().toISOString()
            };
            data.finances.transactions.push(transaction);
            
            // অগ্রীম রেকর্ড সংরক্ষণ
            const advancePayment = {
                id: generateId(),
                workerId: workerId,
                workerName: worker.name,
                amount: amount,
                date: date,
                remarks: remarks,
                createdAt: new Date().toISOString()
            };
            
            data.advancePayments.push(advancePayment);
            saveToLocalStorage();
            
            // ফর্ম রিসেট
            document.getElementById('advanceAmount').value = '';
            document.getElementById('advanceRemarks').value = '';
            
            showNotification('অগ্রীম বেতন প্রদান করা হয়েছে!', 'success');
            
            // হিসাব আপডেট
            showAdvanceHistory(workerId);
        }

        // অগ্রীম বেতন হিসাব দেখান
        function showAdvanceHistory(workerId) {
            const historyDiv = document.getElementById('advanceHistory');
            const historyContent = document.getElementById('advanceHistoryContent');
            
            const worker = data.workers.find(w => w.id === workerId);
            if (!worker) return;
            
            const advancePayments = data.advancePayments.filter(ap => ap.workerId === workerId);
            const totalAdvance = advancePayments.reduce((sum, ap) => sum + ap.amount, 0);
            
            if (advancePayments.length === 0) {
                historyDiv.style.display = 'none';
                return;
            }
            
            historyDiv.style.display = 'block';
            historyContent.innerHTML = `
                <p><strong>মোট অগ্রীম:</strong> ${totalAdvance.toFixed(2)} টাকা</p>
                <div style="margin-top: 10px;">
                    ${advancePayments.map(ap => `
                        <div class="advance-history-item">
                            <span>${formatDate(ap.date)}</span>
                            <span class="advance-amount">${ap.amount.toFixed(2)} টাকা</span>
                            <span class="advance-date">${ap.remarks || 'নাই'}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ক্রেতা যোগ করুন
        function addCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const address = document.getElementById('customerAddress').value.trim();
            
            if (!name) {
                showNotification('ক্রেতার নাম পূরণ করুন!', 'error');
                return;
            }
            
            if (phone && !/^01[3-9]\d{8}$/.test(phone)) {
                showNotification('সঠিক মোবাইল নম্বর দিন!', 'error');
                return;
            }
            
            const customer = {
                id: generateId(),
                name: name,
                phone: phone || '',
                address: address || '',
                totalPurchases: 0,
                totalAmount: 0,
                outstandingBalance: 0,
                lastPurchaseDate: null,
                createdAt: new Date().toISOString()
            };
            
            data.customers.push(customer);
            saveToLocalStorage();
            loadCustomers();
            loadCustomersForSale();
            loadCustomersForDuePayments();
            clearCustomerForm();
            showNotification('ক্রেতা যোগ করা হয়েছে!', 'success');
        }

        // ক্রেতা ফর্ম ক্লিয়ার করুন
        function clearCustomerForm() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
        }

        // ক্রেতা লোড করুন
        function loadCustomers() {
            const tbody = document.querySelector('#customers .data-table tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (data.customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 30px;">কোন ক্রেতা যোগ করা হয়নি</td></tr>';
                return;
            }
            
            data.customers.forEach((customer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone || 'নাই'}</td>
                    <td>${customer.address || 'নাই'}</td>
                    <td>${customer.outstandingBalance.toFixed(2)} টাকা</td>
                `;
                tbody.appendChild(row);
            });
        }

        // বিক্রয়ের জন্য ক্রেতা লোড করুন
        function loadCustomersForSale() {
            const select = document.getElementById('saleCustomer');
            select.innerHTML = '<option value="">ক্রেতা নির্বাচন করুন</option>';
            
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name}${customer.outstandingBalance > 0 ? ' (বাকী: ' + customer.outstandingBalance.toFixed(2) + ' টাকা)' : ''}`;
                select.appendChild(option);
            });
        }

        // বাকী টাকা জমার জন্য ক্রেতা লোড করুন
        function loadCustomersForDuePayments() {
            const select = document.getElementById('duePaymentCustomer');
            select.innerHTML = '<option value="">ক্রেতা নির্বাচন করুন</option>';
            
            const customersWithDue = data.customers.filter(c => c.outstandingBalance > 0);
            
            if (customersWithDue.length === 0) {
                select.innerHTML = '<option value="">কোন ক্রেতার বাকী নেই</option>';
                return;
            }
            
            customersWithDue.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (বাকী: ${customer.outstandingBalance.toFixed(2)} টাকা)`;
                select.appendChild(option);
            });
        }

        // বিক্রয়ের জন্য পণ্য লোড করুন
        function loadProductsForSale() {
            const select = document.getElementById('saleProduct');
            if (!select) return;
            
            select.innerHTML = '<option value="">পণ্য নির্বাচন করুন</option>';
            
            data.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (${product.sellingPrice.toFixed(2)} টাকা/কেজি)`;
                option.dataset.price = product.sellingPrice;
                select.appendChild(option);
            });
        }

        // বিক্রয় সম্পন্ন করুন
        function completeSale() {
            // যাচাইকরণ
            if (!saleSession.customerId) {
                showNotification('ক্রেতা নির্বাচন করুন!', 'error');
                return;
            }
            
            if (saleSession.selectedFinalStockItems.length === 0) {
                showNotification('কমপক্ষে একটি পণ্য নির্বাচন করুন!', 'error');
                return;
            }
            
            const customer = data.customers.find(c => c.id === saleSession.customerId);
            if (!customer) {
                showNotification('ক্রেতা পাওয়া যায়নি!', 'error');
                return;
            }
            
            const paymentMethod = document.getElementById('salePaymentMethod').value;
            const bank = paymentMethod === 'bank' ? document.getElementById('saleBank').value : null;
            
            // টোটাল বিক্রয় মূল্য
            const totalAmount = saleSession.totalAmount;
            
            // Invoice নম্বর জেনারেট করুন
            const invoiceNo = generateInvoiceNo();
            
            // বাকী বিক্রয় চেক করুন
            if (paymentMethod === 'due') {
                // বাকী বিক্রয়ের জন্য ক্রেতার বাকী আপডেট করুন
                customer.outstandingBalance += totalAmount;
                customer.totalPurchases += 1;
                customer.totalAmount += totalAmount;
                customer.lastPurchaseDate = saleSession.saleDate;
                
            } else {
                // নগদ বা ব্যাংক বিক্রয়
                if (paymentMethod === 'cash') {
                    // নগদ তহবিল আপডেট
                    data.finances.cash += totalAmount;
                    
                    // লেনদেন রেকর্ড
                    const transaction = {
                        id: generateId(),
                        date: saleSession.saleDate,
                        description: `বিক্রয়: ${customer.name} - Invoice #${invoiceNo}`,
                        type: 'income',
                        amount: totalAmount,
                        balance: data.finances.cash,
                        method: 'cash',
                        bank: null,
                        createdAt: new Date().toISOString()
                    };
                    data.finances.transactions.push(transaction);
                    
                } else if (paymentMethod === 'bank' && bank) {
                    // ব্যাংক ব্যালেন্স আপডেট
                    data.finances.banks[bank].balance += totalAmount;
                    
                    // লেনদেন রেকর্ড
                    const transaction = {
                        id: generateId(),
                        date: saleSession.saleDate,
                        description: `বিক্রয়: ${customer.name} - Invoice #${invoiceNo}`,
                        type: 'income',
                        amount: totalAmount,
                        balance: data.finances.banks[bank].balance,
                        method: 'bank',
                        bank: bank,
                        createdAt: new Date().toISOString()
                    };
                    data.finances.transactions.push(transaction);
                }
                
                customer.totalPurchases += 1;
                customer.totalAmount += totalAmount;
                customer.lastPurchaseDate = saleSession.saleDate;
            }
            
            // বিক্রয় রেকর্ড সংরক্ষণ
            const sale = {
                id: generateId(),
                invoiceNo: invoiceNo,
                date: saleSession.saleDate,
                customerId: saleSession.customerId,
                customerName: customer.name,
                items: [...saleSession.selectedItems],
                totalAmount: totalAmount,
                paymentMethod: paymentMethod,
                bank: bank,
                status: paymentMethod === 'due' ? 'due' : 'paid',
                createdAt: new Date().toISOString()
            };
            
            data.sales.push(sale);
            
            // ফাইনাল স্টক থেকে পণ্য বিয়োগ
            removeSoldItemsFromFinalStock();
            
            // সফল মেসেজ
            saveToLocalStorage();
            loadSales();
            loadStocks();
            updateDashboard();
            loadCustomersForSale();
            loadCustomersForDuePayments();
            loadAllCustomersDueList();
            
            // Invoice তৈরী করুন
            generateInvoice(invoiceNo, sale, customer);
            
            // বিক্রয় সেশন রিসেট
            resetSaleSession();
            
            showNotification(`বিক্রয় সফলভাবে সম্পন্ন হয়েছে! Invoice No: ${invoiceNo}`, 'success');
        }

        // ফাইনাল স্টক থেকে বিক্রয়কৃত পণ্য বিয়োগ
        function removeSoldItemsFromFinalStock() {
            saleSession.selectedFinalStockItems.forEach(saleItem => {
                const finalStockItem = data.stocks.final.find(item => item.id === saleItem.finalStockId);
                if (!finalStockItem) return;
                
                // নির্বাচিত বান্ডিল সংখ্যা
                const selectedBundles = saleItem.bundleNumbers.length;
                
                if (selectedBundles === finalStockItem.totalBundles) {
                    // সব বান্ডিল বিক্রয় হলে পুরো আইটেম ডিলিট
                    const index = data.stocks.final.findIndex(item => item.id === saleItem.finalStockId);
                    data.stocks.final.splice(index, 1);
                } else {
                    // কিছু বান্ডিল বিক্রয় হলে আপডেট
                    // নতুন বান্ডিল ওজন অ্যারেতে নির্বাচিত বান্ডিলগুলোর ওজন সরিয়ে ফেলুন
                    const newBundleWeights = [];
                    const newBundleNumbers = [];
                    
                    finalStockItem.bundleWeights.forEach((weight, index) => {
                        if (!saleItem.bundleNumbers.includes(index)) {
                            newBundleWeights.push(weight);
                            newBundleNumbers.push(index);
                        }
                    });
                    
                    // আইটেম আপডেট
                    finalStockItem.bundleNumbers = newBundleNumbers;
                    finalStockItem.bundleWeights = newBundleWeights;
                    finalStockItem.totalBundles = newBundleWeights.length;
                    finalStockItem.totalPieces = finalStockItem.piecesPerBundle * newBundleWeights.length;
                    finalStockItem.totalWeight = newBundleWeights.reduce((sum, weight) => sum + weight, 0);
                    finalStockItem.averageWeight = finalStockItem.totalWeight / finalStockItem.totalBundles;
                }
            });
        }

        // Invoice নম্বর জেনারেট করুন
        function generateInvoiceNo() {
            data.settings.lastInvoiceNo += 1;
            return `INV${String(data.settings.lastInvoiceNo).padStart(5, '0')}`;
        }

        // Invoice তৈরী করুন
        function generateInvoice(invoiceNo, sale, customer) {
            const invoiceContent = document.getElementById('invoiceContent');
            
            let invoiceHTML = `
                <div class="invoice-header">
                    <h1>Zafrul Metal</h1>
                    <h2>বগুড়া | মোবাইল: 01713706996</h2>
                    <p>এলুমিনিয়াম পণ্য উৎপাদন ও সরবরাহ</p>
                    <h3>বিক্রয় Invoice</h3>
                    <p>Invoice No: ${invoiceNo}</p>
                    <p>তারিখ: ${formatDate(sale.date)}</p>
                </div>
                
                <div class="invoice-details">
                    <div>
                        <h4>বিক্রেতার তথ্য:</h4>
                        <p><strong>Zafrul Metal</strong></p>
                        <p>বগুড়া, বাংলাদেশ</p>
                        <p>মোবাইল: 01713706996</p>
                    </div>
                    
                    <div>
                        <h4>ক্রেতার তথ্য:</h4>
                        <p><strong>${customer.name}</strong></p>
                        <p>${customer.address || 'ঠিকানা: নাই'}</p>
                        <p>${customer.phone ? 'মোবাইল: ' + customer.phone : ''}</p>
                    </div>
                </div>
                
                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>ক্রমিক</th>
                            <th>পণ্যের নাম</th>
                            <th>বান্ডিল</th>
                            <th>ওজন (কেজি)</th>
                            <th>প্রতি কেজি দাম</th>
                            <th>মোট দাম</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            sale.items.forEach((item, index) => {
                invoiceHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.productName}</td>
                        <td>${item.bundles}</td>
                        <td>${item.weight.toFixed(2)}</td>
                        <td>${item.pricePerKg.toFixed(2)} টাকা</td>
                        <td>${item.totalPrice.toFixed(2)} টাকা</td>
                    </tr>
                `;
            });
            
            invoiceHTML += `
                    </tbody>
                </table>
                
                <div class="invoice-total">
                    <div class="total-row">
                        <span class="total-label">মোট মূল্য:</span>
                        <span class="total-value">${sale.totalAmount.toFixed(2)} টাকা</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label">পেমেন্ট পদ্ধতি:</span>
                        <span class="total-value">${sale.paymentMethod === 'cash' ? 'নগদ' : sale.paymentMethod === 'bank' ? 'ব্যাংক' : 'বাকি'}</span>
                    </div>
                    ${sale.status === 'due' ? `
                    <div class="total-row">
                        <span class="total-label">বাকি টাকা:</span>
                        <span class="total-value" style="color: #e74c3c;">${sale.totalAmount.toFixed(2)} টাকা</span>
                    </div>
                    ` : ''}
                </div>
                
                <div class="signature-section">
                    <div class="signature">
                        <p>ক্রেতার স্বাক্ষর</p>
                        <div class="signature-line"></div>
                        <p>নাম: ${customer.name}</p>
                    </div>
                    
                    <div class="signature">
                        <p>বিক্রেতার স্বাক্ষর</p>
                        <div class="signature-line"></div>
                        <p>Zafrul Metal</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px; font-size: 12px; color: #666;">
                    <p>Software: Zafrul Metal Inventory v2.7 | বগুড়া | 01713706996</p>
                </div>
            `;
            
            invoiceContent.innerHTML = invoiceHTML;
            
            // Invoice সংরক্ষণ
            const savedInvoice = {
                id: generateId(),
                invoiceNo: invoiceNo,
                date: sale.date,
                customerName: customer.name,
                totalItems: sale.items.length,
                totalWeight: sale.items.reduce((sum, item) => sum + item.weight, 0),
                totalAmount: sale.totalAmount,
                paymentMethod: sale.paymentMethod,
                status: sale.status,
                invoiceData: sale
            };
            
            data.savedInvoices.push(savedInvoice);
            saveToLocalStorage();
            
            // Invoice মডাল দেখান
            document.getElementById('invoiceModal').style.display = 'block';
        }

        // Invoice প্রিন্ট করুন
        function printInvoice() {
            const printWindow = window.open('', '', 'width=900,height=650');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice - Zafrul Metal</title>
                    <style>
                        body { font-family: 'Segoe UI', 'SolaimanLipi', sans-serif; margin: 20px; }
                        .invoice-header { text-align: center; margin-bottom: 30px; }
                        .invoice-details { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
                        th { background-color: #f8f9fa; }
                        .invoice-total { margin-top: 30px; text-align: right; }
                        .total-row { display: flex; justify-content: flex-end; gap: 20px; margin-bottom: 10px; }
                        .signature-section { display: flex; justify-content: space-between; margin-top: 50px; }
                        .signature { text-align: center; width: 45%; }
                        .signature-line { border-top: 1px solid #333; margin: 40px 0 10px; width: 100%; }
                        @media print {
                            body { font-size: 12pt; }
                            @page { size: A4; margin: 15mm; }
                        }
                    </style>
                </head>
                <body>
                    ${document.getElementById('invoiceContent').innerHTML}
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() { window.close(); }, 1000);
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Invoice সংরক্ষণ করুন
        function saveInvoice() {
            showNotification('Invoice সংরক্ষণ করা হয়েছে!', 'success');
        }

        // Invoice মডাল বন্ধ করুন
        function closeInvoiceModal() {
            document.getElementById('invoiceModal').style.display = 'none';
        }

        // বিক্রয় লোড করুন
        function loadSales() {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            if (data.sales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">কোন বিক্রয় রেকর্ড নেই</td></tr>';
                return;
            }
            
            data.sales.forEach((sale, index) => {
                const totalWeight = sale.items.reduce((sum, item) => sum + item.weight, 0);
                const totalItems = sale.items.length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(sale.date)}</td>
                    <td>${sale.customerName}</td>
                    <td>${totalItems} প্রকার</td>
                    <td>${sale.items.reduce((sum, item) => sum + item.bundles, 0)} বান্ডিল</td>
                    <td>${totalWeight.toFixed(2)} কেজি</td>
                    <td>${sale.totalAmount.toFixed(2)} টাকা</td>
                    <td>${sale.paymentMethod === 'cash' ? 'নগদ' : sale.paymentMethod === 'bank' ? 'ব্যাংক' : 'বাকি'}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="viewInvoice('${sale.invoiceNo}')">
                            <i class="fas fa-file-invoice"></i> ${sale.invoiceNo}
                        </button>
                    </td>
                    <td class="data-actions">
                        <button class="action-btn delete-btn" onclick="deleteSale('${sale.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Invoice দেখুন
        function viewInvoice(invoiceNo) {
            const sale = data.sales.find(s => s.invoiceNo === invoiceNo);
            if (!sale) {
                showNotification('Invoice পাওয়া যায়নি!', 'error');
                return;
            }
            
            const customer = data.customers.find(c => c.id === sale.customerId);
            if (!customer) {
                showNotification('ক্রেতার তথ্য পাওয়া যায়নি!', 'error');
                return;
            }
            
            generateInvoice(invoiceNo, sale, customer);
        }

        // বিক্রয় ডিলিট করুন
        function deleteSale(id) {
            if (confirm('আপনি কি নিশ্চিত এই বিক্রয় রেকর্ড ডিলিট করতে চান?')) {
                const index = data.sales.findIndex(s => s.id === id);
                if (index !== -1) {
                    const sale = data.sales[index];
                    
                    // ক্রেতার তথ্য রিভার্স
                    const customer = data.customers.find(c => c.id === sale.customerId);
                    if (customer) {
                        customer.totalPurchases -= 1;
                        customer.totalAmount -= sale.totalAmount;
                        
                        if (sale.paymentMethod === 'due') {
                            customer.outstandingBalance -= sale.totalAmount;
                            if (customer.outstandingBalance < 0) {
                                customer.outstandingBalance = 0;
                            }
                        }
                    }
                    
                    // আর্থিক ব্যবস্থাপনা রিভার্স
                    if (sale.paymentMethod === 'cash') {
                        data.finances.cash -= sale.totalAmount;
                        
                        // লেনদেন রিভার্স
                        const transactionIndex = data.finances.transactions.findIndex(t => 
                            t.description.includes(sale.invoiceNo)
                        );
                        
                        if (transactionIndex !== -1) {
                            data.finances.transactions.splice(transactionIndex, 1);
                        }
                        
                    } else if (sale.paymentMethod === 'bank' && sale.bank) {
                        data.finances.banks[sale.bank].balance -= sale.totalAmount;
                        
                        // লেনদেন রিভার্স
                        const transactionIndex = data.finances.transactions.findIndex(t => 
                            t.description.includes(sale.invoiceNo)
                        );
                        
                        if (transactionIndex !== -1) {
                            data.finances.transactions.splice(transactionIndex, 1);
                        }
                    }
                    
                    // ফাইনাল স্টকে পণ্য ফেরত যোগ করুন (বিক্রয়কৃত আইটেম আবার যোগ করুন)
                    // এটি আরও জটিল, তাই সহজতর উপায়
                    // বিক্রয় ডিলিট করার সময় ব্যবহারকারীকে সতর্ক করুন
                    
                    data.sales.splice(index, 1);
                    
                    // Invoice ডিলিট
                    const invoiceIndex = data.savedInvoices.findIndex(i => i.invoiceNo === sale.invoiceNo);
                    if (invoiceIndex !== -1) {
                        data.savedInvoices.splice(invoiceIndex, 1);
                    }
                    
                    saveToLocalStorage();
                    loadSales();
                    updateDashboard();
                    loadCustomersForSale();
                    loadCustomersForDuePayments();
                    loadAllCustomersDueList();
                    showNotification('বিক্রয় রেকর্ড ডিলিট করা হয়েছে!', 'success');
                }
            }
        }

        // ক্রেতার বাকী তথ্য লোড করুন
        function loadCustomerDueDetails() {
            const customerId = currentDueCustomerId;
            if (!customerId) return;
            
            const customer = data.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const dueCustomerInfo = document.getElementById('dueCustomerInfo');
            const dueCustomerDetails = document.getElementById('dueCustomerDetails');
            const duePaymentForm = document.getElementById('duePaymentForm');
            const duePaymentHistory = document.getElementById('duePaymentHistory');
            
            if (customer.outstandingBalance <= 0) {
                dueCustomerInfo.style.display = 'block';
                dueCustomerDetails.innerHTML = `
                    <p style="color: #27ae60;"><i class="fas fa-check-circle"></i> ${customer.name} - কোন বাকী নেই</p>
                `;
                duePaymentForm.style.display = 'none';
                duePaymentHistory.style.display = 'none';
                return;
            }
            
            // বাকী তথ্য দেখান
            dueCustomerInfo.style.display = 'block';
            dueCustomerDetails.innerHTML = `
                <p><i class="fas fa-exclamation-circle"></i> <strong>${customer.name}</strong></p>
                <p>মোট বাকী: <span style="color: #e74c3c; font-weight: bold;">${customer.outstandingBalance.toFixed(2)} টাকা</span></p>
                <p>মোট ক্রয়: ${customer.totalPurchases} বার</p>
                <p>মোট ক্রয় মূল্য: ${customer.totalAmount.toFixed(2)} টাকা</p>
                ${customer.lastPurchaseDate ? `<p>সর্বশেষ ক্রয়: ${formatDate(customer.lastPurchaseDate)}</p>` : ''}
            `;
            
            // ফর্ম দেখান
            duePaymentForm.style.display = 'block';
            document.getElementById('duePaymentAmount').value = '';
            document.getElementById('duePaymentMethod').value = 'cash';
            document.getElementById('duePaymentBankGroup').style.display = 'none';
            document.getElementById('duePaymentRemarks').value = '';
            
            // বাকী জমার হিসাব দেখান
            showDuePaymentHistory(customerId);
        }

        // বাকী জমার হিসাব দেখান
        function showDuePaymentHistory(customerId) {
            const duePayments = data.duePayments.filter(dp => dp.customerId === customerId);
            const historyContent = document.getElementById('duePaymentHistoryContent');
            const historyDiv = document.getElementById('duePaymentHistory');
            
            if (duePayments.length === 0) {
                historyDiv.style.display = 'none';
                return;
            }
            
            const totalPaid = duePayments.reduce((sum, dp) => sum + dp.amount, 0);
            
            historyDiv.style.display = 'block';
            historyContent.innerHTML = `
                <p><strong>মোট জমা দেওয়া:</strong> ${totalPaid.toFixed(2)} টাকা</p>
                <p><strong>জমার সংখ্যা:</strong> ${duePayments.length} বার</p>
                <div style="margin-top: 10px; max-height: 200px; overflow-y: auto;">
                    ${duePayments.map(dp => `
                        <div class="due-payment-item">
                            <span>${formatDate(dp.date)}</span>
                            <span class="due-amount">${dp.amount.toFixed(2)} টাকা</span>
                            <span class="due-date">${dp.method === 'cash' ? 'নগদ' : 'ব্যাংক'} ${dp.remarks ? '- ' + dp.remarks : ''}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // বাকী টাকা জমা দিন
        function submitDuePayment() {
            const customerId = currentDueCustomerId;
            if (!customerId) {
                showNotification('ক্রেতা নির্বাচন করুন!', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('duePaymentAmount').value);
            const method = document.getElementById('duePaymentMethod').value;
            const bank = method === 'bank' ? document.getElementById('duePaymentBank').value : null;
            const date = document.getElementById('duePaymentDate').value;
            const remarks = document.getElementById('duePaymentRemarks').value.trim();
            
            if (!amount || amount <= 0 || !date) {
                showNotification('সকল ফিল্ড পূরণ করুন!', 'error');
                return;
            }
            
            const customer = data.customers.find(c => c.id === customerId);
            if (!customer) {
                showNotification('ক্রেতা পাওয়া যায়নি!', 'error');
                return;
            }
            
            if (amount > customer.outstandingBalance) {
                showNotification('জমার পরিমাণ বাকী টাকার চেয়ে বেশি হতে পারবে না!', 'error');
                return;
            }
            
            // ক্রেতার বাকী কমানো
            customer.outstandingBalance -= amount;
            
            // নগদ বা ব্যাংক আপডেট
            if (method === 'cash') {
                data.finances.cash += amount;
                
                // লেনদেন রেকর্ড
                const transaction = {
                    id: generateId(),
                    date: date,
                    description: `বাকী জমা: ${customer.name}${remarks ? ' - ' + remarks : ''}`,
                    type: 'income',
                    amount: amount,
                    balance: data.finances.cash,
                    method: 'cash',
                    bank: null,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(transaction);
                
            } else if (method === 'bank' && bank) {
                data.finances.banks[bank].balance += amount;
                
                // লেনদেন রেকর্ড
                const transaction = {
                    id: generateId(),
                    date: date,
                    description: `বাকী জমা: ${customer.name}${remarks ? ' - ' + remarks : ''}`,
                    type: 'income',
                    amount: amount,
                    balance: data.finances.banks[bank].balance,
                    method: 'bank',
                    bank: bank,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(transaction);
            }
            
            // বাকী জমা রেকর্ড সংরক্ষণ
            const duePayment = {
                id: generateId(),
                customerId: customerId,
                customerName: customer.name,
                amount: amount,
                date: date,
                method: method,
                bank: bank,
                remarks: remarks,
                createdAt: new Date().toISOString()
            };
            
            data.duePayments.push(duePayment);
            saveToLocalStorage();
            
            // ফর্ম রিসেট
            document.getElementById('duePaymentAmount').value = '';
            document.getElementById('duePaymentRemarks').value = '';
            
            // তথ্য আপডেট
            loadCustomerDueDetails();
            loadAllCustomersDueList();
            updateDashboard();
            loadCustomersForSale();
            
            showNotification('বাকী টাকা সফলভাবে জমা দেওয়া হয়েছে!', 'success');
        }

        // সকল ক্রেতার বাকী তালিকা লোড করুন
        function loadAllCustomersDueList() {
            const container = document.getElementById('allCustomersDueList');
            container.innerHTML = '';
            
            const customersWithDue = data.customers.filter(c => c.outstandingBalance > 0);
            
            if (customersWithDue.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #27ae60;">
                        <i class="fas fa-check-circle" style="font-size: 48px;"></i>
                        <h3>কোন ক্রেতার বাকী নেই</h3>
                        <p>সকল ক্রেতার বাকী টাকা পরিশোধিত</p>
                    </div>
                `;
                return;
            }
            
            // মোট বাকী হিসাব
            const totalDue = customersWithDue.reduce((sum, customer) => sum + customer.outstandingBalance, 0);
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>মোট বাকী: <span style="color: #e74c3c;">${totalDue.toFixed(2)} টাকা</span></h3>
                    <p>ক্রেতা সংখ্যা: ${customersWithDue.length} জন</p>
                </div>
            `;
            
            customersWithDue.forEach(customer => {
                let cardClass = 'customer-due-card';
                let amountClass = 'customer-due-amount';
                
                if (customer.outstandingBalance < 1000) {
                    cardClass += ' low';
                    amountClass += ' low';
                } else if (customer.outstandingBalance === 0) {
                    cardClass += ' paid';
                    amountClass += ' paid';
                }
                
                const card = document.createElement('div');
                card.className = cardClass;
                card.innerHTML = `
                    <h4>${customer.name}</h4>
                    <p>${customer.phone || 'মোবাইল: নাই'}</p>
                    <p>${customer.address || 'ঠিকানা: নাই'}</p>
                    <div class="${amountClass}">${customer.outstandingBalance.toFixed(2)} টাকা</div>
                    <p>মোট ক্রয়: ${customer.totalPurchases} বার</p>
                    <p>মোট ক্রয় মূল্য: ${customer.totalAmount.toFixed(2)} টাকা</p>
                    <div class="btn-group" style="margin-top: 15px;">
                        <button class="btn btn-sm btn-success" onclick="quickDuePayment('${customer.id}')">
                            <i class="fas fa-money-bill-wave"></i> জমা দিন
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="viewCustomerDetails('${customer.id}')">
                            <i class="fas fa-eye"></i> বিস্তারিত
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // দ্রুত বাকী জমা
        function quickDuePayment(customerId) {
            currentDueCustomerId = customerId;
            document.getElementById('duePaymentCustomer').value = customerId;
            loadCustomerDueDetails();
        }

        // ক্রেতা বিস্তারিত দেখুন
        function viewCustomerDetails(customerId) {
            const customer = data.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            // ক্রেতার সমস্ত বিক্রয় দেখান
            const customerSales = data.sales.filter(s => s.customerId === customerId);
            const duePayments = data.duePayments.filter(dp => dp.customerId === customerId);
            
            let detailsHTML = `
                <h3>ক্রেতা বিস্তারিত: ${customer.name}</h3>
                <div class="form-row">
                    <div class="form-group">
                        <p><strong>মোবাইল:</strong> ${customer.phone || 'নাই'}</p>
                        <p><strong>ঠিকানা:</strong> ${customer.address || 'নাই'}</p>
                        <p><strong>মোট ক্রয়:</strong> ${customer.totalPurchases} বার</p>
                        <p><strong>মোট ক্রয় মূল্য:</strong> ${customer.totalAmount.toFixed(2)} টাকা</p>
                        <p><strong>বর্তমান বাকী:</strong> ${customer.outstandingBalance.toFixed(2)} টাকা</p>
                    </div>
                </div>
            `;
            
            if (customerSales.length > 0) {
                detailsHTML += `
                    <h4>বিক্রয়ের তালিকা:</h4>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="padding: 8px; border: 1px solid #ddd;">তারিখ</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Invoice No</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">মোট দাম</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">পেমেন্ট</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">অবস্থা</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                customerSales.forEach(sale => {
                    detailsHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(sale.date)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${sale.invoiceNo}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${sale.totalAmount.toFixed(2)} টাকা</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${sale.paymentMethod === 'cash' ? 'নগদ' : sale.paymentMethod === 'bank' ? 'ব্যাংক' : 'বাকি'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <span style="color: ${sale.status === 'due' ? '#e74c3c' : '#27ae60'}">
                                    ${sale.status === 'due' ? 'বাকি' : 'পরিশোধিত'}
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                detailsHTML += `</tbody></table>`;
            }
            
            if (duePayments.length > 0) {
                detailsHTML += `
                    <h4 style="margin-top: 20px;">জমার তালিকা:</h4>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="padding: 8px; border: 1px solid #ddd;">তারিখ</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">পরিমাণ</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">পদ্ধতি</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">মন্তব্য</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                duePayments.forEach(payment => {
                    detailsHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(payment.date)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; color: #27ae60;">${payment.amount.toFixed(2)} টাকা</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${payment.method === 'cash' ? 'নগদ' : 'ব্যাংক'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${payment.remarks || 'নাই'}</td>
                        </tr>
                    `;
                });
                
                detailsHTML += `</tbody></table>`;
            }
            
            // মডাল তৈরি
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
                    ${detailsHTML}
                    <div class="btn-group" style="margin-top: 20px; justify-content: center;">
                        <button class="btn btn-primary" onclick="quickDuePayment('${customerId}')">
                            <i class="fas fa-money-bill-wave"></i> বাকী জমা দিন
                        </button>
                        <button class="btn btn-danger" onclick="this.closest('.modal').style.display='none'">
                            <i class="fas fa-times"></i> বন্ধ করুন
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // আর্থিক তথ্য আপডেট করুন
        function updateFinanceDisplay() {
            document.getElementById('cashAmount').textContent = `${data.finances.cash.toFixed(2)} টাকা`;
            document.getElementById('cashBalance').textContent = `${data.finances.cash.toFixed(2)} টাকা`;
            
            // ব্যাংক 1
            document.getElementById('bank1Name').textContent = data.finances.banks.bank1.name;
            document.getElementById('bank1Amount').textContent = `${data.finances.banks.bank1.balance.toFixed(2)} টাকা`;
            
            // ব্যাংক 2
            document.getElementById('bank2Name').textContent = data.finances.banks.bank2.name;
            document.getElementById('bank2Amount').textContent = `${data.finances.banks.bank2.balance.toFixed(2)} টাকা`;
            
            // ব্যাংক 3
            document.getElementById('bank3Name').textContent = data.finances.banks.bank3.name;
            document.getElementById('bank3Amount').textContent = `${data.finances.banks.bank3.balance.toFixed(2)} টাকা`;
            
            // মোট ব্যাংক ব্যালেন্স
            const totalBankBalance = data.finances.banks.bank1.balance + 
                                    data.finances.banks.bank2.balance + 
                                    data.finances.banks.bank3.balance;
            
            document.getElementById('bankBalance').textContent = `${totalBankBalance.toFixed(2)} টাকা`;
            
            // মোট বেতন বকেয়া
            const totalSalaryDue = calculateTotalSalaryDue();
            document.getElementById('totalSalaryDue').textContent = `${totalSalaryDue.toFixed(2)} টাকা`;
            
            // আজকের বিক্রয়
            const today = new Date().toISOString().split('T')[0];
            const todaySales = data.sales
                .filter(s => s.date === today && s.paymentMethod !== 'due')
                .reduce((sum, sale) => sum + sale.totalAmount, 0);
            
            document.getElementById('todaySales').textContent = `${todaySales.toFixed(2)} টাকা`;
            
            // মোট ক্রেতা বাকী
            const totalCustomerDue = data.customers.reduce((sum, customer) => sum + customer.outstandingBalance, 0);
            document.getElementById('totalCustomerDue').textContent = `${totalCustomerDue.toFixed(2)} টাকা`;
        }

        // মোট বেতন বকেয়া হিসাব করুন
        function calculateTotalSalaryDue() {
            let totalDue = 0;
            
            data.workers.forEach(worker => {
                if (worker.active) {
                    let totalSalary = 0;
                    
                    if (worker.category === 'general') {
                        // সাধারণ শ্রমিকের জন্য দৈনিক বেতন থেকে অগ্রীম বিয়োগ
                        const advancePayments = data.advancePayments.filter(ap => ap.workerId === worker.id);
                        const totalAdvance = advancePayments.reduce((sum, ap) => sum + ap.amount, 0);
                        
                        // সাধারণ শ্রমিকের জন্য গত 30 দিনের উপস্থিতি হিসাব
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        const startDate = thirtyDaysAgo.toISOString().split('T')[0];
                        const endDate = new Date().toISOString().split('T')[0];
                        
                        const attendances = data.attendances.filter(a => 
                            a.workerId === worker.id && 
                            a.date >= startDate && 
                            a.date <= endDate
                        );
                        
                        let totalAttendance = 0;
                        attendances.forEach(attendance => {
                            let attendanceRate = 0;
                            switch(attendance.status) {
                                case 'present':
                                    attendanceRate = 1;
                                    break;
                                case 'half_day':
                                    attendanceRate = 0.5;
                                    break;
                                case 'late':
                                    attendanceRate = 0.75;
                                    break;
                                default:
                                    attendanceRate = 0;
                            }
                            
                            totalAttendance += attendanceRate;
                        });
                        
                        totalSalary = totalAttendance * worker.dailyRate;
                        
                    } else {
                        // উৎপাদন শ্রমিকের জন্য
                        const productions = data.productions.filter(p => 
                            p.workerId === worker.id
                        );
                        
                        productions.forEach(production => {
                            totalSalary += production.salary;
                        });
                    }
                    
                    // অগ্রীম বেতন
                    const advancePayments = data.advancePayments.filter(ap => ap.workerId === worker.id);
                    const totalAdvance = advancePayments.reduce((sum, ap) => sum + ap.amount, 0);
                    
                    const dueSalary = totalSalary - totalAdvance;
                    if (dueSalary > 0) {
                        totalDue += dueSalary;
                    }
                }
            });
            
            return totalDue;
        }

        // নগদ/ব্যাংক মডাল খুলুন
        function openCashModal(action, type) {
            const modal = document.getElementById('cashModal');
            const title = document.getElementById('modalTitle');
            const amountLabel = document.getElementById('modalAmountLabel');
            const confirmBtn = document.getElementById('modalConfirmBtn');
            const bankNameGroup = document.getElementById('modalBankNameGroup');
            
            modal.dataset.action = action;
            modal.dataset.type = type;
            
            if (action === 'add') {
                title.textContent = 'নগদ যোগ করুন';
                amountLabel.textContent = 'পরিমাণ (টাকা)';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> যোগ করুন';
            } else if (action === 'withdraw') {
                title.textContent = 'নগদ উত্তোলন';
                amountLabel.textContent = 'পরিমাণ (টাকা)';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> উত্তোলন করুন';
            } else if (action === 'edit') {
                title.textContent = `${data.finances.banks[type].name} ব্যাংকের নাম পরিবর্তন`;
                amountLabel.textContent = 'নতুন ব্যাংকের নাম';
                bankNameGroup.style.display = 'block';
                document.getElementById('modalBankName').value = data.finances.banks[type].name;
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> পরিবর্তন করুন';
            } else if (action === 'deposit') {
                title.textContent = `${data.finances.banks[type].name} ব্যাংকে জমা করুন`;
                amountLabel.textContent = 'পরিমাণ (টাকা)';
                bankNameGroup.style.display = 'none';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i> জমা করুন';
            }
            
            document.getElementById('modalAmount').value = '';
            document.getElementById('modalDescription').value = '';
            document.getElementById('modalDate').value = new Date().toISOString().split('T')[0];
            
            modal.style.display = 'block';
        }

        // মডাল নিশ্চিত করুন
        function confirmModal() {
            const modal = document.getElementById('cashModal');
            const action = modal.dataset.action;
            const type = modal.dataset.type;
            const amount = parseFloat(document.getElementById('modalAmount').value) || 0;
            const bankName = document.getElementById('modalBankName').value;
            const description = document.getElementById('modalDescription').value.trim();
            const date = document.getElementById('modalDate').value;
            
            if (!date) {
                showNotification('তারিখ পূরণ করুন!', 'error');
                return;
            }
            
            if (action === 'edit') {
                // ব্যাংকের নাম পরিবর্তন
                if (!bankName.trim()) {
                    showNotification('ব্যাংকের নাম পূরণ করুন!', 'error');
                    return;
                }
                
                data.finances.banks[type].name = bankName.trim();
                saveToLocalStorage();
                updateFinanceDisplay();
                showNotification('ব্যাংকের নাম পরিবর্তন করা হয়েছে!', 'success');
                
            } else if (action === 'add') {
                // নগদ যোগ
                if (!amount || amount <= 0) {
                    showNotification('সঠিক পরিমাণ দিন!', 'error');
                    return;
                }
                
                data.finances.cash += amount;
                
                // লেনদেন রেকর্ড
                const transaction = {
                    id: generateId(),
                    date: date,
                    description: description || 'নগদ যোগ',
                    type: 'income',
                    amount: amount,
                    balance: data.finances.cash,
                    method: 'cash',
                    bank: null,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(transaction);
                
                saveToLocalStorage();
                updateFinanceDisplay();
                showNotification('নগদ যোগ করা হয়েছে!', 'success');
                
            } else if (action === 'withdraw') {
                // নগদ উত্তোলন
                if (!amount || amount <= 0) {
                    showNotification('সঠিক পরিমাণ দিন!', 'error');
                    return;
                }
                
                if (data.finances.cash < amount) {
                    showNotification('নগদ তহবিলে পর্যাপ্ত টাকা নেই!', 'error');
                    return;
                }
                
                data.finances.cash -= amount;
                
                // লেনদেন রেকর্ড
                const transaction = {
                    id: generateId(),
                    date: date,
                    description: description || 'নগদ উত্তোলন',
                    type: 'expense',
                    amount: amount,
                    balance: data.finances.cash,
                    method: 'cash',
                    bank: null,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(transaction);
                
                saveToLocalStorage();
                updateFinanceDisplay();
                showNotification('নগদ উত্তোলন করা হয়েছে!', 'success');
                
            } else if (action === 'deposit') {
                // ব্যাংকে জমা
                if (!amount || amount <= 0) {
                    showNotification('সঠিক পরিমাণ দিন!', 'error');
                    return;
                }
                
                if (data.finances.cash < amount) {
                    showNotification('নগদ তহবিলে পর্যাপ্ত টাকা নেই!', 'error');
                    return;
                }
                
                data.finances.cash -= amount;
                data.finances.banks[type].balance += amount;
                
                // লেনদেন রেকর্ড (নগদ থেকে)
                const cashTransaction = {
                    id: generateId(),
                    date: date,
                    description: description || `${data.finances.banks[type].name} ব্যাংকে জমা`,
                    type: 'expense',
                    amount: amount,
                    balance: data.finances.cash,
                    method: 'cash',
                    bank: null,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(cashTransaction);
                
                // লেনদেন রেকর্ড (ব্যাংকে যোগ)
                const bankTransaction = {
                    id: generateId(),
                    date: date,
                    description: description || 'নগদ থেকে ব্যাংকে জমা',
                    type: 'income',
                    amount: amount,
                    balance: data.finances.banks[type].balance,
                    method: 'bank',
                    bank: type,
                    createdAt: new Date().toISOString()
                };
                data.finances.transactions.push(bankTransaction);
                
                saveToLocalStorage();
                updateFinanceDisplay();
                showNotification('ব্যাংকে জমা করা হয়েছে!', 'success');
            }
            
            closeModal();
            loadTransactions();
        }

        // মডাল বন্ধ করুন
        function closeModal() {
            document.getElementById('cashModal').style.display = 'none';
        }

        // অগ্রীম বেতন মডাল বন্ধ করুন
        function closeAdvanceModal() {
            document.getElementById('advanceModal').style.display = 'none';
        }

        // বাকী টাকা জমা মডাল বন্ধ করুন
        function closeDuePaymentModal() {
            document.getElementById('duePaymentModal').style.display = 'none';
        }

        // অন্যান্য খরচ যোগ করুন
        function addOtherExpense() {
            const type = document.getElementById('expenseType').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const date = document.getElementById('expenseDate').value;
            const description = document.getElementById('expenseDescription').value.trim();
            
            if (!type || !amount || amount <= 0 || !date) {
                showNotification('সকল ফিল্ড পূরণ করুন!', 'error');
                return;
            }
            
            const expenseTypes = {
                'transport': 'ট্রান্সপোর্ট',
                'electricity': 'বিদ্যুৎ বিল',
                'gas': 'গ্যাস বিল',
                'repair': 'মেরামত',
                'raw_material': 'কাঁচামাল',
                'office': 'অফিস খরচ',
                'other': 'অন্যান্য'
            };
            
            // নগদ তহবিল চেক
            if (data.finances.cash < amount) {
                showNotification('নগদ তহবিলে পর্যাপ্ত টাকা নেই!', 'error');
                return;
            }
            
            // নগদ থেকে খরচ
            data.finances.cash -= amount;
            
            // লেনদেন রেকর্ড
            const transaction = {
                id: generateId(),
                date: date,
                description: `${expenseTypes[type]} খরচ${description ? ': ' + description : ''}`,
                type: 'expense',
                amount: amount,
                balance: data.finances.cash,
                method: 'cash',
                bank: null,
                createdAt: new Date().toISOString()
            };
            data.finances.transactions.push(transaction);
            
            // খরচ রেকর্ড সংরক্ষণ
            const expense = {
                id: generateId(),
                type: type,
                typeName: expenseTypes[type],
                amount: amount,
                date: date,
                description: description,
                createdAt: new Date().toISOString()
            };
            
            data.otherExpenses.push(expense);
            saveToLocalStorage();
            
            // ফর্ম রিসেট
            document.getElementById('expenseType').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
            
            showNotification('খরচ যোগ করা হয়েছে!', 'success');
            updateDashboard();
            loadTransactions();
        }

        // লেনদেন ফিল্টার করুন
        function filterTransactions() {
            const startDate = document.getElementById('transactionStartDate').value;
            const endDate = document.getElementById('transactionEndDate').value;
            
            loadTransactions(startDate, endDate);
        }

        // লেনদেন লোড করুন
        function loadTransactions(startDate = null, endDate = null) {
            const tbody = document.getElementById('transactionsTableBody');
            tbody.innerHTML = '';
            
            let filteredTransactions = data.finances.transactions;
            
            if (startDate && endDate) {
                filteredTransactions = data.finances.transactions.filter(t => 
                    t.date >= startDate && t.date <= endDate
                );
            }
            
            if (filteredTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px;">কোন লেনদেন রেকর্ড নেই</td></tr>';
                return;
            }
            
            // তারিখ অনুযায়ী সাজান (নতুন থেকে পুরাতন)
            filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredTransactions.forEach((transaction, index) => {
                const methodText = transaction.method === 'cash' ? 'নগদ' : 
                                 transaction.method === 'bank' ? 'ব্যাংক' : 
                                 transaction.method === 'due' ? 'বাকি' : 'অন্যান্য';
                
                const bankName = transaction.bank ? data.finances.banks[transaction.bank].name : '';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.description}</td>
                    <td>
                        <span style="color: ${transaction.type === 'income' ? '#27ae60' : '#e74c3c'};">
                            ${transaction.type === 'income' ? 'আয়' : 'ব্যয়'}
                        </span>
                    </td>
                    <td>
                        <span style="color: ${transaction.type === 'income' ? '#27ae60' : '#e74c3c'}; font-weight: bold;">
                            ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toFixed(2)} টাকা
                        </span>
                    </td>
                    <td>${transaction.balance.toFixed(2)} টাকা</td>
                    <td>${methodText} ${bankName ? '(' + bankName + ')' : ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // রিপোর্ট জেনারেট করুন
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                showNotification('শুরু ও শেষ তারিখ পূরণ করুন!', 'error');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showNotification('শেষ তারিখ শুরু তারিখের পরে হতে হবে!', 'error');
                return;
            }
            
            let reportHTML = '';
            
            switch(reportType) {
                case 'production':
                    reportHTML = generateProductionReport(startDate, endDate);
                    break;
                case 'salary':
                    reportHTML = generateSalaryReport(startDate, endDate);
                    break;
                case 'sales':
                    reportHTML = generateSalesReport(startDate, endDate);
                    break;
                case 'stock':
                    reportHTML = generateStockReport();
                    break;
                case 'finance':
                    reportHTML = generateFinanceReport(startDate, endDate);
                    break;
                case 'customerDue':
                    reportHTML = generateCustomerDueReport();
                    break;
            }
            
            const reportPreview = document.getElementById('reportPreview');
            reportPreview.innerHTML = reportHTML;
            
            document.getElementById('printReportBtn').style.display = 'inline-block';
        }

        // উৎপাদন রিপোর্ট
        function generateProductionReport(startDate, endDate) {
            const filteredProductions = data.productions.filter(p => 
                p.date >= startDate && p.date <= endDate
            );
            
            let reportHTML = `
                <h3>উৎপাদন রিপোর্ট</h3>
                <p><strong>তারিখ:</strong> ${formatDate(startDate)} থেকে ${formatDate(endDate)}</p>
                <p><strong>মোট এন্ট্রি:</strong> ${filteredProductions.length} টি</p>
            `;
            
            if (filteredProductions.length === 0) {
                reportHTML += '<p style="text-align: center; padding: 20px;">কোন উৎপাদন রেকর্ড নেই</p>';
                return reportHTML;
            }
            
            // শ্রমিক প্রকার অনুযায়ী গ্রুপিং
            const dhaliProductions = filteredProductions.filter(p => p.workerType === 'dhali');
            const ghosaProductions = filteredProductions.filter(p => p.workerType === 'ghosa');
            const chilaProductions = filteredProductions.filter(p => p.workerType === 'chila');
            const balaProductions = filteredProductions.filter(p => p.workerType === 'bala_kata');
            
            reportHTML += `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px;">
                        <h4>ঢালাই শ্রমিক</h4>
                        <p>মোট এন্ট্রি: ${dhaliProductions.length}</p>
                        <p>মোট বেতন: ${dhaliProductions.reduce((sum, p) => sum + p.salary, 0).toFixed(2)} টাকা</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                        <h4>ঘষা মহিলা শ্রমিক</h4>
                        <p>মোট এন্ট্রি: ${ghosaProductions.length}</p>
                        <p>মোট বেতন: ${ghosaProductions.reduce((sum, p) => sum + p.salary, 0).toFixed(2)} টাকা</p>
                    </div>
                    <div style="background: #d5f4e6; padding: 15px; border-radius: 8px;">
                        <h4>ছিলা শ্রমিক</h4>
                        <p>মোট এন্ট্রি: ${chilaProductions.length}</p>
                        <p>মোট বেতন: ${chilaProductions.reduce((sum, p) => sum + p.salary, 0).toFixed(2)} টাকা</p>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px;">
                        <h4>বালা কাটা</h4>
                        <p>মোট এন্ট্রি: ${balaProductions.length}</p>
                        <p>মোট বেতন: ${balaProductions.reduce((sum, p) => sum + p.salary, 0).toFixed(2)} টাকা</p>
                    </div>
                </div>
            `;
            
            // বিস্তারিত তালিকা
            reportHTML += `
                <h4>বিস্তারিত উৎপাদন তালিকা</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">তারিখ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">শ্রমিক</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পণ্য</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পরিমাণ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">বিভাগ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">বেতন</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredProductions.forEach(production => {
                reportHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(production.date)}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${production.workerName}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${production.productName}${production.productType ? ' (' + production.productType + ')' : ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${production.quantity} পিচ</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">
                            ${production.workerType === 'dhali' ? 'ঢালাই' : 
                              production.workerType === 'ghosa' ? 'ঘষা' : 
                              production.workerType === 'chila' ? 'ছিলা' : 
                              'বালা কাটা'}
                        </td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${production.salary.toFixed(2)} টাকা</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                    </tbody>
                </table>
                <p style="margin-top: 20px; font-weight: bold; text-align: right;">
                    মোট উৎপাদন বেতন: ${filteredProductions.reduce((sum, p) => sum + p.salary, 0).toFixed(2)} টাকা
                </p>
            `;
            
            return reportHTML;
        }

        // বেতন রিপোর্ট জেনারেট ফাংশন (সংশোধিত ভার্সন)
function generateSalaryReport(startDate, endDate) {
    let reportHTML = `
        <div class="report-header">
            <h3>বেতন রিপোর্ট</h3>
            <p><strong>তারিখ:</strong> ${formatDate(startDate)} থেকে ${formatDate(endDate)}</p>
            <p><strong>রিপোর্ট তারিখ:</strong> ${formatDate(new Date().toISOString().split('T')[0])}</p>
        </div>
    `;
    
    // শ্রমিক প্রকার অনুযায়ী বেতন হিসাব
    const workers = data.workers.filter(w => w.active);
    let totalSalary = 0;
    let totalAdvance = 0;
    let totalDue = 0;
    let totalPaid = 0;
    
    // শ্রমিক প্রকার অনুযায়ী গ্রুপিং
    const dhaliWorkers = workers.filter(w => w.category === 'dhali');
    const ghosaWorkers = workers.filter(w => w.category === 'ghosa');
    const chilaWorkers = workers.filter(w => w.category === 'chila');
    const generalWorkers = workers.filter(w => w.category === 'general');
    const balaWorkers = workers.filter(w => w.category === 'bala_kata');
    
    let detailedHTML = `
        <div class="report-section">
            <h4>বিস্তারিত বেতন তালিকা</h4>
            <table class="report-table">
                <thead>
                    <tr>
                        <th>ক্রমিক</th>
                        <th>শ্রমিক</th>
                        <th>বিভাগ</th>
                        <th>পদবী</th>
                        <th>মোট কাজ</th>
                        <th>মোট বেতন</th>
                        <th>অগ্রীম বেতন</th>
                        <th>পরিশোধিত বেতন</th>
                        <th>বকেয়া বেতন</th>
                        <th>অবস্থা</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    let serialNo = 1;
    
    // ঢালাই শ্রমিক
    dhaliWorkers.forEach(worker => {
        const result = calculateWorkerSalary(worker.id, startDate, endDate);
        const status = result.dueSalary > 0 ? 'বকেয়া' : 'পরিশোধিত';
        const statusColor = result.dueSalary > 0 ? '#e74c3c' : '#27ae60';
        
        detailedHTML += `
            <tr>
                <td>${serialNo++}</td>
                <td>${worker.name}</td>
                <td>ঢালাই শ্রমিক</td>
                <td>${worker.designation || 'নাই'}</td>
                <td>${result.totalWork} পিচ</td>
                <td>${result.totalSalary.toFixed(2)} টাকা</td>
                <td>${result.totalAdvance.toFixed(2)} টাকা</td>
                <td>${result.paidSalary.toFixed(2)} টাকা</td>
                <td>${result.dueSalary.toFixed(2)} টাকা</td>
                <td style="color: ${statusColor}">${status}</td>
            </tr>
        `;
        
        totalSalary += result.totalSalary;
        totalAdvance += result.totalAdvance;
        totalDue += result.dueSalary;
        totalPaid += result.paidSalary;
    });
    
    // ঘষা মহিলা শ্রমিক
    ghosaWorkers.forEach(worker => {
        const result = calculateWorkerSalary(worker.id, startDate, endDate);
        const status = result.dueSalary > 0 ? 'বকেয়া' : 'পরিশোধিত';
        const statusColor = result.dueSalary > 0 ? '#e74c3c' : '#27ae60';
        
        detailedHTML += `
            <tr>
                <td>${serialNo++}</td>
                <td>${worker.name}</td>
                <td>ঘষা মহিলা শ্রমিক</td>
                <td>${worker.designation || 'নাই'}</td>
                <td>${result.totalWork} পিচ</td>
                <td>${result.totalSalary.toFixed(2)} টাকা</td>
                <td>${result.totalAdvance.toFixed(2)} টাকা</td>
                <td>${result.paidSalary.toFixed(2)} টাকা</td>
                <td>${result.dueSalary.toFixed(2)} টাকা</td>
                <td style="color: ${statusColor}">${status}</td>
            </tr>
        `;
        
        totalSalary += result.totalSalary;
        totalAdvance += result.totalAdvance;
        totalDue += result.dueSalary;
        totalPaid += result.paidSalary;
    });
    
    // ছিলা শ্রমিক
    chilaWorkers.forEach(worker => {
        const result = calculateWorkerSalary(worker.id, startDate, endDate);
        const status = result.dueSalary > 0 ? 'বকেয়া' : 'পরিশোধিত';
        const statusColor = result.dueSalary > 0 ? '#e74c3c' : '#27ae60';
        
        detailedHTML += `
            <tr>
                <td>${serialNo++}</td>
                <td>${worker.name}</td>
                <td>ছিলা শ্রমিক</td>
                <td>${worker.designation || 'নাই'}</td>
                <td>${result.totalWork} পিচ</td>
                <td>${result.totalSalary.toFixed(2)} টাকা</td>
                <td>${result.totalAdvance.toFixed(2)} টাকা</td>
                <td>${result.paidSalary.toFixed(2)} টাকা</td>
                <td>${result.dueSalary.toFixed(2)} টাকা</td>
                <td style="color: ${statusColor}">${status}</td>
            </tr>
        `;
        
        totalSalary += result.totalSalary;
        totalAdvance += result.totalAdvance;
        totalDue += result.dueSalary;
        totalPaid += result.paidSalary;
    });
    
    // সাধারণ শ্রমিক
    generalWorkers.forEach(worker => {
        const result = calculateWorkerSalary(worker.id, startDate, endDate);
        const status = result.dueSalary > 0 ? 'বকেয়া' : 'পরিশোধিত';
        const statusColor = result.dueSalary > 0 ? '#e74c3c' : '#27ae60';
        
        detailedHTML += `
            <tr>
                <td>${serialNo++}</td>
                <td>${worker.name}</td>
                <td>সাধারণ শ্রমিক</td>
                <td>${worker.designation || 'নাই'}</td>
                <td>${result.totalWork} দিন</td>
                <td>${result.totalSalary.toFixed(2)} টাকা</td>
                <td>${result.totalAdvance.toFixed(2)} টাকা</td>
                <td>${result.paidSalary.toFixed(2)} টাকা</td>
                <td>${result.dueSalary.toFixed(2)} টাকা</td>
                <td style="color: ${statusColor}">${status}</td>
            </tr>
        `;
        
        totalSalary += result.totalSalary;
        totalAdvance += result.totalAdvance;
        totalDue += result.dueSalary;
        totalPaid += result.paidSalary;
    });
    
    // বালা কাটা শ্রমিক
    balaWorkers.forEach(worker => {
        const result = calculateWorkerSalary(worker.id, startDate, endDate);
        const status = result.dueSalary > 0 ? 'বকেয়া' : 'পরিশোধিত';
        const statusColor = result.dueSalary > 0 ? '#e74c3c' : '#27ae60';
        
        detailedHTML += `
            <tr>
                <td>${serialNo++}</td>
                <td>${worker.name}</td>
                <td>বালা কাটা</td>
                <td>${worker.designation || 'নাই'}</td>
                <td>${result.totalWork} পিচ</td>
                <td>${result.totalSalary.toFixed(2)} টাকা</td>
                <td>${result.totalAdvance.toFixed(2)} টাকা</td>
                <td>${result.paidSalary.toFixed(2)} টাকা</td>
                <td>${result.dueSalary.toFixed(2)} টাকা</td>
                <td style="color: ${statusColor}">${status}</td>
            </tr>
        `;
        
        totalSalary += result.totalSalary;
        totalAdvance += result.totalAdvance;
        totalDue += result.dueSalary;
        totalPaid += result.paidSalary;
    });
    
    detailedHTML += `
                </tbody>
            </table>
        </div>
    `;
    
    // সারাংশ কার্ড
    reportHTML += `
        <div class="summary-cards">
            <div class="summary-card" style="background: #e8f4fc; border-left: 5px solid #3498db;">
                <h4>মোট শ্রমিক</h4>
                <p class="summary-value">${workers.length} জন</p>
                <p>সকল শ্রমিক</p>
            </div>
            
            <div class="summary-card" style="background: #d5f4e6; border-left: 5px solid #27ae60;">
                <h4>মোট বেতন</h4>
                <p class="summary-value">${totalSalary.toFixed(2)} টাকা</p>
                <p>সকল শ্রমিকের মোট বেতন</p>
            </div>
            
            <div class="summary-card" style="background: #fff3cd; border-left: 5px solid #f39c12;">
                <h4>মোট অগ্রীম</h4>
                <p class="summary-value">${totalAdvance.toFixed(2)} টাকা</p>
                <p>মোট প্রদত্ত অগ্রীম</p>
            </div>
            
            <div class="summary-card" style="background: #e8f4fc; border-left: 5px solid #3498db;">
                <h4>মোট পরিশোধিত</h4>
                <p class="summary-value">${totalPaid.toFixed(2)} টাকা</p>
                <p>মোট পরিশোধিত বেতন</p>
            </div>
            
            <div class="summary-card" style="background: ${totalDue > 0 ? '#ffefef' : '#d5f4e6'}; border-left: 5px solid ${totalDue > 0 ? '#e74c3c' : '#27ae60'}">
                <h4>মোট বকেয়া</h4>
                <p class="summary-value" style="color: ${totalDue > 0 ? '#e74c3c' : '#27ae60'}">${totalDue.toFixed(2)} টাকা</p>
                <p>${totalDue > 0 ? 'মোট বাকী বেতন' : 'সব বেতন পরিশোধিত'}</p>
            </div>
        </div>
        
        <div class="category-summary">
            <h4>শ্রমিক প্রকার অনুযায়ী সারাংশ</h4>
            <table class="report-table">
                <thead>
                    <tr>
                        <th>শ্রমিক প্রকার</th>
                        <th>শ্রমিক সংখ্যা</th>
                        <th>মোট বেতন</th>
                        <th>অগ্রীম</th>
                        <th>পরিশোধিত</th>
                        <th>বকেয়া</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ঢালাই শ্রমিক</td>
                        <td>${dhaliWorkers.length} জন</td>
                        <td>${calculateCategoryTotal(dhaliWorkers, startDate, endDate).totalSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(dhaliWorkers, startDate, endDate).totalAdvance.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(dhaliWorkers, startDate, endDate).paidSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(dhaliWorkers, startDate, endDate).dueSalary.toFixed(2)} টাকা</td>
                    </tr>
                    <tr>
                        <td>ঘষা মহিলা শ্রমিক</td>
                        <td>${ghosaWorkers.length} জন</td>
                        <td>${calculateCategoryTotal(ghosaWorkers, startDate, endDate).totalSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(ghosaWorkers, startDate, endDate).totalAdvance.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(ghosaWorkers, startDate, endDate).paidSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(ghosaWorkers, startDate, endDate).dueSalary.toFixed(2)} টাকা</td>
                    </tr>
                    <tr>
                        <td>ছিলা শ্রমিক</td>
                        <td>${chilaWorkers.length} জন</td>
                        <td>${calculateCategoryTotal(chilaWorkers, startDate, endDate).totalSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(chilaWorkers, startDate, endDate).totalAdvance.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(chilaWorkers, startDate, endDate).paidSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(chilaWorkers, startDate, endDate).dueSalary.toFixed(2)} টাকা</td>
                    </tr>
                    <tr>
                        <td>সাধারণ শ্রমিক</td>
                        <td>${generalWorkers.length} জন</td>
                        <td>${calculateCategoryTotal(generalWorkers, startDate, endDate).totalSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(generalWorkers, startDate, endDate).totalAdvance.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(generalWorkers, startDate, endDate).paidSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(generalWorkers, startDate, endDate).dueSalary.toFixed(2)} টাকা</td>
                    </tr>
                    <tr>
                        <td>বালা কাটা শ্রমিক</td>
                        <td>${balaWorkers.length} জন</td>
                        <td>${calculateCategoryTotal(balaWorkers, startDate, endDate).totalSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(balaWorkers, startDate, endDate).totalAdvance.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(balaWorkers, startDate, endDate).paidSalary.toFixed(2)} টাকা</td>
                        <td>${calculateCategoryTotal(balaWorkers, startDate, endDate).dueSalary.toFixed(2)} টাকা</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        ${detailedHTML}
        
        <div class="report-footer">
            <p><strong>রিপোর্ট সারাংশ:</strong></p>
            <p>মোট শ্রমিক: ${workers.length} জন</p>
            <p>মোট বেতন: ${totalSalary.toFixed(2)} টাকা</p>
            <p>মোট অগ্রীম: ${totalAdvance.toFixed(2)} টাকা</p>
            <p>মোট পরিশোধিত: ${totalPaid.toFixed(2)} টাকা</p>
            <p>মোট বকেয়া: <span style="color: ${totalDue > 0 ? '#e74c3c' : '#27ae60'}">${totalDue.toFixed(2)} টাকা</span></p>
            <p>অবস্থা: ${totalDue > 0 ? 'বকেয়া আছে' : 'সব বেতন পরিশোধিত'}</p>
        </div>
        
        <style>
            .report-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #3498db; padding-bottom: 15px; }
            .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
            .summary-card { padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
            .summary-value { font-size: 24px; font-weight: bold; margin: 10px 0; }
            .category-summary { margin: 25px 0; }
            .report-section { margin: 25px 0; }
            .report-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
            .report-table th, .report-table td { border: 1px solid #ddd; padding: 10px; text-align: center; }
            .report-table th { background-color: #f8f9fa; font-weight: bold; }
            .report-table tr:hover { background-color: #f9f9f9; }
            .report-footer { margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db; }
        </style>
    `;
    
    return reportHTML;
}

// শ্রমিকের বেতন হিসাব করার ফাংশন
function calculateWorkerSalary(workerId, startDate, endDate) {
    const worker = data.workers.find(w => w.id === workerId);
    if (!worker) return { totalSalary: 0, totalAdvance: 0, dueSalary: 0, paidSalary: 0, totalWork: 0 };
    
    let totalSalary = 0;
    let totalWork = 0;
    
    if (worker.category === 'general') {
        // সাধারণ শ্রমিকের জন্য উপস্থিতি অনুযায়ী বেতন
        const attendances = data.attendances.filter(a => 
            a.workerId === workerId && 
            a.date >= startDate && 
            a.date <= endDate
        );
        
        attendances.forEach(attendance => {
            let attendanceRate = 0;
            switch(attendance.status) {
                case 'present':
                    attendanceRate = 1;
                    break;
                case 'half_day':
                    attendanceRate = 0.5;
                    break;
                case 'late':
                    attendanceRate = 0.75;
                    break;
                default:
                    attendanceRate = 0;
            }
            
            totalWork += attendanceRate;
            totalSalary += worker.dailyRate * attendanceRate;
        });
        
        totalWork = totalWork.toFixed(1) + ' দিন';
    } else {
        // উৎপাদন শ্রমিকের জন্য উৎপাদন অনুযায়ী বেতন
        const productions = data.productions.filter(p => 
            p.workerId === workerId && 
            p.date >= startDate && 
            p.date <= endDate
        );
        
        productions.forEach(production => {
            totalWork += production.quantity;
            totalSalary += production.salary;
        });
        
        totalWork = totalWork.toFixed(0) + ' পিচ';
    }
    
    // অগ্রীম বেতন
    const advancePayments = data.advancePayments.filter(ap => 
        ap.workerId === workerId
    );
    const totalAdvance = advancePayments.reduce((sum, ap) => sum + ap.amount, 0);
    
    // পরিশোধিত বেতন
    const paidPayments = data.payments ? data.payments.filter(p => 
        p.workerId === workerId && 
        p.type === 'salary_payment' &&
        p.date >= startDate && 
        p.date <= endDate
    ) : [];
    const paidSalary = paidPayments.reduce((sum, p) => sum + p.amount, 0);
    
    // বাকী বেতন
    const dueSalary = Math.max(0, totalSalary - totalAdvance - paidSalary);
    
    return {
        totalSalary,
        totalAdvance,
        paidSalary,
        dueSalary,
        totalWork
    };
}

// শ্রমিক প্রকার অনুযায়ী মোট হিসাব
function calculateCategoryTotal(workers, startDate, endDate) {
    let total = {
        totalSalary: 0,
        totalAdvance: 0,
        paidSalary: 0,
        dueSalary: 0
    };
    
    workers.forEach(worker => {
        const result = calculateWorkerSalary(worker.id, startDate, endDate);
        total.totalSalary += result.totalSalary;
        total.totalAdvance += result.totalAdvance;
        total.paidSalary += result.paidSalary;
        total.dueSalary += result.dueSalary;
    });
    
    return total;
}

        // বিক্রয় রিপোর্ট
        function generateSalesReport(startDate, endDate) {
            const filteredSales = data.sales.filter(s => 
                s.date >= startDate && s.date <= endDate
            );
            
            const cashSales = filteredSales.filter(s => s.paymentMethod === 'cash');
            const bankSales = filteredSales.filter(s => s.paymentMethod === 'bank');
            const dueSales = filteredSales.filter(s => s.paymentMethod === 'due');
            
            const cashAmount = cashSales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const bankAmount = bankSales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const dueAmount = dueSales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const totalAmount = cashAmount + bankAmount + dueAmount;
            
            let reportHTML = `
                <h3>বিক্রয় রিপোর্ট</h3>
                <p><strong>তারিখ:</strong> ${formatDate(startDate)} থেকে ${formatDate(endDate)}</p>
                <p><strong>মোট বিক্রয়:</strong> ${filteredSales.length} টি</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px;">
                        <h4>নগদ বিক্রয়</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #27ae60;">${cashAmount.toFixed(2)} টাকা</p>
                        <p>${cashSales.length} টি বিক্রয়</p>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px;">
                        <h4>ব্যাংক বিক্রয়</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #9b59b6;">${bankAmount.toFixed(2)} টাকা</p>
                        <p>${bankSales.length} টি বিক্রয়</p>
                    </div>
                    <div style="background: #ffefef; padding: 15px; border-radius: 8px;">
                        <h4>বাকী বিক্রয়</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #e74c3c;">${dueAmount.toFixed(2)} টাকা</p>
                        <p>${dueSales.length} টি বিক্রয়</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 2px solid #f39c12;">
                        <h4>মোট বিক্রয়</h4>
                        <p style="font-size: 28px; font-weight: bold; color: #f39c12;">${totalAmount.toFixed(2)} টাকা</p>
                        <p>মোট ${filteredSales.length} টি বিক্রয়</p>
                    </div>
                </div>
            `;
            
            if (filteredSales.length === 0) {
                reportHTML += '<p style="text-align: center; padding: 20px;">কোন বিক্রয় রেকর্ড নেই</p>';
                return reportHTML;
            }
            
            // বিস্তারিত তালিকা
            reportHTML += `
                <h4>বিস্তারিত বিক্রয় তালিকা</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">তারিখ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Invoice No</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">ক্রেতা</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">মোট দাম</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পেমেন্ট</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">অবস্থা</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredSales.forEach(sale => {
                reportHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(sale.date)}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${sale.invoiceNo}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${sale.customerName}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${sale.totalAmount.toFixed(2)} টাকা</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">
                            ${sale.paymentMethod === 'cash' ? 'নগদ' : 
                              sale.paymentMethod === 'bank' ? 'ব্যাংক' : 'বাকি'}
                        </td>
                        <td style="padding: 8px; border: 1px solid #ddd;">
                            <span style="color: ${sale.status === 'due' ? '#e74c3c' : '#27ae60'}">
                                ${sale.status === 'due' ? 'বাকি' : 'পরিশোধিত'}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            reportHTML += `
                    </tbody>
                </table>
            `;
            
            return reportHTML;
        }

        // স্টক রিপোর্ট
        function generateStockReport() {
            const firstStockTotal = data.stocks.first.reduce((sum, item) => sum + item.quantity, 0);
            const secondStockTotal = data.stocks.second.reduce((sum, item) => sum + item.quantity, 0);
            const thirdStockTotal = data.stocks.third.reduce((sum, item) => sum + item.quantity, 0);
            const finalStockTotal = data.stocks.final.reduce((sum, item) => sum + item.totalBundles, 0);
            const balaStockTotal = data.stocks.bala.reduce((sum, item) => sum + item.quantity, 0);
            
            let reportHTML = `
                <h3>স্টক রিপোর্ট</h3>
                <p><strong>রিপোর্ট তারিখ:</strong> ${formatDate(new Date().toISOString().split('T')[0])}</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px; border-top: 5px solid #3498db;">
                        <h4>১ম স্টক (ঢালাই)</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #3498db;">${firstStockTotal} পিচ</p>
                        <p>${data.stocks.first.length} প্রকারের পণ্য</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-top: 5px solid #f39c12;">
                        <h4>২য় স্টক (ঘষা)</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #f39c12;">${secondStockTotal} পিচ</p>
                        <p>${data.stocks.second.length} প্রকারের পণ্য</p>
                    </div>
                    <div style="background: #d5f4e6; padding: 15px; border-radius: 8px; border-top: 5px solid #27ae60;">
                        <h4>৩য় স্টক (ছিলা)</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #27ae60;">${thirdStockTotal} পিচ</p>
                        <p>${data.stocks.third.length} প্রকারের পণ্য</p>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; border-top: 5px solid #9b59b6;">
                        <h4>ফাইনাল স্টক</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #9b59b6;">${finalStockTotal} বান্ডিল</p>
                        <p>${data.stocks.final.length} প্রকারের পণ্য</p>
                    </div>
                    <div style="background: #ffefef; padding: 15px; border-radius: 8px; border-top: 5px solid #e74c3c;">
                        <h4>বালা স্টক</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #e74c3c;">${balaStockTotal} পিচ</p>
                        <p>${data.stocks.bala.length} প্রকারের বালা</p>
                    </div>
                </div>
            `;
            
            // বিস্তারিত স্টক তালিকা
            reportHTML += `
                <h4>বিস্তারিত স্টক তালিকা</h4>
                
                <h5>১ম স্টক (ঢালাই)</h5>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">পণ্যের নাম</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পরিমাণ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (data.stocks.first.length === 0) {
                reportHTML += `
                    <tr>
                        <td colspan="2" style="padding: 20px; text-align: center; border: 1px solid #ddd;">কোন পণ্য নেই</td>
                    </tr>
                `;
            } else {
                data.stocks.first.forEach(item => {
                    reportHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.productName}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.quantity} পিচ</td>
                        </tr>
                    `;
                });
            }
            
            reportHTML += `
                    </tbody>
                </table>
                
                <h5>৩য় স্টক (ছিলা)</h5>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">পণ্যের নাম</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পরিমাণ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (data.stocks.third.length === 0) {
                reportHTML += `
                    <tr>
                        <td colspan="2" style="padding: 20px; text-align: center; border: 1px solid #ddd;">কোন পণ্য নেই</td>
                    </tr>
                `;
            } else {
                data.stocks.third.forEach(item => {
                    reportHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.productName}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.quantity} পিচ</td>
                        </tr>
                    `;
                });
            }
            
            reportHTML += `
                    </tbody>
                </table>
                
                <h5>ফাইনাল স্টক</h5>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">পণ্যের নাম</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">বান্ডিল</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">মোট পিচ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">মোট ওজন</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">তারিখ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (data.stocks.final.length === 0) {
                reportHTML += `
                    <tr>
                        <td colspan="5" style="padding: 20px; text-align: center; border: 1px solid #ddd;">কোন পণ্য নেই</td>
                    </tr>
                `;
            } else {
                data.stocks.final.forEach(item => {
                    reportHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.productName}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.totalBundles} টি</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.totalPieces} পিচ</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${item.totalWeight.toFixed(2)} কেজি</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(item.createdAt)}</td>
                        </tr>
                    `;
                });
            }
            
            reportHTML += `
                    </tbody>
                </table>
            `;
            
            return reportHTML;
        }

        // আর্থিক রিপোর্ট
        function generateFinanceReport(startDate, endDate) {
            const filteredTransactions = data.finances.transactions.filter(t => 
                t.date >= startDate && t.date <= endDate
            );
            
            const incomeTransactions = filteredTransactions.filter(t => t.type === 'income');
            const expenseTransactions = filteredTransactions.filter(t => t.type === 'expense');
            
            const totalIncome = incomeTransactions.reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = expenseTransactions.reduce((sum, t) => sum + t.amount, 0);
            const netBalance = totalIncome - totalExpense;
            
            let reportHTML = `
                <h3>আর্থিক রিপোর্ট</h3>
                <p><strong>তারিখ:</strong> ${formatDate(startDate)} থেকে ${formatDate(endDate)}</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #d5f4e6; padding: 15px; border-radius: 8px; border: 2px solid #27ae60;">
                        <h4>মোট আয়</h4>
                        <p style="font-size: 28px; font-weight: bold; color: #27ae60;">${totalIncome.toFixed(2)} টাকা</p>
                        <p>${incomeTransactions.length} টি লেনদেন</p>
                    </div>
                    <div style="background: #ffefef; padding: 15px; border-radius: 8px; border: 2px solid #e74c3c;">
                        <h4>মোট ব্যয়</h4>
                        <p style="font-size: 28px; font-weight: bold; color: #e74c3c;">${totalExpense.toFixed(2)} টাকা</p>
                        <p>${expenseTransactions.length} টি লেনদেন</p>
                    </div>
                    <div style="background: ${netBalance >= 0 ? '#d5f4e6' : '#ffefef'}; padding: 15px; border-radius: 8px; border: 2px solid ${netBalance >= 0 ? '#27ae60' : '#e74c3c'}">
                        <h4>নিট ব্যালেন্স</h4>
                        <p style="font-size: 32px; font-weight: bold; color: ${netBalance >= 0 ? '#27ae60' : '#e74c3c'}">
                            ${netBalance >= 0 ? '+' : ''}${netBalance.toFixed(2)} টাকা
                        </p>
                        <p>${netBalance >= 0 ? 'লাভ' : 'ক্ষতি'}</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px;">
                        <h4>বর্তমান নগদ</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #3498db;">${data.finances.cash.toFixed(2)} টাকা</p>
                        <p>নগদ তহবিল</p>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px;">
                        <h4>মোট ব্যাংক</h4>
                        <p style="font-size: 24px; font-weight: bold; color: #9b59b6;">${(data.finances.banks.bank1.balance + data.finances.banks.bank2.balance + data.finances.banks.bank3.balance).toFixed(2)} টাকা</p>
                        <p>সকল ব্যাংকের সমষ্টি</p>
                    </div>
                </div>
            `;
            
            // আয়ের বিস্তারিত
            reportHTML += `
                <h4>আয়ের তালিকা</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">তারিখ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">বর্ণনা</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পরিমাণ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পদ্ধতি</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (incomeTransactions.length === 0) {
                reportHTML += `
                    <tr>
                        <td colspan="4" style="padding: 20px; text-align: center; border: 1px solid #ddd;">কোন আয়ের রেকর্ড নেই</td>
                    </tr>
                `;
            } else {
                incomeTransactions.forEach(transaction => {
                    const methodText = transaction.method === 'cash' ? 'নগদ' : 
                                     transaction.method === 'bank' ? 'ব্যাংক' : 'অন্যান্য';
                    
                    reportHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(transaction.date)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${transaction.description}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; color: #27ae60; font-weight: bold;">+${transaction.amount.toFixed(2)} টাকা</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${methodText}</td>
                        </tr>
                    `;
                });
            }
            
            reportHTML += `
                    </tbody>
                </table>
            `;
            
            // ব্যয়ের বিস্তারিত
            reportHTML += `
                <h4>ব্যয়ের তালিকা</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">তারিখ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">বর্ণনা</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পরিমাণ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">পদ্ধতি</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (expenseTransactions.length === 0) {
                reportHTML += `
                    <tr>
                        <td colspan="4" style="padding: 20px; text-align: center; border: 1px solid #ddd;">কোন ব্যয়ের রেকর্ড নেই</td>
                    </tr>
                `;
            } else {
                expenseTransactions.forEach(transaction => {
                    const methodText = transaction.method === 'cash' ? 'নগদ' : 
                                     transaction.method === 'bank' ? 'ব্যাংক' : 'অন্যান্য';
                    
                    reportHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(transaction.date)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${transaction.description}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; color: #e74c3c; font-weight: bold;">-${transaction.amount.toFixed(2)} টাকা</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${methodText}</td>
                        </tr>
                    `;
                });
            }
            
            reportHTML += `
                    </tbody>
                </table>
            `;
            
            return reportHTML;
        }

        // ক্রেতা বাকী রিপোর্ট
        function generateCustomerDueReport() {
            const customersWithDue = data.customers.filter(c => c.outstandingBalance > 0);
            const totalDue = customersWithDue.reduce((sum, customer) => sum + customer.outstandingBalance, 0);
            
            let reportHTML = `
                <h3>ক্রেতা বাকী রিপোর্ট</h3>
                <p><strong>রিপোর্ট তারিখ:</strong> ${formatDate(new Date().toISOString().split('T')[0])}</p>
                
                <div style="text-align: center; margin: 30px 0; padding: 20px; background: ${totalDue > 0 ? '#ffefef' : '#d5f4e6'}; border-radius: 10px; border: 2px solid ${totalDue > 0 ? '#e74c3c' : '#27ae60'}">
                    <h4 style="color: ${totalDue > 0 ? '#e74c3c' : '#27ae60'}">মোট বাকী টাকা</h4>
                    <p style="font-size: 36px; font-weight: bold; color: ${totalDue > 0 ? '#e74c3c' : '#27ae60'}">
                        ${totalDue.toFixed(2)} টাকা
                    </p>
                    <p>ক্রেতা সংখ্যা: ${customersWithDue.length} জন</p>
                    <p>${totalDue > 0 ? 'বাকী আছে' : 'সব বাকী পরিশোধিত'}</p>
                </div>
            `;
            
            if (customersWithDue.length === 0) {
                reportHTML += `
                    <div style="text-align: center; padding: 40px; color: #27ae60;">
                        <i class="fas fa-check-circle" style="font-size: 64px;"></i>
                        <h3>কোন ক্রেতার বাকী নেই</h3>
                        <p>সকল ক্রেতার বাকী টাকা পরিশোধিত</p>
                    </div>
                `;
                return reportHTML;
            }
            
            // ক্রেতাদের তালিকা
            reportHTML += `
                <h4>ক্রেতাদের বাকী তালিকা</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">ক্রমিক</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">ক্রেতার নাম</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">মোবাইল</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">মোট ক্রয়</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">মোট ক্রয় মূল্য</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">বাকী টাকা</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            customersWithDue.forEach((customer, index) => {
                reportHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${index + 1}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${customer.name}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${customer.phone || 'নাই'}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${customer.totalPurchases} বার</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${customer.totalAmount.toFixed(2)} টাকা</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: #e74c3c; font-weight: bold;">${customer.outstandingBalance.toFixed(2)} টাকা</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                    </tbody>
                </table>
            `;
            
            return reportHTML;
        }

        // রিপোর্ট প্রিন্ট করুন
        function printReport() {
            const reportContent = document.getElementById('reportPreview').innerHTML;
            const printWindow = window.open('', '', 'width=900,height=650');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>রিপোর্ট - Zafrul Metal</title>
                    <style>
                        body { font-family: 'Segoe UI', 'SolaimanLipi', sans-serif; margin: 20px; }
                        h3 { color: #2c3e50; margin-bottom: 10px; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f8f9fa; }
                        @media print {
                            body { font-size: 12pt; }
                            @page { size: A4; margin: 15mm; }
                        }
                    </style>
                </head>
                <body>
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1>Zafrul Metal</h1>
                        <h3>বগুড়া | মোবাইল: 01713706996</h3>
                        <p>এলুমিনিয়াম পণ্য উৎপাদন ও সরবরাহ</p>
                        <hr>
                    </div>
                    ${reportContent}
                    <div style="text-align: center; margin-top: 50px; font-size: 12px; color: #666;">
                        <p>Software: Zafrul Metal Inventory v2.7 | বগুড়া | 01713706996</p>
                        <p>প্রিন্ট তারিখ: ${formatDate(new Date().toISOString().split('T')[0])}</p>
                    </div>
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() { window.close(); }, 1000);
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // ইনভয়েস লোড করুন
        function loadInvoices() {
            const tbody = document.getElementById('invoicesTableBody');
            tbody.innerHTML = '';
            
            if (data.savedInvoices.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">কোন ইনভয়েস নেই</td></tr>';
                return;
            }
            
            data.savedInvoices.forEach((invoice, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${invoice.invoiceNo}</td>
                    <td>${formatDate(invoice.date)}</td>
                    <td>${invoice.customerName}</td>
                    <td>${invoice.totalItems} প্রকার</td>
                    <td>${invoice.totalWeight.toFixed(2)} কেজি</td>
                    <td>${invoice.totalAmount.toFixed(2)} টাকা</td>
                    <td>${invoice.paymentMethod === 'cash' ? 'নগদ' : invoice.paymentMethod === 'bank' ? 'ব্যাংক' : 'বাকি'}</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="viewInvoice('${invoice.invoiceNo}')">
                            <i class="fas fa-eye"></i> দেখুন
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteInvoice('${invoice.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ইনভয়েস নম্বর দিয়ে খুঁজুন
        function searchInvoiceByNumber() {
            const invoiceNo = document.getElementById('invoiceNumberSearch').value.trim();
            if (!invoiceNo) {
                showNotification('ইনভয়েস নম্বর দিন!', 'error');
                return;
            }
            
            const sale = data.sales.find(s => s.invoiceNo === invoiceNo);
            if (!sale) {
                showNotification('ইনভয়েস পাওয়া যায়নি!', 'error');
                return;
            }
            
            const customer = data.customers.find(c => c.id === sale.customerId);
            if (!customer) {
                showNotification('ক্রেতার তথ্য পাওয়া যায়নি!', 'error');
                return;
            }
            
            generateInvoice(invoiceNo, sale, customer);
        }

        // ইনভয়েস খুঁজুন
        function searchInvoices() {
            const query = document.getElementById('invoiceSearch').value.toLowerCase();
            const tbody = document.getElementById('invoicesTableBody');
            tbody.innerHTML = '';
            
            let filteredInvoices = data.savedInvoices.filter(invoice => 
                invoice.invoiceNo.toLowerCase().includes(query) ||
                invoice.customerName.toLowerCase().includes(query)
            );
            
            if (filteredInvoices.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">কোন ইনভয়েস পাওয়া যায়নি</td></tr>';
                return;
            }
            
            filteredInvoices.forEach((invoice, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${invoice.invoiceNo}</td>
                    <td>${formatDate(invoice.date)}</td>
                    <td>${invoice.customerName}</td>
                    <td>${invoice.totalItems} প্রকার</td>
                    <td>${invoice.totalWeight.toFixed(2)} কেজি</td>
                    <td>${invoice.totalAmount.toFixed(2)} টাকা</td>
                    <td>${invoice.paymentMethod === 'cash' ? 'নগদ' : invoice.paymentMethod === 'bank' ? 'ব্যাংক' : 'বাকি'}</td>
                    <td class="data-actions">
                        <button class="action-btn edit-btn" onclick="viewInvoice('${invoice.invoiceNo}')">
                            <i class="fas fa-eye"></i> দেখুন
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteInvoice('${invoice.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ইনভয়েস ডিলিট করুন
        function deleteInvoice(id) {
            if (confirm('আপনি কি নিশ্চিত এই ইনভয়েস ডিলিট করতে চান?')) {
                const index = data.savedInvoices.findIndex(i => i.id === id);
                if (index !== -1) {
                    data.savedInvoices.splice(index, 1);
                    saveToLocalStorage();
                    loadInvoices();
                    showNotification('ইনভয়েস ডিলিট করা হয়েছে!', 'success');
                }
            }
        }

        // ম্যানুয়াল ডেটা সেভ
        function manualSaveData() {
            if (saveToLocalStorage()) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('bn-BD', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                showNotification(`ডেটা সফলভাবে সেভ করা হয়েছে! (${timeStr})`, 'success');
            } else {
                showNotification('ডেটা সেভ করতে সমস্যা হয়েছে!', 'error');
            }
        }

        // ডেটা ফাইল থেকে লোড করুন
        function loadDataFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedData = JSON.parse(e.target.result);
                    
                    // ডেটা ভ্যালিডেশন
                    if (!loadedData.workers || !loadedData.products || !loadedData.finances) {
                        showNotification('অবৈধ ডেটা ফাইল!', 'error');
                        return;
                    }
                    
                    if (confirm('আপনি কি নিশ্চিত ডেটা লোড করতে চান? বর্তমান ডেটা মুছে যাবে!')) {
                        // সংরক্ষিত ডেটা আপডেট
                        data = loadedData;
                        
                        // তারিখ আপডেট
                        const today = new Date().toISOString().split('T')[0];
                        data.settings.lastSave = new Date().toISOString();
                        
                        // লোকাল স্টোরেজে সেভ
                        saveToLocalStorage();
                        
                        // পৃষ্ঠা রিফ্রেশ
                        location.reload();
                    }
                } catch (error) {
                    showNotification('ডেটা লোড করতে সমস্যা হয়েছে!', 'error');
                    console.error('Error loading data:', error);
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        // ডেটা ব্যাকআপ তৈরি করুন
        function backupData() {
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const timeStr = today.getHours().toString().padStart(2, '0') + 
                           today.getMinutes().toString().padStart(2, '0') + 
                           today.getSeconds().toString().padStart(2, '0');
            
            const backupData = JSON.stringify(data, null, 2);
            const blob = new Blob([backupData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `zafrul_metal_backup_${dateStr}_${timeStr}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showNotification('ডেটা ব্যাকআপ তৈরি করা হয়েছে!', 'success');
        }

        // ডেটা রিসেট করুন
        function resetData() {
            if (confirm('আপনি কি নিশ্চিত সব ডেটা রিসেট করতে চান? এটি বিপরীত করা যাবে না!')) {
                if (confirm('সত্যিই নিশ্চিত? সব ডেটা চিরতরে মুছে যাবে!')) {
                    localStorage.removeItem('zafrulMetalData');
                    location.reload();
                }
            }
        }

        // ড্যাশবোর্ড আপডেট করুন
        function updateDashboard() {
            // শ্রমিক সংখ্যা
            const totalWorkers = data.workers.length;
            const dhaliWorkers = data.workers.filter(w => w.category === 'dhali').length;
            const ghosaWorkers = data.workers.filter(w => w.category === 'ghosa').length;
            const chilaWorkers = data.workers.filter(w => w.category === 'chila').length;
            const generalWorkers = data.workers.filter(w => w.category === 'general').length;
            const balaWorkers = data.workers.filter(w => w.category === 'bala_kata').length;
            
            document.getElementById('totalWorkers').textContent = totalWorkers;
            document.getElementById('dhaliWorkers').textContent = dhaliWorkers;
            document.getElementById('ghosaWorkers').textContent = ghosaWorkers;
            document.getElementById('chilaWorkers').textContent = chilaWorkers;
            document.getElementById('generalWorkers').textContent = generalWorkers;
            document.getElementById('balaWorkers').textContent = balaWorkers;
            
            // স্টক সংখ্যা
            const firstStockCount = data.stocks.first.reduce((sum, item) => sum + item.quantity, 0);
            const secondStockCount = data.stocks.second.reduce((sum, item) => sum + item.quantity, 0);
            const thirdStockCount = data.stocks.third.reduce((sum, item) => sum + item.quantity, 0);
            const finalStockCount = data.stocks.final.reduce((sum, item) => sum + item.totalBundles, 0);
            const balaStockCount = data.stocks.bala.reduce((sum, item) => sum + item.quantity, 0);
            
            document.getElementById('firstStockCount').textContent = `${firstStockCount} পিচ`;
            document.getElementById('secondStockCount').textContent = `${secondStockCount} পিচ`;
            document.getElementById('thirdStockCount').textContent = `${thirdStockCount} পিচ`;
            document.getElementById('finalStockCount').textContent = `${finalStockCount} বান্ডিল`;
            document.getElementById('balaStockCount').textContent = `${balaStockCount} পিচ`;
            
            // আর্থিক তথ্য
            updateFinanceDisplay();
        }

        // তারিখ ও সময় আপডেট করুন
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            
            const dateTimeStr = now.toLocaleDateString('bn-BD', options);
            document.getElementById('currentDateTime').textContent = dateTimeStr;
            
            setTimeout(updateDateTime, 1000);
        }

        // নোটিফিকেশন দেখান
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            
            notification.textContent = message;
            notification.style.backgroundColor = type === 'success' ? '#27ae60' :
                                              type === 'error' ? '#e74c3c' :
                                              type === 'warning' ? '#f39c12' :
                                              '#3498db';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // তারিখ ফরম্যাট করুন
        function formatDate(dateString) {
            if (!dateString) return 'নাই';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('bn-BD', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // আইডি জেনারেট করুন
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // পণ্য কোড জেনারেট করুন
        function generateProductCode(productName) {
            const prefix = productName.includes('কড়াই') ? 'KR' :
                          productName.includes('তৈ') ? 'TA' :
                          productName.includes('তাওয়া') ? 'TW' : 'PR';
            
            const existingCodes = data.products.map(p => p.code);
            let number = 1;
            let code = `${prefix}${number.toString().padStart(2, '0')}`;
            
            while (existingCodes.includes(code)) {
                number++;
                code = `${prefix}${number.toString().padStart(2, '0')}`;
            }
            
            return code;
        }

        // লোকাল স্টোরেজ থেকে লোড করুন
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('zafrulMetalData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    // ডেটা সংস্করণ চেক করুন এবং আপডেট করুন যদি প্রয়োজন
                    if (!parsedData.version || parsedData.version < 2.7) {
                        // পুরাতন ডেটা ফরম্যাটের জন্য আপডেট
                        parsedData.advancePayments = parsedData.advancePayments || [];
                        parsedData.otherExpenses = parsedData.otherExpenses || [];
                        parsedData.duePayments = parsedData.duePayments || [];
                        parsedData.suppliers = parsedData.suppliers || [];
                        parsedData.rawMaterials = parsedData.rawMaterials || [];
                        parsedData.rawMaterialStock = parsedData.rawMaterialStock || 0;
                        parsedData.supplierDuePayments = parsedData.supplierDuePayments || [];
                        parsedData.version = 2.7;
                    }
                    
                    data = parsedData;
                    
                    // ডিফল্ট ব্যাংক নাম চেক
                    if (!data.finances.banks.bank1.name) {
                        data.finances.banks.bank1.name = "ইসলামী ব্যাংক";
                    }
                    if (!data.finances.banks.bank2.name) {
                        data.finances.banks.bank2.name = "সোনালী ব্যাংক";
                    }
                    if (!data.finances.banks.bank3.name) {
                        data.finances.banks.bank3.name = "ডাচ্ বাংলা ব্যাংক";
                    }
                    
                    // সেটিংস চেক
                    if (!data.settings) {
                        data.settings = {
                            lastInvoiceNo: 1000,
                            lastSave: null
                        };
                    }
                    
                    // স্টক স্ট্রাকচার চেক
                    if (!data.stocks) {
                        data.stocks = {
                            first: [],
                            second: [],
                            third: [],
                            final: [],
                            bala: []
                        };
                    }
                    
                    // সেল সেশন রিসেট
                    resetSaleSession();
                    
                    // ড্যাশবোর্ড আপডেট
                    updateDashboard();
                    
                    // লাস্ট সেভ টাইম আপডেট
                    if (data.settings.lastSave) {
                        const lastSave = new Date(data.settings.lastSave);
                        const timeStr = lastSave.toLocaleTimeString('bn-BD', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        document.getElementById('lastSaveTime').textContent = timeStr;
                    }
                }
            } catch (error) {
                console.error('Error loading data from localStorage:', error);
                showNotification('ডেটা লোড করতে সমস্যা হয়েছে!', 'error');
            }
        }

        // লোকাল স্টোরেজে সেভ করুন
        function saveToLocalStorage() {
            try {
                localStorage.setItem('zafrulMetalData', JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error saving data to localStorage:', error);
                showNotification('ডেটা সেভ করতে সমস্যা হয়েছে!', 'error');
                return false;
            }
        }

        // পৃষ্ঠা আনলোড হলে ডেটা সেভ
        window.addEventListener('beforeunload', function(e) {
            saveToLocalStorage();
        });

        // বর্তমান বছর ফুটারে দেখান
        document.addEventListener('DOMContentLoaded', function() {
            const currentYear = new Date().getFullYear();
            const footer = document.querySelector('.footer p:last-child');
            if (footer) {
                footer.innerHTML = footer.innerHTML.replace('2025', currentYear);
            }
        });
    </script>
</body>
</html>